<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EmojiPet - Le jeu d'animaux virtuels</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        fontFamily: {
          'sans': ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
        },
        extend: {
          colors: {
            primary: '#00c2ff', /* Synthwave cyan */
            secondary: '#b967ff', /* Synthwave purple */
            success: '#00ff9d', /* Synthwave green */
            warning: '#ff9d00', /* Synthwave orange */
            danger: '#ff007a', /* Synthwave pink */
            info: '#00e1ff', /* Synthwave cyan light */
            synthwave: {
              pink: '#ff007a',
              purple: '#b967ff',
              blue: '#00c2ff',
              cyan: '#00e1ff',
              green: '#00ff9d',
              yellow: '#ffdd00',
              orange: '#ff9d00',
              red: '#ff2e4d'
            },
            gray: {
              50: '#F2F2F7',
              100: '#E5E5EA',
              200: '#D1D1D6',
              300: '#C7C7CC',
              400: '#AEAEB2',
              500: '#8E8E93',
              600: '#636366',
              700: '#48484A',
              800: '#3A3A3C',
              900: '#2C2C2E',
            },
            oneui: {
              light: {
                bg: 'rgba(242, 242, 247, 0.7)', /* Translucent light background */
                card: 'rgba(255, 255, 255, 0.7)', /* Translucent card background */
                text: '#000000',
                border: 'rgba(209, 209, 214, 0.7)' /* Translucent light border */
              },
              dark: {
                bg: 'rgba(28, 28, 30, 0.85)', /* Translucent dark background */
                card: 'rgba(44, 44, 46, 0.8)', /* Translucent dark card */
                text: '#FFFFFF',
                border: 'rgba(56, 56, 58, 0.85)' /* Translucent dark border */
              }
            }
          },
          animation: {
            'bounce-slow': 'bounce 2s infinite',
            'spin-slow': 'spin 3s linear infinite',
            'pulse-slow': 'pulse 3s infinite',
            'wiggle': 'wiggle 1s ease-in-out',
            'float': 'float 3s ease-in-out infinite',
            'glow': 'glow 2s ease-in-out infinite alternate',
            'synthwave-pulse': 'synthwavePulse 4s ease-in-out infinite alternate',
          },
          keyframes: {
            wiggle: {
              '0%, 100%': { transform: 'rotate(-3deg)' },
              '50%': { transform: 'rotate(3deg)' },
            },
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-10px)' },
            },
            glow: {
              '0%': { textShadow: '0 0 4px rgba(0, 195, 255, 0.6), 0 0 8px rgba(0, 195, 255, 0.4)' },
              '100%': { textShadow: '0 0 8px rgba(0, 195, 255, 0.8), 0 0 20px rgba(0, 195, 255, 0.6), 0 0 30px rgba(0, 195, 255, 0.4)' }
            },
            synthwavePulse: {
              '0%': { boxShadow: '0 0 5px rgba(185, 103, 255, 0.7), 0 0 10px rgba(185, 103, 255, 0.5)' },
              '50%': { boxShadow: '0 0 10px rgba(0, 195, 255, 0.7), 0 0 20px rgba(0, 195, 255, 0.5)' },
              '100%': { boxShadow: '0 0 5px rgba(255, 0, 122, 0.7), 0 0 10px rgba(255, 0, 122, 0.5)' }
            },
          }
        }
      }
    }
  </script>
  <style>
    /* Synthwave + Mica styling */
    .ios-card {
      border-radius: 16px;
      background-color: rgba(255, 255, 255, 0.15);
      background-image: linear-gradient(
        to bottom right,
        rgba(255, 255, 255, 0.35),
        rgba(255, 255, 255, 0.1)
      );
      backdrop-filter: blur(20px) saturate(180%);
      -webkit-backdrop-filter: blur(20px) saturate(180%);
      box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.15),
        0 0 1px rgba(185, 103, 255, 0.2),
        0 0 15px rgba(0, 195, 255, 0.15);
      border: 1px solid rgba(255, 255, 255, 0.15);
      position: relative;
      overflow: hidden;
    }
    
    .ios-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 25%;
      background: linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0.15),
        rgba(255, 255, 255, 0)
      );
      pointer-events: none;
    }

    .dark .ios-card {
      background-color: rgba(44, 44, 46, 0.4);
      background-image: linear-gradient(
        to bottom right,
        rgba(66, 66, 70, 0.4),
        rgba(44, 44, 46, 0.2)
      );
      border: 1px solid rgba(83, 83, 99, 0.15);
      box-shadow: 
        0 10px 30px rgba(0, 0, 0, 0.25),
        0 0 1px rgba(185, 103, 255, 0.3),
        0 0 15px rgba(0, 195, 255, 0.2);
    }
    
    .dark .ios-card::before {
      background: linear-gradient(
        to bottom,
        rgba(100, 100, 120, 0.1),
        rgba(44, 44, 46, 0)
      );
    }

    .ios-button {
      border-radius: 10px;
      font-weight: 500;
      transition: all 0.2s;
      padding: 12px 20px;
      position: relative;
      overflow: hidden;
    }
    
    .ios-button::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(
        to bottom,
        rgba(255, 255, 255, 0.15),
        rgba(255, 255, 255, 0)
      );
      pointer-events: none;
    }
    
    .ios-button:active {
      transform: scale(0.97);
    }

    .synthwave-button {
      box-shadow: 0 0 10px rgba(185, 103, 255, 0.7), 0 0 20px rgba(185, 103, 255, 0.5);
      animation: synthwavePulse 4s ease-in-out infinite alternate;
    }

    .ios-input {
      background-color: rgba(242, 242, 247, 0.3);
      backdrop-filter: blur(8px);
      -webkit-backdrop-filter: blur(8px);
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.2);
      padding: 12px 16px;
      font-size: 16px;
    }

    .dark .ios-input {
      background-color: rgba(44, 44, 46, 0.5);
      color: white;
      border: 1px solid rgba(83, 83, 99, 0.3);
    }

    /* Phoenix fire animation */
    @keyframes phoenix-fire {
      0% { text-shadow: 0 0 5px #ff0000, 0 0 10px #ff4000; }
      25% { text-shadow: 0 0 8px #ff8000, 0 0 15px #ffa500; }
      50% { text-shadow: 0 0 10px #ffb700, 0 0 20px #ffd700; }
      75% { text-shadow: 0 0 8px #ff8000, 0 0 15px #ffa500; }
      100% { text-shadow: 0 0 5px #ff0000, 0 0 10px #ff4000; }
    }
    
    /* Shark swimming animation */
    @keyframes shark-swim {
      0% { 
        transform: perspective(800px) rotateY(15deg) rotateX(10deg) translateX(-5px); 
        text-shadow: 0 0 8px rgba(0, 120, 215, 0.6);
      }
      25% {
        transform: perspective(800px) rotateY(10deg) rotateX(5deg) translateX(0px);
        text-shadow: 0 0 12px rgba(0, 120, 215, 0.7);
      }
      50% { 
        transform: perspective(800px) rotateY(15deg) rotateX(10deg) translateX(5px); 
        text-shadow: 0 0 8px rgba(0, 120, 215, 0.6);
      }
      75% {
        transform: perspective(800px) rotateY(20deg) rotateX(15deg) translateX(0px);
        text-shadow: 0 0 12px rgba(0, 120, 215, 0.7);
      }
      100% { 
        transform: perspective(800px) rotateY(15deg) rotateX(10deg) translateX(-5px); 
        text-shadow: 0 0 8px rgba(0, 120, 215, 0.6);
      }
    }
    
    /* Synthwave text effect */
    .synthwave-text {
      color: #fff;
      text-shadow:
        0 0 5px #00c2ff,
        0 0 10px #00c2ff,
        0 0 20px #00c2ff,
        0 0 40px #00c2ff;
      animation: glow 2s ease-in-out infinite alternate;
    }
    
    /* Neon glow effects */
    .neon-pink {
      text-shadow: 0 0 5px #ff007a, 0 0 10px #ff007a, 0 0 15px #ff007a;
    }
    
    .neon-blue {
      text-shadow: 0 0 5px #00c2ff, 0 0 10px #00c2ff, 0 0 15px #00c2ff;
    }
    
    .neon-purple {
      text-shadow: 0 0 5px #b967ff, 0 0 10px #b967ff, 0 0 15px #b967ff;
    }
    
    .phoenix-emoji {
      animation: phoenix-fire 2s infinite;
    }
    
    .phoenix-pet {
      animation: phoenix-fire 2s infinite !important;
    }
    
    .shark-emoji {
      animation: shark-swim 4s ease-in-out infinite;
    }
    
    .shark-pet {
      animation: shark-swim 4s ease-in-out infinite !important;
    }
    
    /* Add water-like bubbles for the shark */
    .shark-pet::before,
    .shark-emoji::before {
      content: '🫧';
      position: absolute;
      font-size: 0.8rem;
      top: -10px;
      right: -8px;
      opacity: 0.8;
      animation: float 3s ease-in-out infinite;
    }
    
    /* RGB Theme Effects */
    @keyframes rgbText {
      0% { color: #ff0000; }
      16% { color: #ff8000; }
      33% { color: #ffff00; }
      50% { color: #00ff00; }
      66% { color: #00ffff; }
      83% { color: #0000ff; }
      100% { color: #ff00ff; }
    }
    
    @keyframes rgbBorder {
      0% { border-color: #ff0000; box-shadow: 0 0 8px #ff0000; }
      16% { border-color: #ff8000; box-shadow: 0 0 8px #ff8000; }
      33% { border-color: #ffff00; box-shadow: 0 0 8px #ffff00; }
      50% { border-color: #00ff00; box-shadow: 0 0 8px #00ff00; }
      66% { border-color: #00ffff; box-shadow: 0 0 8px #00ffff; }
      83% { border-color: #0000ff; box-shadow: 0 0 8px #0000ff; }
      100% { border-color: #ff00ff; box-shadow: 0 0 8px #ff00ff; }
    }
    
    @keyframes rgbShadow {
      0% { text-shadow: 0 0 8px #ff0000; }
      16% { text-shadow: 0 0 8px #ff8000; }
      33% { text-shadow: 0 0 8px #ffff00; }
      50% { text-shadow: 0 0 8px #00ff00; }
      66% { text-shadow: 0 0 8px #00ffff; }
      83% { text-shadow: 0 0 8px #0000ff; }
      100% { text-shadow: 0 0 8px #ff00ff; }
    }
    
    .rgb-mode .emoji-display {
      animation: rgbShadow 5s linear infinite;
    }
    
    .rgb-mode .oneui-card {
      border: 2px solid transparent;
      animation: rgbBorder 5s linear infinite;
    }
    
    .rgb-mode #gameTitle {
      animation: rgbText 5s linear infinite;
    }
    
    .emoji-display {
      transition: all 0.3s ease;
      transform-style: preserve-3d;
      position: relative;
    }
    
    .emoji-3d {
      transform: perspective(800px) rotateY(15deg) rotateX(10deg);
      box-shadow: -10px 10px 15px rgba(0, 0, 0, 0.2);
    }
    
    .emoji-selected {
      animation: pulsate 1s ease-in-out infinite alternate;
    }
    
    .rgb-mode .emoji-selected {
      animation: rgbShadow 3s linear infinite !important;
    }
    
    .emoji-married::after {
      content: '💍';
      position: absolute;
      bottom: -15px;
      right: -15px;
      font-size: 1.2rem;
      transform: rotate(-15deg);
      animation: shine 2s ease-in-out infinite;
    }
    
    .emoji-container {
      position: relative;
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .emoji-container:hover {
      transform: scale(1.1) rotate(5deg);
    }
    
    .emoji-container:active {
      transform: scale(0.95);
    }
    
    .country-flag {
      position: absolute;
      top: -10px;
      left: -10px;
      font-size: 1rem;
      filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.3));
    }
    
    @keyframes pulsate {
      0% { transform: scale(1); text-shadow: 0 0 5px rgba(0, 195, 255, 0.5); }
      100% { transform: scale(1.1); text-shadow: 0 0 10px rgba(0, 195, 255, 0.8); }
    }
    
    @keyframes shine {
      0% { opacity: 0.8; transform: rotate(-15deg) scale(1); }
      50% { opacity: 1; transform: rotate(-15deg) scale(1.2); }
      100% { opacity: 0.8; transform: rotate(-15deg) scale(1); }
    }
    
    .oneui-card {
      border-radius: 25px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .dark .oneui-card {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .oneui-button {
      border-radius: 25px;
      transition: all 0.2s ease;
    }
    
    .oneui-button:active {
      transform: scale(0.95);
    }
    
    .emoji-evolution-progress {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.1);
    }
    
    .dark .emoji-evolution-progress {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .emoji-evolution-bar {
      height: 100%;
      border-radius: 4px;
      background: linear-gradient(to right, #00c2ff, #b967ff);
      transition: width 0.5s ease;
    }
    
    /* Pseudo-3D shadow effect */
    .shadow-3d {
      position: relative;
    }
    
    .shadow-3d::after {
      content: '';
      position: absolute;
      width: 80%;
      height: 15px;
      border-radius: 50%;
      bottom: -15px;
      left: 10%;
      background: rgba(0, 0, 0, 0.15);
      filter: blur(5px);
      z-index: -1;
      transition: all 0.3s ease;
    }
    
    .emoji-action {
      transition: all 0.3s ease;
    }
    
    .emoji-action:hover {
      transform: translateY(-3px);
    }
    
    .emoji-action:active {
      transform: translateY(1px);
    }
    
    /* Mood indications */
    .mood-indicator {
      position: absolute;
      top: -15px;
      right: -10px;
      font-size: 1rem;
      animation: float 3s ease-in-out infinite;
    }
  </style>
</head>
<body class="font-sans bg-oneui-light-bg dark:bg-oneui-dark-bg text-oneui-light-text dark:text-oneui-dark-text transition-colors duration-300" style="background-image: url('https://i.imgur.com/GVIHcvz.jpeg'); background-attachment: fixed; background-size: cover; background-position: center;">
  <div class="min-h-screen p-4 md:p-8">
    <!-- Header -->
    <header class="flex flex-col sm:flex-row justify-between items-center mb-6">
      <h1 id="gameTitle" class="text-3xl font-bold text-white mb-2 sm:mb-0 synthwave-text">EmojiPet</h1>
      <div class="flex space-x-2">
        <button id="questsButton" class="p-3 rounded-full bg-oneui-light-card dark:bg-oneui-dark-card backdrop-blur-md">
          <span class="text-xl">📋</span>
        </button>
        <button id="achievementsButton" class="p-3 rounded-full bg-oneui-light-card dark:bg-oneui-dark-card backdrop-blur-md">
          <span class="text-xl">🏆</span>
        </button>
        <button id="marketButton" class="p-3 rounded-full bg-oneui-light-card dark:bg-oneui-dark-card backdrop-blur-md">
          <span class="text-xl">🛍️</span>
        </button>
        <button id="rgbModeToggle" class="p-3 rounded-full bg-oneui-light-card dark:bg-oneui-dark-card backdrop-blur-md">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
          </svg>
        </button>
        <button id="darkModeToggle" class="p-3 rounded-full bg-oneui-light-card dark:bg-oneui-dark-card backdrop-blur-md">
          <svg id="sunIcon" class="w-6 h-6 text-yellow-500 hidden dark:inline" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>
          <svg id="moonIcon" class="w-6 h-6 text-slate-700 inline dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>
      </div>
    </header>
    
    <!-- Main Game Container -->
    <main class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- My EmojiPets Panel -->
      <section class="ios-card col-span-1 md:col-span-2 p-6">
        <h2 class="text-2xl font-semibold mb-4 text-white">Mes EmojiPets</h2>
        
        <div id="emojipetsContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
          <!-- EmojiPets will be generated here -->
        </div>
        
        <button id="addEmojiPet" class="ios-button synthwave-button mt-6 w-full py-3 bg-synthwave-blue hover:bg-synthwave-blue/90 text-white font-semibold transition-colors">
          Créer un nouveau EmojiPet
        </button>
      </section>
      
      <!-- Action Panel -->
      <section class="ios-card p-6">
        <h2 class="text-2xl font-semibold mb-4 text-white">Actions</h2>
        
        <div id="selectedPetInfo" class="hidden">
          <div class="flex items-center space-x-4 mb-6">
            <div id="selectedEmoji" class="text-6xl emoji-display shadow-3d"></div>
            <div>
              <h3 id="selectedName" class="text-xl font-bold text-white"></h3>
              <p id="selectedCountry" class="text-sm text-white/70"></p>
              <p id="selectedMood" class="text-sm text-white"></p>
            </div>
          </div>
          
          <!-- Niveaux et besoins -->
          <div class="mb-4">
            <div class="flex justify-between items-center">
              <p class="text-sm mb-1 text-white">Niveau d'évolution</p>
              <p id="petLevel" class="text-sm font-bold text-synthwave-cyan neon-blue">Niveau 1</p>
            </div>
            <div class="emoji-evolution-progress mb-1">
              <div id="evolutionBar" class="emoji-evolution-bar" style="width: 10%;"></div>
            </div>
            <p id="evolutionXP" class="text-xs text-gray-300">XP: 0/100</p>
          </div>
          
          <!-- Besoins -->
          <div class="grid grid-cols-2 gap-2 mb-4">
            <div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-white">🍔 Faim</span>
                <span id="hungerValue" class="text-xs text-white">100%</span>
              </div>
              <div class="h-2 w-full bg-gray-200/30 dark:bg-gray-700/30 rounded-full overflow-hidden backdrop-blur-sm">
                <div id="hungerBar" class="h-full bg-success rounded-full" style="width: 100%"></div>
              </div>
            </div>
            
            <div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-white">😊 Bonheur</span>
                <span id="happinessValue" class="text-xs text-white">100%</span>
              </div>
              <div class="h-2 w-full bg-gray-200/30 dark:bg-gray-700/30 rounded-full overflow-hidden backdrop-blur-sm">
                <div id="happinessBar" class="h-full bg-synthwave-pink rounded-full" style="width: 100%"></div>
              </div>
            </div>
            
            <div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-white">🚿 Propreté</span>
                <span id="cleanlinessValue" class="text-xs text-white">100%</span>
              </div>
              <div class="h-2 w-full bg-gray-200/30 dark:bg-gray-700/30 rounded-full overflow-hidden backdrop-blur-sm">
                <div id="cleanlinessBar" class="h-full bg-synthwave-blue rounded-full" style="width: 100%"></div>
              </div>
            </div>
            
            <div>
              <div class="flex justify-between items-center">
                <span class="text-sm text-white">⚡ Énergie</span>
                <span id="energyValue" class="text-xs text-white">100%</span>
              </div>
              <div class="h-2 w-full bg-gray-200/30 dark:bg-gray-700/30 rounded-full overflow-hidden backdrop-blur-sm">
                <div id="energyBar" class="h-full bg-synthwave-yellow rounded-full" style="width: 100%"></div>
              </div>
            </div>
          </div>
          
          <div class="space-y-3">
            <button id="feedPet" class="ios-button w-full py-2 px-4 bg-success hover:bg-success/90 text-white font-medium emoji-action">
              🍔 Nourrir
            </button>
            <button id="playWithPet" class="ios-button w-full py-2 px-4 bg-synthwave-blue hover:bg-synthwave-blue/90 text-white font-medium emoji-action">
              🎾 Jouer
            </button>
            <button id="cleanPet" class="ios-button w-full py-2 px-4 bg-info hover:bg-info/90 text-white font-medium emoji-action">
              🛁 Nettoyer
            </button>
            <button id="sleepPet" class="ios-button w-full py-2 px-4 bg-synthwave-purple hover:bg-synthwave-purple/90 text-white font-medium emoji-action">
              😴 Faire dormir
            </button>
            <button id="complimentPet" class="ios-button w-full py-2 px-4 bg-synthwave-purple hover:bg-synthwave-purple/90 text-white font-medium emoji-action">
              💌 Lui parler
            </button>
            <button id="shopButton" class="ios-button w-full py-2 px-4 bg-warning hover:bg-warning/90 text-white font-medium emoji-action">
              🛒 Boutique <span id="coinDisplay" class="ml-1 bg-white text-warning px-2 py-0.5 rounded-full text-xs font-bold">100</span>
            </button>
            <button id="marryPet" class="ios-button w-full py-2 px-4 bg-synthwave-pink hover:bg-synthwave-pink/90 text-white font-medium emoji-action">
              💍 Marier
            </button>
            <button id="deletePet" class="ios-button w-full py-2 px-4 bg-danger hover:bg-danger/90 text-white font-medium emoji-action">
              🗑️ Supprimer
            </button>
          </div>
        </div>
        
        <div id="noSelection" class="text-center py-12">
          <p class="text-lg text-white/60">Sélectionnez un EmojiPet pour interagir</p>
        </div>
      </section>
    </main>
    
    <!-- Creation Modal -->
    <div id="creationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
      <div class="ios-card p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
        <h2 class="text-2xl font-semibold mb-4 text-white">Créer un EmojiPet</h2>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1 text-white">Nom</label>
            <input id="petName" type="text" class="w-full p-3 rounded-xl border border-oneui-light-border dark:border-oneui-dark-border bg-white/20 dark:bg-gray-800/30 text-white backdrop-blur-md text-base" placeholder="Nom de votre EmojiPet">
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1 text-white">Type d'animal</label>
            <div class="grid grid-cols-4 gap-2">
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐶</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐱</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐰</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐼</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🦊</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🦁</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐮</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐷</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐵</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐻</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐨</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🦝</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐲</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🦄</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🦒</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🦓</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐘</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🦔</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐢</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🐬</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 phoenix-emoji backdrop-blur-sm">🦅</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 shark-emoji backdrop-blur-sm">🦈</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🦖</button>
              <!-- Humains et emoji inclusifs -->
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🙎‍♀️</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🙎</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🙎‍♂️</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🧑‍🦽</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">👨‍🦽</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">👩‍🦼</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🧑‍🦼</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">👨‍🦯</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🧎‍♀️</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">👩‍❤️‍👨</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">👩‍❤️‍👩</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">👩‍❤️‍💋‍👨</button>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1 text-white">Accessoire</label>
            <div class="grid grid-cols-4 gap-2">
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🎩</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">👑</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🧢</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🕶️</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🧣</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🦺</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">👔</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🦮</button>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1 text-white">Symbole religieux</label>
            <div class="grid grid-cols-4 gap-2">
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">✝️</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">☪️</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">✡️</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🕉️</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">☸️</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">🕎</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">☯️</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100/30 dark:hover:bg-gray-700/30 backdrop-blur-sm">☦️</button>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1 text-white">Pays d'origine</label>
            <select id="petCountry" class="w-full p-3 rounded-xl border border-gray-300/30 dark:border-gray-600/30 bg-white/20 dark:bg-gray-800/30 text-white backdrop-blur-md text-base">
              <option value="🇦🇫">Afghanistan 🇦🇫</option>
              <option value="🇿🇦">Afrique du Sud 🇿🇦</option>
              <option value="🇦🇱">Albanie 🇦🇱</option>
              <option value="🇩🇿">Algérie 🇩🇿</option>
              <option value="🇩🇪">Allemagne 🇩🇪</option>
              <option value="🇦🇩">Andorre 🇦🇩</option>
              <option value="🇦🇴">Angola 🇦🇴</option>
              <option value="🇦🇬">Antigua-et-Barbuda 🇦🇬</option>
              <option value="🇸🇦">Arabie Saoudite 🇸🇦</option>
              <option value="🇦🇷">Argentine 🇦🇷</option>
              <option value="🇦🇲">Arménie 🇦🇲</option>
              <option value="🇦🇺">Australie 🇦🇺</option>
              <option value="🇦🇹">Autriche 🇦🇹</option>
              <option value="🇦🇿">Azerbaïdjan 🇦🇿</option>
              <option value="🇧🇸">Bahamas 🇧🇸</option>
              <option value="🇧🇭">Bahreïn 🇧🇭</option>
              <option value="🇧🇩">Bangladesh 🇧🇩</option>
              <option value="🇧🇧">Barbade 🇧🇧</option>
              <option value="🇧🇪">Belgique 🇧🇪</option>
              <option value="🇧🇿">Belize 🇧🇿</option>
              <option value="🇧🇯">Bénin 🇧🇯</option>
              <option value="🇧🇹">Bhoutan 🇧🇹</option>
              <option value="🇧🇾">Biélorussie 🇧🇾</option>
              <option value="🇲🇲">Birmanie 🇲🇲</option>
              <option value="🇧🇴">Bolivie 🇧🇴</option>
              <option value="🇧🇦">Bosnie-Herzégovine 🇧🇦</option>
              <option value="🇧🇼">Botswana 🇧🇼</option>
              <option value="🇧🇷">Brésil 🇧🇷</option>
              <option value="🇧🇳">Brunei 🇧🇳</option>
              <option value="🇧🇬">Bulgarie 🇧🇬</option>
              <option value="🇧🇫">Burkina Faso 🇧🇫</option>
              <option value="🇧🇮">Burundi 🇧🇮</option>
              <option value="🇰🇭">Cambodge 🇰🇭</option>
              <option value="🇨🇲">Cameroun 🇨🇲</option>
              <option value="🇨🇦">Canada 🇨🇦</option>
              <option value="🇨🇻">Cap-Vert 🇨🇻</option>
              <option value="🇨🇫">République centrafricaine 🇨🇫</option>
              <option value="🇨🇱">Chili 🇨🇱</option>
              <option value="🇨🇳">Chine 🇨🇳</option>
              <option value="🇨🇾">Chypre 🇨🇾</option>
              <option value="🇨🇴">Colombie 🇨🇴</option>
              <option value="🇰🇲">Comores 🇰🇲</option>
              <option value="🇨🇬">République du Congo 🇨🇬</option>
              <option value="🇨🇩">République démocratique du Congo 🇨🇩</option>
              <option value="🇰🇵">Corée du Nord 🇰🇵</option>
              <option value="🇰🇷">Corée du Sud 🇰🇷</option>
              <option value="🇨🇷">Costa Rica 🇨🇷</option>
              <option value="🇨🇮">Côte d'Ivoire 🇨🇮</option>
              <option value="🇭🇷">Croatie 🇭🇷</option>
              <option value="🇨🇺">Cuba 🇨🇺</option>
              <option value="🇩🇰">Danemark 🇩🇰</option>
              <option value="🇩🇯">Djibouti 🇩🇯</option>
              <option value="🇩🇲">Dominique 🇩🇲</option>
              <option value="🇪🇬">Égypte 🇪🇬</option>
              <option value="🇦🇪">Émirats arabes unis 🇦🇪</option>
              <option value="🇪🇨">Équateur 🇪🇨</option>
              <option value="🇪🇷">Érythrée 🇪🇷</option>
              <option value="🇪🇸">Espagne 🇪🇸</option>
              <option value="🇪🇪">Estonie 🇪🇪</option>
              <option value="🇸🇿">Eswatini 🇸🇿</option>
              <option value="🇺🇸">États-Unis 🇺🇸</option>
              <option value="🇪🇹">Éthiopie 🇪🇹</option>
              <option value="🇫🇯">Fidji 🇫🇯</option>
              <option value="🇫🇮">Finlande 🇫🇮</option>
              <option value="🇫🇷">France 🇫🇷</option>
              <option value="🇬🇦">Gabon 🇬🇦</option>
              <option value="🇬🇲">Gambie 🇬🇲</option>
              <option value="🇬🇪">Géorgie 🇬🇪</option>
              <option value="🇬🇭">Ghana 🇬🇭</option>
              <option value="🇬🇷">Grèce 🇬🇷</option>
              <option value="🇬🇩">Grenade 🇬🇩</option>
              <option value="🇬🇹">Guatemala 🇬🇹</option>
              <option value="🇬🇳">Guinée 🇬🇳</option>
              <option value="🇬🇶">Guinée équatoriale 🇬🇶</option>
              <option value="🇬🇼">Guinée-Bissau 🇬🇼</option>
              <option value="🇬🇾">Guyana 🇬🇾</option>
              <option value="🇭🇹">Haïti 🇭🇹</option>
              <option value="🇭🇳">Honduras 🇭🇳</option>
              <option value="🇭🇺">Hongrie 🇭🇺</option>
              <option value="🇮🇳">Inde 🇮🇳</option>
              <option value="🇮🇩">Indonésie 🇮🇩</option>
              <option value="🇮🇶">Irak 🇮🇶</option>
              <option value="🇮🇷">Iran 🇮🇷</option>
              <option value="🇮🇪">Irlande 🇮🇪</option>
              <option value="🇮🇸">Islande 🇮🇸</option>
              <option value="🇮🇱">Israël 🇮🇱</option>
              <option value="🇮🇹">Italie 🇮🇹</option>
              <option value="🇯🇲">Jamaïque 🇯🇲</option>
              <option value="🇯🇵">Japon 🇯🇵</option>
              <option value="🇯🇴">Jordanie 🇯🇴</option>
              <option value="🇰🇿">Kazakhstan 🇰🇿</option>
              <option value="🇰🇪">Kenya 🇰🇪</option>
              <option value="🇰🇬">Kirghizistan 🇰🇬</option>
              <option value="🇰🇮">Kiribati 🇰🇮</option>
              <option value="🇰🇼">Koweït 🇰🇼</option>
              <option value="🇱🇦">Laos 🇱🇦</option>
              <option value="🇱🇸">Lesotho 🇱🇸</option>
              <option value="🇱🇻">Lettonie 🇱🇻</option>
              <option value="🇱🇧">Liban 🇱🇧</option>
              <option value="🇱🇷">Liberia 🇱🇷</option>
              <option value="🇱🇾">Libye 🇱🇾</option>
              <option value="🇱🇮">Liechtenstein 🇱🇮</option>
              <option value="🇱🇹">Lituanie 🇱🇹</option>
              <option value="🇱🇺">Luxembourg 🇱🇺</option>
              <option value="🇲🇰">Macédoine du Nord 🇲🇰</option>
              <option value="🇲🇬">Madagascar 🇲🇬</option>
              <option value="🇲🇾">Malaisie 🇲🇾</option>
              <option value="🇲🇼">Malawi 🇲🇼</option>
              <option value="🇲🇻">Maldives 🇲🇻</option>
              <option value="🇲🇱">Mali 🇲🇱</option>
              <option value="🇲🇹">Malte 🇲🇹</option>
              <option value="🇲🇦">Maroc 🇲🇦</option>
              <option value="🇲🇭">Îles Marshall 🇲🇭</option>
              <option value="🇲🇺">Maurice 🇲🇺</option>
              <option value="🇲🇷">Mauritanie 🇲🇷</option>
              <option value="🇲🇽">Mexique 🇲🇽</option>
              <option value="🇫🇲">Micronésie 🇫🇲</option>
              <option value="🇲🇩">Moldavie 🇲🇩</option>
              <option value="🇲🇨">Monaco 🇲🇨</option>
              <option value="🇲🇳">Mongolie 🇲🇳</option>
              <option value="🇲🇪">Monténégro 🇲🇪</option>
              <option value="🇲🇿">Mozambique 🇲🇿</option>
              <option value="🇳🇦">Namibie 🇳🇦</option>
              <option value="🇳🇷">Nauru 🇳🇷</option>
              <option value="🇳🇵">Népal 🇳🇵</option>
              <option value="🇳🇮">Nicaragua 🇳🇮</option>
              <option value="🇳🇪">Niger 🇳🇪</option>
              <option value="🇳🇬">Nigeria 🇳🇬</option>
              <option value="🇳🇴">Norvège 🇳🇴</option>
              <option value="🇳🇿">Nouvelle-Zélande 🇳🇿</option>
              <option value="🇴🇲">Oman 🇴🇲</option>
              <option value="🇺🇬">Ouganda 🇺🇬</option>
              <option value="🇺🇿">Ouzbékistan 🇺🇿</option>
              <option value="🇵🇰">Pakistan 🇵🇰</option>
              <option value="🇵🇼">Palaos 🇵🇼</option>
              <option value="🇵🇦">Panama 🇵🇦</option>
              <option value="🇵🇬">Papouasie-Nouvelle-Guinée 🇵🇬</option>
              <option value="🇵🇾">Paraguay 🇵🇾</option>
              <option value="🇳🇱">Pays-Bas 🇳🇱</option>
              <option value="🇵🇪">Pérou 🇵🇪</option>
              <option value="🇵🇭">Philippines 🇵🇭</option>
              <option value="🇵🇱">Pologne 🇵🇱</option>
              <option value="🇵🇹">Portugal 🇵🇹</option>
              <option value="🇶🇦">Qatar 🇶🇦</option>
              <option value="🇷🇴">Roumanie 🇷🇴</option>
              <option value="🇬🇧">Royaume-Uni 🇬🇧</option>
              <option value="🇷🇺">Russie 🇷🇺</option>
              <option value="🇷🇼">Rwanda 🇷🇼</option>
              <option value="🇰🇳">Saint-Kitts-et-Nevis 🇰🇳</option>
              <option value="🇱🇨">Sainte-Lucie 🇱🇨</option>
              <option value="🇻🇨">Saint-Vincent-et-les-Grenadines 🇻🇨</option>
              <option value="🇸🇲">Saint-Marin 🇸🇲</option>
              <option value="🇸🇧">Îles Salomon 🇸🇧</option>
              <option value="🇸🇻">Salvador 🇸🇻</option>
              <option value="🇼🇸">Samoa 🇼🇸</option>
              <option value="🇸🇹">Sao Tomé-et-Principe 🇸🇹</option>
              <option value="🇸🇳">Sénégal 🇸🇳</option>
              <option value="🇷🇸">Serbie 🇷🇸</option>
              <option value="🇸🇨">Seychelles 🇸🇨</option>
              <option value="🇸🇱">Sierra Leone 🇸🇱</option>
              <option value="🇸🇬">Singapour 🇸🇬</option>
              <option value="🇸🇰">Slovaquie 🇸🇰</option>
              <option value="🇸🇮">Slovénie 🇸🇮</option>
              <option value="🇸🇴">Somalie 🇸🇴</option>
              <option value="🇸🇩">Soudan 🇸🇩</option>
              <option value="🇸🇸">Soudan du Sud 🇸🇸</option>
              <option value="🇱🇰">Sri Lanka 🇱🇰</option>
              <option value="🇸🇪">Suède 🇸🇪</option>
              <option value="🇨🇭">Suisse 🇨🇭</option>
              <option value="🇸🇷">Suriname 🇸🇷</option>
              <option value="🇸🇾">Syrie 🇸🇾</option>
              <option value="🇹🇯">Tadjikistan 🇹🇯</option>
              <option value="🇹🇿">Tanzanie 🇹🇿</option>
              <option value="🇹🇩">Tchad 🇹🇩</option>
              <option value="🇨🇿">Tchéquie 🇨🇿</option>
              <option value="🇹🇭">Thaïlande 🇹🇭</option>
              <option value="🇹🇱">Timor oriental 🇹🇱</option>
              <option value="🇹🇬">Togo 🇹🇬</option>
              <option value="🇹🇴">Tonga 🇹🇴</option>
              <option value="🇹🇹">Trinité-et-Tobago 🇹🇹</option>
              <option value="🇹🇳">Tunisie 🇹🇳</option>
              <option value="🇹🇲">Turkménistan 🇹🇲</option>
              <option value="🇹🇷">Turquie 🇹🇷</option>
              <option value="🇹🇻">Tuvalu 🇹🇻</option>
              <option value="🇺🇦">Ukraine 🇺🇦</option>
              <option value="🇺🇾">Uruguay 🇺🇾</option>
              <option value="🇻🇺">Vanuatu 🇻🇺</option>
              <option value="🇻🇦">Vatican 🇻🇦</option>
              <option value="🇻🇪">Venezuela 🇻🇪</option>
              <option value="🇻🇳">Viêt Nam 🇻🇳</option>
              <option value="🇾🇪">Yémen 🇾🇪</option>
              <option value="🇿🇲">Zambie 🇿🇲</option>
              <option value="🇿🇼">Zimbabwe 🇿🇼</option>
            </select>
          </div>
          
          <div class="pt-4 flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
            <button id="cancelCreation" class="ios-button py-2 px-4 border border-gray-300/30 dark:border-gray-600/30 rounded-xl font-medium text-white bg-black/30 backdrop-blur-md">
              Annuler
            </button>
            <button id="confirmCreation" class="ios-button synthwave-button py-2 px-4 bg-synthwave-blue hover:bg-synthwave-blue/90 text-white font-medium">
              Créer
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Marriage Modal -->
    <div id="marriageModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
      <div class="ios-card p-6 w-full max-w-md mx-4">
        <h2 class="text-2xl font-semibold mb-4 text-white">Marier votre EmojiPet</h2>
        
        <div id="marriagePetsList" class="grid grid-cols-2 gap-3 mb-6">
          <!-- Available pets for marriage will be listed here -->
        </div>
        
        <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
          <button id="cancelMarriage" class="ios-button py-2 px-4 border border-gray-300/30 dark:border-gray-600/30 rounded-xl font-medium text-white bg-black/30 backdrop-blur-md">
            Annuler
          </button>
        </div>
      </div>
    </div>
  
  <!-- Compliment Modal -->
  <div id="complimentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
    <div class="ios-card p-6 w-full max-w-md mx-4">
      <h2 class="text-2xl font-semibold mb-4 text-white">Parler à <span id="complimentPetName"></span></h2>
      
      <div class="grid grid-cols-2 gap-3 mb-6">
        <button class="phrase-option p-4 bg-white/20 dark:bg-gray-800/40 rounded-xl text-center hover:bg-purple-50/30 dark:hover:bg-purple-900/40 transition-colors backdrop-blur-md text-white">
          <span class="text-2xl mb-2">😘</span>
          <div class="font-medium">Bisou</div>
        </button>
        <button class="phrase-option p-4 bg-white/20 dark:bg-gray-800/40 rounded-xl text-center hover:bg-purple-50/30 dark:hover:bg-purple-900/40 transition-colors backdrop-blur-md text-white">
          <span class="text-2xl mb-2">❤️</span>
          <div class="font-medium">Je t'aime</div>
        </button>
        <button class="phrase-option p-4 bg-white/20 dark:bg-gray-800/40 rounded-xl text-center hover:bg-purple-50/30 dark:hover:bg-purple-900/40 transition-colors backdrop-blur-md text-white">
          <span class="text-2xl mb-2">🥰</span>
          <div class="font-medium">Je t'adore</div>
        </button>
        <button class="phrase-option p-4 bg-white/20 dark:bg-gray-800/40 rounded-xl text-center hover:bg-purple-50/30 dark:hover:bg-purple-900/40 transition-colors backdrop-blur-md text-white">
          <span class="text-2xl mb-2">🏆</span>
          <div class="font-medium">Tu es le meilleur</div>
        </button>
        <button class="phrase-option p-4 bg-white/20 dark:bg-gray-800/40 rounded-xl text-center hover:bg-purple-50/30 dark:hover:bg-purple-900/40 transition-colors backdrop-blur-md text-white">
          <span class="text-2xl mb-2">✨</span>
          <div class="font-medium">Tu es magnifique</div>
        </button>
        <button class="phrase-option p-4 bg-white/20 dark:bg-gray-800/40 rounded-xl text-center hover:bg-purple-50/30 dark:hover:bg-purple-900/40 transition-colors backdrop-blur-md text-white">
          <span class="text-2xl mb-2">🌟</span>
          <div class="font-medium">Tu es spécial</div>
        </button>
        <button class="phrase-option p-4 bg-white/20 dark:bg-gray-800/40 rounded-xl text-center hover:bg-purple-50/30 dark:hover:bg-purple-900/40 transition-colors backdrop-blur-md text-white">
          <span class="text-2xl mb-2">🤗</span>
          <div class="font-medium">Câlin</div>
        </button>
        <button class="phrase-option p-4 bg-white/20 dark:bg-gray-800/40 rounded-xl text-center hover:bg-purple-50/30 dark:hover:bg-purple-900/40 transition-colors backdrop-blur-md text-white">
          <span class="text-2xl mb-2">🙌</span>
          <div class="font-medium">Bravo!</div>
        </button>
      </div>
      
      <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
        <button id="cancelCompliment" class="ios-button py-2 px-4 border border-gray-300/30 dark:border-gray-600/30 rounded-xl font-medium text-white bg-black/30 backdrop-blur-md">
          Fermer
        </button>
      </div>
    </div>
  </div>
  
  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
    <div class="ios-card p-6 w-full max-w-md mx-4">
      <h2 class="text-2xl font-semibold mb-4 text-white">Supprimer l'EmojiPet</h2>
      
      <p class="mb-6 text-gray-100">Êtes-vous sûr de vouloir supprimer cet EmojiPet ? Cette action est irréversible.</p>
      
      <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
        <button id="cancelDelete" class="ios-button py-2 px-4 border border-gray-300/30 dark:border-gray-600/30 rounded-xl font-medium text-white bg-black/30 backdrop-blur-md">
          Annuler
        </button>
        <button id="confirmDelete" class="ios-button py-2 px-4 bg-danger hover:bg-danger/90 text-white font-medium">
          Supprimer
        </button>
      </div>
    </div>
  </div>
  
  <!-- Achievements Modal -->
  <div id="achievementsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
    <div class="ios-card p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
      <h2 class="text-2xl font-semibold mb-4 flex items-center text-white">
        <span class="mr-2">🏆</span>
        Défis et Succès
      </h2>
      
      <div id="achievementsList" class="space-y-4 mb-6">
        <!-- Achievements will be listed here -->
      </div>
      
      <button id="closeAchievements" class="ios-button synthwave-button w-full py-3 px-4 bg-synthwave-blue hover:bg-synthwave-blue/90 text-white font-medium">
        Fermer
      </button>
    </div>
  </div>
  
  <!-- Quests Modal -->
  <div id="questsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
    <div class="ios-card p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-semibold flex items-center text-white">
          <span class="mr-2">📋</span>
          Quêtes
        </h2>
        <div class="bg-gray-900/40 px-3 py-1 rounded-full font-medium backdrop-blur-sm text-white border border-white/10">
          <span id="questCoins">100</span> 🪙
        </div>
      </div>
      
      <div id="questsList" class="space-y-4 mb-6">
        <!-- Quests will be listed here -->
      </div>
      
      <button id="closeQuests" class="ios-button synthwave-button w-full py-3 px-4 bg-synthwave-blue hover:bg-synthwave-blue/90 text-white font-medium">
        Fermer
      </button>
    </div>
  </div>
  
  <!-- Market Modal -->
  <div id="marketModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
    <div class="ios-card p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
      <div class="flex justify-between items-center mb-4">
        <h2 class="text-2xl font-semibold flex items-center text-white">
          <span class="mr-2">🛍️</span>
          Marché des Joueurs
        </h2>
        <div class="bg-amber-900/40 px-3 py-1 rounded-full text-amber-200 font-medium backdrop-blur-sm border border-amber-500/20">
          <span id="marketCoins">100</span> 🪙
        </div>
      </div>
      
      <div class="mb-4">
        <div class="flex justify-between items-center mb-2">
          <h3 class="font-semibold text-white">Objets disponibles</h3>
          <button id="refreshMarket" class="p-2 bg-gray-900/40 rounded-lg text-sm hover:bg-gray-800/60 text-white backdrop-blur-sm">
            🔄 Actualiser
          </button>
        </div>
        <div id="marketItemsList" class="space-y-3">
          <!-- Market items will be listed here -->
        </div>
      </div>
      
      <div class="border-t border-gray-200/20 dark:border-gray-700/20 pt-4 mb-4">
        <h3 class="font-semibold mb-2 text-white">Mettre en vente un objet</h3>
        <div id="sellItemSection" class="bg-gray-900/30 p-3 rounded-lg backdrop-blur-md">
          <select id="sellItemType" class="w-full p-2 mb-2 rounded-lg bg-white/20 dark:bg-gray-800/30 border border-gray-200/30 dark:border-gray-600/30 text-white backdrop-blur-md">
            <option value="">Sélectionner un type d'objet</option>
            <option value="accessory">Accessoire</option>
            <option value="potion">Potion</option>
          </select>
          <div class="flex space-x-2">
            <input type="number" id="sellItemPrice" min="1" max="1000" placeholder="Prix" class="p-2 rounded-lg border border-gray-200/30 dark:border-gray-600/30 bg-white/20 dark:bg-gray-800/30 w-1/2 text-white backdrop-blur-md">
            <button id="sellItemBtn" class="p-2 bg-synthwave-blue hover:bg-synthwave-blue/90 text-white rounded-lg flex-1">Mettre en vente</button>
          </div>
        </div>
      </div>
      
      <button id="closeMarket" class="ios-button synthwave-button w-full py-3 px-4 bg-synthwave-blue hover:bg-synthwave-blue/90 text-white font-medium">
        Fermer
      </button>
    </div>
  </div>
  
  <!-- Quest/Achievement Notification -->
  <div id="achievementNotification" class="fixed top-4 right-4 z-50 bg-black/70 backdrop-blur-lg p-4 rounded-xl shadow-lg transform translate-x-full transition-transform duration-500 ease-out flex items-center border border-purple-500/50">
    <div class="text-3xl mr-3 achievement-icon"></div>
    <div>
      <h3 class="font-bold text-lg achievement-title text-white"></h3>
      <p class="text-sm text-gray-300 achievement-desc"></p>
    </div>
  </div>

  <script>
    // Dark mode detection & toggle
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
    
    document.getElementById('darkModeToggle').addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
    });
    
    // RGB Mode Toggle
    document.getElementById('rgbModeToggle').addEventListener('click', () => {
      document.documentElement.classList.toggle('rgb-mode');
    });
    
    // Delete confirmation modal event listeners
    document.getElementById('cancelDelete').addEventListener('click', hideDeleteConfirmation);
    document.getElementById('confirmDelete').addEventListener('click', deleteSelectedPet);
    
    // Main game data
    let pets = [];
    let selectedPet = null;
    let selectedEmoji = null;
    let selectedAccessory = null;
    let selectedReligion = null;
    let achievements = [];
    let quests = [];         // Quêtes du joueur
    let playerLevel = 1;
    let playerXP = 0;
    let gameCoins = 100;     // Monnaie du jeu
    let marketItems = [];    // Objets sur le marché
    
    // Emojis and emotions
    const petEmotions = ['😃', '😊', '😢', '😍', '😴', '🤒', '😋'];
    
    // Quêtes disponibles
    const availableQuests = [
      {
        id: 'play5times',
        name: 'Jouer 5 fois',
        description: 'Jouer 5 fois avec un EmojiPet',
        icon: '🎮',
        requirement: 5,
        progress: 0,
        completed: false,
        coinReward: 10
      },
      {
        id: 'reach100xp',
        name: 'Expert XP',
        description: 'Atteindre 100 XP avec un EmojiPet',
        icon: '📈',
        requirement: 100,
        progress: 0, // Sera mis à jour avec l'XP du pet
        completed: false,
        coinReward: 50
      },
      {
        id: 'buyAccessory',
        name: 'Fashionista',
        description: 'Acheter un accessoire à la boutique',
        icon: '👒',
        requirement: 1,
        progress: 0,
        completed: false,
        xpReward: 5,
        coinReward: 0
      },
      {
        id: 'evolve1time',
        name: 'Évolution',
        description: 'Faire évoluer un EmojiPet une fois',
        icon: '⭐',
        requirement: 1,
        progress: 0,
        completed: false,
        coinReward: 20
      },
      {
        id: 'clean3times',
        name: 'Nettoyage',
        description: 'Nettoyer un EmojiPet 3 fois',
        icon: '🧼',
        requirement: 3,
        progress: 0,
        completed: false,
        coinReward: 5
      },
      {
        id: 'sleep2times',
        name: 'Bonne nuit',
        description: 'Faire dormir un EmojiPet 2 fois',
        icon: '😴',
        requirement: 2,
        progress: 0,
        completed: false,
        coinReward: 5
      }
    ];
    
    // Achievements data
    const availableAchievements = [
      {
        id: 'feeder',
        name: 'Nourrisseur Attentionné',
        description: 'Nourrir vos EmojiPets 5 fois',
        icon: '🍔',
        requirement: 5,
        progress: 0,
        completed: false,
        xpReward: 50
      },
      {
        id: 'player',
        name: 'Maître du Jeu',
        description: 'Jouer avec vos EmojiPets 5 fois',
        icon: '🎾',
        requirement: 5,
        progress: 0,
        completed: false,
        xpReward: 50
      },
      {
        id: 'cleaner',
        name: 'Hygiéniste',
        description: 'Nettoyer vos EmojiPets 5 fois',
        icon: '🛁',
        requirement: 5,
        progress: 0,
        completed: false,
        xpReward: 50
      },
      {
        id: 'lover',
        name: 'Ami Fidèle',
        description: 'Dire "Je t\'aime" à vos EmojiPets 3 fois',
        icon: '❤️',
        requirement: 3,
        progress: 0,
        completed: false,
        xpReward: 40
      },
      {
        id: 'collector',
        name: 'Collectionneur',
        description: 'Avoir 3 EmojiPets différents',
        icon: '🏆',
        requirement: 3,
        progress: 0,
        completed: false,
        xpReward: 60
      },
      {
        id: 'evolver',
        name: 'Évolution Complète',
        description: 'Faire évoluer un EmojiPet jusqu\'au stade final',
        icon: '⭐',
        requirement: 1,
        progress: 0,
        completed: false,
        xpReward: 100
      },
      {
        id: 'matchmaker',
        name: 'Entremetteur',
        description: 'Marier 2 couples d\'EmojiPets',
        icon: '💍',
        requirement: 2,
        progress: 0,
        completed: false,
        xpReward: 80
      },
      {
        id: 'speaker',
        name: 'Beau Parleur',
        description: 'Parler à vos EmojiPets 10 fois',
        icon: '💬',
        requirement: 10,
        progress: 0,
        completed: false,
        xpReward: 70
      }
    ];
    
    // Objets disponibles dans la boutique avec thème synthwave
    const shopItems = [
      {
        id: 'crown',
        name: 'Couronne Néon',
        emoji: '👑',
        description: 'Une couronne brillante pour votre EmojiPet',
        price: 50,
        type: 'accessory'
      },
      {
        id: 'glasses',
        name: 'Lunettes Rétro',
        emoji: '🕶️',
        description: 'Des lunettes de soleil futuristes',
        price: 30,
        type: 'accessory'
      },
      {
        id: 'bowtie',
        name: 'Nœud Papillon Lumineux',
        emoji: '🎀',
        description: 'Un nœud papillon qui brille dans le noir',
        price: 25,
        type: 'accessory'
      },
      {
        id: 'xppotion',
        name: 'Potion Synthwave',
        emoji: '🧪',
        description: 'Donne +50 XP à votre EmojiPet',
        price: 100,
        type: 'potion',
        effect: (pet) => {
          pet.xp += 50;
          return '+50 XP';
        }
      },
      {
        id: 'energypotion',
        name: 'Boisson Électrique',
        emoji: '⚡',
        description: 'Remplit l\'énergie de votre EmojiPet à 100%',
        price: 60,
        type: 'potion',
        effect: (pet) => {
          pet.energy = 100;
          return 'Énergie restaurée !';
        }
      },
      {
        id: 'happypotion',
        name: 'Néon Euphoria',
        emoji: '😊',
        description: 'Remplit le bonheur de votre EmojiPet à 100%',
        price: 70,
        type: 'potion',
        effect: (pet) => {
          pet.happiness = 100;
          return 'Bonheur restauré !';
        }
      }
    ];

    // Système d'évolution avancé avec formes légendaires
    const petEvolutions = {
      // Animaux normaux - [Niveau 1, Niveau 2, Légendaire (rare)]
      '🐶': ['🐕', '🐕‍🦺', '🦊'],      // Chien -> Renard légendaire
      '🐱': ['🐈', '🐈‍⬛', '🦁'],       // Chat -> Lion légendaire
      '🐰': ['🐇', '🦝', '🐲'],         // Lapin -> Raton -> Dragon légendaire
      '🐼': ['🐼', '🐻', '🐻‍❄️'],      // Panda -> Ours -> Ours polaire légendaire
      '🦊': ['🦊', '🦝', '🦄'],         // Renard -> Licorne légendaire
      '🦁': ['🦁', '🐯', '🐉'],         // Lion -> Tigre -> Dragon légendaire
      '🐮': ['🐄', '🦬', '🦣'],         // Vache -> Bison -> Mammouth légendaire
      '🐷': ['🐖', '🐗', '🦏'],         // Cochon -> Sanglier -> Rhinocéros légendaire
      '🐵': ['🐒', '🦍', '🦧'],         // Singe -> Gorille -> Orang-outan légendaire
      '🐻': ['🐻‍❄️', '🐨', '🐼'],      // Ours -> Koala -> Panda légendaire
      '🐨': ['🐨', '🦥', '🦍'],         // Koala -> Paresseux -> Gorille légendaire
      '🦝': ['🦝', '🦊', '🦁'],         // Raton laveur -> Renard -> Lion légendaire
      '🐲': ['🐉', '🦕', '🦖'],         // Dragon -> Dino -> T-Rex légendaire
      '🦄': ['🦄', '🦓', '🐲'],         // Licorne -> Zèbre -> Dragon légendaire
      '🦒': ['🦒', '🐘', '🦕'],         // Girafe -> Éléphant -> Diplodocus légendaire
      '🦓': ['🦓', '🦓', '🦄'],         // Zèbre -> Licorne légendaire
      '🐘': ['🐘', '🦣', '🦕'],         // Éléphant -> Mammouth -> Diplodocus légendaire
      '🦔': ['🦔', '🦡', '🦊'],         // Hérisson -> Blaireau -> Renard légendaire
      '🐢': ['🐢', '🐊', '🐉'],         // Tortue -> Crocodile -> Dragon légendaire
      '🐬': ['🐬', '🐋', '🦈'],         // Dauphin -> Baleine -> Requin légendaire
      '🦅': ['🦅', '🦅', '🔥'],         // Phénix -> Phénix -> Feu légendaire
      '🦈': ['🦈', '🐋', '🌊'],         // Requin -> Baleine -> Eau légendaire
      '🦖': ['🦖', '🦕', '🐲'],         // T-Rex -> Diplodocus -> Dragon légendaire
      
      // Personnages humains
      '🙎‍♀️': ['🙎‍♀️', '👸', '👸'],     // Femme -> Princesse
      '🙎': ['🙎', '🧙', '🧙'],          // Personne -> Magicien
      '🙎‍♂️': ['🙎‍♂️', '🤴', '🤴'],     // Homme -> Prince
      '🧑‍🦽': ['🧑‍🦽', '🧑‍🦽', '🦸'],  // Personne en fauteuil -> Super héros
      '👨‍🦽': ['👨‍🦽', '👨‍🦽', '🦸‍♂️'], // Homme en fauteuil -> Super héros
      '👩‍🦼': ['👩‍🦼', '👩‍🦼', '🦸‍♀️'], // Femme en fauteuil électrique -> Super héroïne
      '🧑‍🦼': ['🧑‍🦼', '🧑‍🦼', '🦸'],   // Personne en fauteuil électrique -> Super héros
      '👨‍🦯': ['👨‍🦯', '👨‍🦯', '🧙‍♂️'], // Homme avec canne -> Sorcier
      '🧎‍♀️': ['🧎‍♀️', '💃', '🧚‍♀️'],   // Femme à genoux -> Danseuse -> Fée
      '👩‍❤️‍👨': ['👩‍❤️‍👨', '👩‍❤️‍💋‍👨', '👪'], // Couple -> Famille
      '👩‍❤️‍👩': ['👩‍❤️‍👩', '👩‍❤️‍💋‍👩', '👩‍👩‍👧'], // Couple -> Famille
      '👩‍❤️‍💋‍👨': ['👩‍❤️‍💋‍👨', '👪', '👨‍👩‍👧‍👦'] // Couple -> Famille
    };
    
    // Update and track achievement progress
    function updateAchievement(achievementId, progress) {
      const achievement = achievements.find(a => a.id === achievementId);
      if (!achievement || achievement.completed) return;
      
      achievement.progress += progress;
      
      // Check if achievement is completed
      if (achievement.progress >= achievement.requirement && !achievement.completed) {
        achievement.completed = true;
        
        // Grant XP reward to player
        playerXP += achievement.xpReward;
        
        // Show notification
        showAchievementNotification(achievement);
      }
    }
    
    // Show achievement notification
    function showAchievementNotification(achievement) {
      const notification = document.getElementById('achievementNotification');
      const icon = notification.querySelector('.achievement-icon');
      const title = notification.querySelector('.achievement-title');
      const desc = notification.querySelector('.achievement-desc');
      
      icon.textContent = achievement.icon;
      title.textContent = achievement.name + ' 🏆';
      desc.textContent = achievement.description;
      
      // Show notification
      notification.style.transform = 'translateX(0)';
      
      // Hide notification after 5 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(calc(100% + 1rem))';
      }, 5000);
    }
    
    // Render achievements list
    function renderAchievements() {
      const container = document.getElementById('achievementsList');
      container.innerHTML = '';
      
      achievements.forEach(achievement => {
        const achievementEl = document.createElement('div');
        achievementEl.className = `p-4 ${achievement.completed ? 'bg-purple-900/30' : 'bg-black/30'} rounded-xl border ${achievement.completed ? 'border-synthwave-purple' : 'border-gray-600/30'} backdrop-blur-sm`;
        
        const progress = Math.min(achievement.progress, achievement.requirement);
        const percentage = Math.floor((progress / achievement.requirement) * 100);
        
        achievementEl.innerHTML = `
          <div class="flex items-center mb-2">
            <div class="text-3xl mr-3">${achievement.icon}</div>
            <div>
              <h3 class="font-bold text-lg text-white">${achievement.name} ${achievement.completed ? '🏆' : ''}</h3>
              <p class="text-sm text-gray-300">${achievement.description}</p>
            </div>
          </div>
          <div class="mt-2">
            <div class="h-2 w-full bg-gray-900/50 dark:bg-gray-800/50 rounded-full overflow-hidden">
              <div class="h-full ${achievement.completed ? 'bg-synthwave-purple' : 'bg-gray-400 dark:bg-gray-600'} rounded-full" style="width: ${percentage}%"></div>
            </div>
            <p class="text-xs text-right mt-1 ${achievement.completed ? 'text-synthwave-purple' : 'text-gray-400'}">${progress}/${achievement.requirement}</p>
          </div>
          ${achievement.completed ? `<p class="text-sm text-synthwave-purple mt-2">+${achievement.xpReward} XP</p>` : ''}
        `;
        
        container.appendChild(achievementEl);
      });
    }
    
    // Show achievements modal
    function showAchievementsModal() {
      renderAchievements();
      document.getElementById('achievementsModal').classList.remove('hidden');
    }
    
    // Hide achievements modal
    function hideAchievementsModal() {
      document.getElementById('achievementsModal').classList.add('hidden');
    }
      
    // Initialize game
    function initGame() {
      // Create some sample pets to start with
      if (pets.length === 0) {
        const samplePet = {
          id: Date.now().toString(),
          name: "Fluffy",
          emoji: "🐶",
          accessory: "🧣",
          country: "🇫🇷",
          happiness: 100,
          hunger: 80,
          cleanliness: 100,
          energy: 100,
          xp: 0,
          evolutionStage: 0,
          evolutionThreshold: 100,
          marriedTo: null,
          createdAt: Date.now(),
          lastInteraction: Date.now(),
          mood: 3
        };
        pets.push(samplePet);
      }
      renderPets();
      
      // UI event listeners
      document.getElementById('addEmojiPet').addEventListener('click', showCreationModal);
      document.getElementById('cancelCreation').addEventListener('click', hideCreationModal);
      document.getElementById('confirmCreation').addEventListener('click', createNewPet);
      document.getElementById('feedPet').addEventListener('click', feedSelectedPet);
      document.getElementById('playWithPet').addEventListener('click', playWithSelectedPet);
      document.getElementById('cleanPet').addEventListener('click', cleanSelectedPet);
      
      // Initialize achievements
      if (achievements.length === 0) {
        achievements = JSON.parse(JSON.stringify(availableAchievements));
      }
      
      // Initialize quests
      if (quests.length === 0) {
        quests = JSON.parse(JSON.stringify(availableQuests));
      }
      
      // Setup modal buttons
      document.getElementById('achievementsButton').addEventListener('click', showAchievementsModal);
      document.getElementById('closeAchievements').addEventListener('click', hideAchievementsModal);
      document.getElementById('questsButton').addEventListener('click', showQuestsModal);
      document.getElementById('closeQuests').addEventListener('click', hideQuestsModal);
      document.getElementById('marketButton').addEventListener('click', showMarketModal);
      document.getElementById('closeMarket').addEventListener('click', hideMarketModal);
      document.getElementById('refreshMarket').addEventListener('click', () => {
        generateMarketItems();
        renderMarketItems();
        showToast("🔄 Marché actualisé !");
      });
      
      document.getElementById('complimentPet').addEventListener('click', showComplimentModal);
      document.getElementById('marryPet').addEventListener('click', showMarriageModal);
      document.getElementById('cancelMarriage').addEventListener('click', hideMarriageModal);
      document.getElementById('cancelCompliment').addEventListener('click', hideComplimentModal);
      document.getElementById('deletePet').addEventListener('click', showDeleteConfirmation);
      
      // Set up emoji and accessory selection
      document.querySelectorAll('.emoji-option').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.emoji-option').forEach(b => b.classList.remove('ring-2', 'ring-synthwave-blue'));
          btn.classList.add('ring-2', 'ring-synthwave-blue');
          selectedEmoji = btn.textContent;
        });
      });
      
      document.querySelectorAll('.accessory-option').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.accessory-option').forEach(b => b.classList.remove('ring-2', 'ring-synthwave-blue'));
          btn.classList.add('ring-2', 'ring-synthwave-blue');
          selectedAccessory = btn.textContent;
        });
      });
      
      document.querySelectorAll('.religion-option').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.religion-option').forEach(b => b.classList.remove('ring-2', 'ring-synthwave-blue'));
          btn.classList.add('ring-2', 'ring-synthwave-blue');
          selectedReligion = btn.textContent;
        });
      });
      
      // Start game loop for evolution and status changes
      setInterval(gameLoop, 30000); // Run every 30 seconds
    }
    
    // Game loop for passive changes and evolution
    function gameLoop() {
      const now = Date.now();
      
      pets.forEach(pet => {
        // Initialize energy if not exists
        if (pet.energy === undefined) {
          pet.energy = 100;
        }
        
        // Decrease stats over time
        pet.happiness = Math.max(0, pet.happiness - 2);
        pet.hunger = Math.max(0, pet.hunger - 3);
        pet.cleanliness = Math.max(0, pet.cleanliness - 1);
        pet.energy = Math.max(0, pet.energy - 2);
        
        // Evolve pet if conditions are met
        if (pet.xp >= pet.evolutionThreshold && pet.evolutionStage < 3) {
          evolvePet(pet);
        }
        
        // Update mood based on stats
        updatePetMood(pet);
        
        // Save changes
        savePets();
      });
      
      // Re-render if a pet is selected
      if (selectedPet) {
        const updatedPet = pets.find(p => p.id === selectedPet.id);
        if (updatedPet) {
          selectedPet = updatedPet;
          renderPetDetails(selectedPet);
          updateNeedsUI(selectedPet);
        }
      }
      
      renderPets();
    }
    
    // Update needs UI
    function updateNeedsUI(pet) {
      // Update hunger bar
      document.getElementById('hungerBar').style.width = `${pet.hunger}%`;
      document.getElementById('hungerValue').textContent = `${pet.hunger}%`;
      
      // Update happiness bar
      document.getElementById('happinessBar').style.width = `${pet.happiness}%`;
      document.getElementById('happinessValue').textContent = `${pet.happiness}%`;
      
      // Update cleanliness bar
      document.getElementById('cleanlinessBar').style.width = `${pet.cleanliness}%`;
      document.getElementById('cleanlinessValue').textContent = `${pet.cleanliness}%`;
      
      // Update energy bar
      document.getElementById('energyBar').style.width = `${pet.energy || 0}%`;
      document.getElementById('energyValue').textContent = `${pet.energy || 0}%`;
      
      // Update colors based on values
      updateBarColor('hungerBar', pet.hunger);
      updateBarColor('happinessBar', pet.happiness);
      updateBarColor('cleanlinessBar', pet.cleanliness);
      updateBarColor('energyBar', pet.energy || 0);
    }
    
    // Update bar color based on percentage
    function updateBarColor(barId, value) {
      const bar = document.getElementById(barId);
      if (!bar) return;
      
      if (value < 30) {
        // Critical level - red
        if (barId === 'hungerBar') bar.className = 'h-full bg-danger rounded-full';
        else if (barId === 'happinessBar') bar.className = 'h-full bg-danger rounded-full';
        else if (barId === 'cleanlinessBar') bar.className = 'h-full bg-danger rounded-full';
        else if (barId === 'energyBar') bar.className = 'h-full bg-danger rounded-full';
      } else if (value < 60) {
        // Warning level - yellow/orange
        if (barId === 'hungerBar') bar.className = 'h-full bg-warning rounded-full';
        else if (barId === 'happinessBar') bar.className = 'h-full bg-warning rounded-full';
        else if (barId === 'cleanlinessBar') bar.className = 'h-full bg-warning rounded-full';
        else if (barId === 'energyBar') bar.className = 'h-full bg-warning rounded-full';
      } else {
        // Good level - original colors
        if (barId === 'hungerBar') bar.className = 'h-full bg-success rounded-full';
        else if (barId === 'happinessBar') bar.className = 'h-full bg-synthwave-pink rounded-full';
        else if (barId === 'cleanlinessBar') bar.className = 'h-full bg-synthwave-blue rounded-full';
        else if (barId === 'energyBar') bar.className = 'h-full bg-synthwave-yellow rounded-full';
      }
    }
    
    // Render all pets in the container
    function renderPets() {
      const container = document.getElementById('emojipetsContainer');
      container.innerHTML = '';
      
      pets.forEach(pet => {
        const petElement = document.createElement('div');
        petElement.className = 'emoji-container shadow-3d p-4 bg-black/40 dark:bg-gray-900/40 rounded-2xl cursor-pointer relative flex flex-col items-center backdrop-blur-md border border-white/10';
        petElement.dataset.petId = pet.id;
        
        // Add country flag
        const flagElement = document.createElement('span');
        flagElement.className = 'country-flag';
        flagElement.textContent = pet.country;
        petElement.appendChild(flagElement);
        
        // Add the main emoji with potential 3D effect
        const emojiElement = document.createElement('div');
        emojiElement.className = 'emoji-display text-6xl mb-2';
        emojiElement.textContent = pet.emoji;
        
        // Add 3D effect
        emojiElement.classList.add('emoji-3d');
        
        // Add special effects for certain creature types
        if (pet.emoji === '🦅') {
          // Add phoenix fire effect
          emojiElement.classList.add('phoenix-pet');
        } else if (pet.emoji === '🦈') {
          // Add shark swimming effect
          emojiElement.classList.add('shark-pet');
        }
        
        // Add accessory if present
        if (pet.accessory) {
          const accessoryElement = document.createElement('div');
          accessoryElement.className = 'absolute top-1 left-1/2 transform -translate-x-1/2 -translate-y-1/4 text-3xl';
          accessoryElement.textContent = pet.accessory;
          petElement.appendChild(accessoryElement);
        }
        
        // Add religion symbol if present
        if (pet.religion) {
          const religionElement = document.createElement('div');
          religionElement.className = 'absolute bottom-12 right-1 text-xl';
          religionElement.textContent = pet.religion;
          petElement.appendChild(religionElement);
        }
        
        // Add married indicator
        if (pet.marriedTo) {
          emojiElement.classList.add('emoji-married');
        }
        
        // Add mood indicator
        const moodElement = document.createElement('div');
        moodElement.className = 'mood-indicator';
        moodElement.textContent = getPetMoodEmoji(pet);
        petElement.appendChild(moodElement);
        
        petElement.appendChild(emojiElement);
        
        // Add name
        const nameElement = document.createElement('span');
        nameElement.className = 'font-medium text-center mt-1 text-white';
        nameElement.textContent = pet.name;
        petElement.appendChild(nameElement);
        
        // Add event listener
        petElement.addEventListener('click', () => selectPet(pet));
        
        container.appendChild(petElement);
      });
    }
    
    // Select a pet
    function selectPet(pet) {
      selectedPet = pet;
      
      document.getElementById('noSelection').classList.add('hidden');
      document.getElementById('selectedPetInfo').classList.remove('hidden');
      
      renderPetDetails(pet);
      
      // Select the pet in the grid
      document.querySelectorAll('.emoji-container').forEach(el => {
        if (el.dataset.petId === pet.id) {
          el.classList.add('ring-2', 'ring-synthwave-blue', 'ring-offset-2');
          
          // Add animation to the selected pet
          const emojiEl = el.querySelector('.emoji-display');
          emojiEl.classList.add('emoji-selected');
        } else {
          el.classList.remove('ring-2', 'ring-synthwave-blue', 'ring-offset-2');
          const emojiEl = el.querySelector('.emoji-display');
          emojiEl.classList.remove('emoji-selected');
        }
      });
    }
    
    // Render selected pet details
    function renderPetDetails(pet) {
      document.getElementById('selectedEmoji').textContent = pet.emoji;
      document.getElementById('selectedName').textContent = pet.name;
      document.getElementById('selectedCountry').textContent = `Origine: ${getCountryName(pet.country)}`;
      document.getElementById('selectedMood').textContent = `Humeur: ${getPetMoodText(pet)}`;
      
      // Show level information
      const petLevel = Math.floor(pet.xp / 50) + 1; // Every 50 XP is a new level
      document.getElementById('petLevel').textContent = `Niveau ${petLevel}`;
      
      // Update evolution progress bar
      const evolutionPercentage = (pet.xp / pet.evolutionThreshold) * 100;
      document.getElementById('evolutionBar').style.width = `${Math.min(100, evolutionPercentage)}%`;
      document.getElementById('evolutionXP').textContent = `XP: ${pet.xp}/${pet.evolutionThreshold}`;
      
      // Add 3D effect to the selected emoji
      document.getElementById('selectedEmoji').classList.add('emoji-3d');
      
      // Add special effects for certain creature types
      const selectedEmojiElement = document.getElementById('selectedEmoji');
      selectedEmojiElement.classList.remove('phoenix-pet', 'shark-pet');
      
      // Apply special effects based on emoji type
      if (pet.emoji === '🦅') {
        // Add phoenix fire effect
        selectedEmojiElement.classList.add('phoenix-pet');
      } else if (pet.emoji === '🦈') {
        // Add shark swimming effect
        selectedEmojiElement.classList.add('shark-pet');
      }
      
      // Add married indicator if applicable
      if (pet.marriedTo) {
        document.getElementById('selectedEmoji').classList.add('emoji-married');
        
        // Find partner
        const partner = pets.find(p => p.id === pet.marriedTo);
        if (partner) {
          document.getElementById('selectedMood').textContent += ` 💑 Marié(e) à ${partner.name}`;
        }
      } else {
        document.getElementById('selectedEmoji').classList.remove('emoji-married');
      }
      
      // Update button states
      document.getElementById('marryPet').disabled = !!pet.marriedTo;
      document.getElementById('marryPet').textContent = pet.marriedTo ? '💍 Déjà marié(e)' : '💍 Marier';
    }
    
    // Show creation modal
    function showCreationModal() {
      document.getElementById('creationModal').classList.remove('hidden');
      document.getElementById('petName').value = '';
      selectedEmoji = null;
      selectedAccessory = null;
      selectedReligion = null;
      
      document.querySelectorAll('.emoji-option').forEach(b => b.classList.remove('ring-2', 'ring-synthwave-blue'));
      document.querySelectorAll('.accessory-option').forEach(b => b.classList.remove('ring-2', 'ring-synthwave-blue'));
      document.querySelectorAll('.religion-option').forEach(b => b.classList.remove('ring-2', 'ring-synthwave-blue'));
    }
    
    // Hide creation modal
    function hideCreationModal() {
      document.getElementById('creationModal').classList.add('hidden');
    }
    
    // Create a new pet
    function createNewPet() {
      const name = document.getElementById('petName').value.trim();
      const country = document.getElementById('petCountry').value;
      
      if (!name || !selectedEmoji) {
        // Show error
        return;
      }
      
      const newPet = {
        id: Date.now().toString(),
        name: name,
        emoji: selectedEmoji,
        accessory: selectedAccessory || null,
        religion: selectedReligion || null,
        country: country,
        happiness: 100,
        hunger: 100,
        cleanliness: 100,
        energy: 100,
        xp: 0,
        evolutionStage: 0,
        evolutionThreshold: 100,
        marriedTo: null,
        createdAt: Date.now(),
        lastInteraction: Date.now(),
        mood: 3
      };
      
      // Update collector achievement when creating a new pet
      if (pets.length >= 2) { // Will be 3 after adding this one
        updateAchievement('collector', 1);
      }
      
      pets.push(newPet);
      savePets();
      renderPets();
      hideCreationModal();
      
      // Select the newly created pet
      selectPet(newPet);
      
      // Add animation for the new pet
      setTimeout(() => {
        const petEl = document.querySelector(`[data-pet-id="${newPet.id}"]`);
        if (petEl) {
          petEl.classList.add('animate-bounce-slow');
          setTimeout(() => {
            petEl.classList.remove('animate-bounce-slow');
          }, 2000);
        }
      }, 100);
    }
    
    // Feed the selected pet
    function feedSelectedPet() {
      if (!selectedPet) return;
      
      const pet = pets.find(p => p.id === selectedPet.id);
      if (pet) {
        pet.hunger = Math.min(100, pet.hunger + 30);
        pet.happiness = Math.min(100, pet.happiness + 5);
        pet.xp += 5;
        pet.lastInteraction = Date.now();
        
        updatePetMood(pet);
        savePets();
        renderPetDetails(pet);
        renderPets();
        
        // Update achievement progress
        updateAchievement('feeder', 1);
        
        // Animation
        showActionAnimation('🍔');
      }
    }
    
    // Play with the selected pet
    function playWithSelectedPet() {
      if (!selectedPet) return;
      
      const pet = pets.find(p => p.id === selectedPet.id);
      if (pet) {
        pet.happiness = Math.min(100, pet.happiness + 30);
        pet.hunger = Math.max(0, pet.hunger - 10);
        pet.xp += 10;
        pet.lastInteraction = Date.now();
        
        updatePetMood(pet);
        savePets();
        renderPetDetails(pet);
        renderPets();
        
        // Update achievement progress
        updateAchievement('player', 1);
        
        // Animation
        showActionAnimation('🎾');
      }
    }
    
    // Clean the selected pet
    function cleanSelectedPet() {
      if (!selectedPet) return;
      
      const pet = pets.find(p => p.id === selectedPet.id);
      if (pet) {
        pet.cleanliness = 100;
        pet.happiness = Math.min(100, pet.happiness + 10);
        pet.xp += 5;
        pet.lastInteraction = Date.now();
        
        updatePetMood(pet);
        savePets();
        renderPetDetails(pet);
        renderPets();
        
        // Update achievement progress
        updateAchievement('cleaner', 1);
        
        // Animation
        showActionAnimation('✨');
      }
    }
    
    // Show marriage modal
    function showMarriageModal() {
      if (!selectedPet || selectedPet.marriedTo) return;
      
      const marriageList = document.getElementById('marriagePetsList');
      marriageList.innerHTML = '';
      
      // Find eligible pets (not married and not the currently selected pet)
      const eligiblePets = pets.filter(p => p.id !== selectedPet.id && !p.marriedTo);
      
      if (eligiblePets.length === 0) {
        marriageList.innerHTML = '<p class="col-span-2 text-center py-4 text-gray-300">Aucun EmojiPet disponible pour un mariage</p>';
      } else {
        eligiblePets.forEach(pet => {
          const petEl = document.createElement('div');
          petEl.className = 'p-4 bg-black/30 dark:bg-gray-800/30 rounded-xl flex flex-col items-center cursor-pointer hover:bg-purple-900/20 dark:hover:bg-purple-900/30 transition-colors backdrop-blur-md border border-white/10';
          
          const emojiEl = document.createElement('div');
          emojiEl.className = 'text-4xl mb-2';
          emojiEl.textContent = pet.emoji;
          
          const nameEl = document.createElement('div');
          nameEl.className = 'font-medium text-center text-white';
          nameEl.textContent = pet.name;
          
          const flagEl = document.createElement('div');
          flagEl.className = 'text-sm';
          flagEl.textContent = pet.country;
          
          petEl.appendChild(emojiEl);
          petEl.appendChild(nameEl);
          petEl.appendChild(flagEl);
          
          petEl.addEventListener('click', () => marryPets(selectedPet, pet));
          
          marriageList.appendChild(petEl);
        });
      }
      
      document.getElementById('marriageModal').classList.remove('hidden');
    }
    
    // Hide marriage modal
    function hideMarriageModal() {
      document.getElementById('marriageModal').classList.add('hidden');
    }
    
    // Marry two pets
    function marryPets(pet1, pet2) {
      pet1.marriedTo = pet2.id;
      pet2.marriedTo = pet1.id;
      
      pet1.happiness = 100;
      pet2.happiness = 100;
      
      pet1.xp += 20;
      pet2.xp += 20;
      
      // Update matchmaker achievement
      updateAchievement('matchmaker', 1);
      
      savePets();
      renderPets();
      renderPetDetails(pet1);
      hideMarriageModal();
      
      // Show marriage animation
      showActionAnimation('💕');
      
      // Animate both pets
      setTimeout(() => {
        const pet1El = document.querySelector(`[data-pet-id="${pet1.id}"]`);
        const pet2El = document.querySelector(`[data-pet-id="${pet2.id}"]`);
        
        if (pet1El) {
          pet1El.classList.add('animate-pulse-slow');
          setTimeout(() => pet1El.classList.remove('animate-pulse-slow'), 3000);
        }
        
        if (pet2El) {
          pet2El.classList.add('animate-pulse-slow');
          setTimeout(() => pet2El.classList.remove('animate-pulse-slow'), 3000);
        }
      }, 100);
    }
    
    // Evolve a pet
    function evolvePet(pet) {
      if (pet.evolutionStage >= 3) return;
      
      // Evolve to next stage
      pet.evolutionStage++;
      
      // Update emoji to evolved form
      if (petEvolutions[pet.emoji]) {
        // Chance for legendary evolution at the final stage
        if (pet.evolutionStage === 3) {
          // 10% chance for legendary form
          const isLegendary = Math.random() < 0.10;
          if (isLegendary && petEvolutions[pet.emoji][2]) {
            pet.emoji = petEvolutions[pet.emoji][2];
            pet.isLegendary = true;
            
            // Show special notification for legendary
            showLegendaryEvolutionNotification(pet);
          } else {
            // Non-legendary final form
            pet.emoji = petEvolutions[pet.emoji][1];
          }
        } else {
          pet.emoji = petEvolutions[pet.emoji][pet.evolutionStage - 1];
        }
      }
      
      // Increase evolution threshold for next evolution
      if (pet.evolutionStage === 1) {
        pet.evolutionThreshold = 200;
      } else if (pet.evolutionStage === 2) {
        pet.evolutionThreshold = 300;
      } else {
        pet.evolutionThreshold = 500;
      }
      
      // Grant additional XP for reaching a new evolution stage
      pet.xp += 20;
      
      // Check if achievement should be awarded (final evolution)
      if (pet.evolutionStage === 2) {
        updateAchievement('evolver', 1);
      }
      
      savePets();
      
      // Show evolution animation
      if (selectedPet && selectedPet.id === pet.id) {
        showActionAnimation(pet.isLegendary ? '🌟' : '⭐');
      }
      
      // Find the pet element
      setTimeout(() => {
        const petEl = document.querySelector(`[data-pet-id="${pet.id}"]`);
        if (petEl) {
          petEl.classList.add('animate-pulse-slow');
          setTimeout(() => petEl.classList.remove('animate-pulse-slow'), 3000);
        }
      }, 100);
    }
    
    // Show legendary evolution notification
    function showLegendaryEvolutionNotification(pet) {
      const notification = document.getElementById('achievementNotification');
      const icon = notification.querySelector('.achievement-icon');
      const title = notification.querySelector('.achievement-title');
      const desc = notification.querySelector('.achievement-desc');
      
      icon.textContent = '🌟';
      title.textContent = 'ÉVOLUTION LÉGENDAIRE!';
      desc.textContent = `${pet.name} a atteint sa forme légendaire!`;
      
      // Show notification
      notification.style.transform = 'translateX(0)';
      
      // Hide notification after 7 seconds (longer for legendary)
      setTimeout(() => {
        notification.style.transform = 'translateX(calc(100% + 1rem))';
      }, 7000);
    }
    
    // Show action animation
    function showActionAnimation(emoji) {
      const container = document.querySelector(`[data-pet-id="${selectedPet.id}"]`);
      if (!container) return;
      
      const animation = document.createElement('div');
      animation.className = 'absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-full text-3xl animate-float';
      animation.textContent = emoji;
      animation.style.zIndex = 5;
      
      container.appendChild(animation);
      
      setTimeout(() => {
        animation.remove();
      }, 2000);
    }
    
    // Update pet mood based on stats
    function updatePetMood(pet) {
      let moodIndex = 0;
      
      const averageStat = (pet.happiness + pet.hunger + pet.cleanliness) / 3;
      
      if (averageStat > 80) moodIndex = 3; // 😍
      else if (averageStat > 60) moodIndex = 0; // 😃
      else if (averageStat > 40) moodIndex = 1; // 😊
      else if (averageStat > 20) moodIndex = 2; // 😢
      else moodIndex = 5; // 🤒
      
      pet.mood = moodIndex;
    }
    
    // Get pet mood emoji
    function getPetMoodEmoji(pet) {
      return petEmotions[pet.mood || 0];
    }
    
    // Get pet mood text
    function getPetMoodText(pet) {
      const moodEmoji = getPetMoodEmoji(pet);
      let moodText = '';
      
      switch (moodEmoji) {
        case '😃': moodText = 'Heureux'; break;
        case '😊': moodText = 'Content'; break;
        case '😢': moodText = 'Triste'; break;
        case '😍': moodText = 'Adorable'; break;
        case '😴': moodText = 'Fatigué'; break;
        case '🤒': moodText = 'Malade'; break;
        case '😋': moodText = 'Affamé'; break;
        default: moodText = 'Normal';
      }
      
      return `${moodText} ${moodEmoji}`;
    }
    
    // Get country name from flag emoji
    function getCountryName(flag) {
      const countries = {
        '🇦🇫': 'Afghanistan',
        '🇿🇦': 'Afrique du Sud',
        '🇦🇱': 'Albanie',
        '🇩🇿': 'Algérie',
        '🇩🇪': 'Allemagne',
        '🇦🇩': 'Andorre',
        '🇦🇴': 'Angola',
        '🇦🇬': 'Antigua-et-Barbuda',
        '🇸🇦': 'Arabie Saoudite',
        '🇦🇷': 'Argentine',
        '🇦🇲': 'Arménie',
        '🇦🇺': 'Australie',
        '🇦🇹': 'Autriche',
        '🇦🇿': 'Azerbaïdjan',
        '🇧🇸': 'Bahamas',
        '🇧🇭': 'Bahreïn',
        '🇧🇩': 'Bangladesh',
        '🇧🇧': 'Barbade',
        '🇧🇪': 'Belgique',
        '🇧🇿': 'Belize',
        '🇧🇯': 'Bénin',
        '🇧🇹': 'Bhoutan',
        '🇧🇾': 'Biélorussie',
        '🇲🇲': 'Birmanie',
        '🇧🇴': 'Bolivie',
        '🇧🇦': 'Bosnie-Herzégovine',
        '🇧🇼': 'Botswana',
        '🇧🇷': 'Brésil',
        '🇧🇳': 'Brunei',
        '🇧🇬': 'Bulgarie',
        '🇧🇫': 'Burkina Faso',
        '🇧🇮': 'Burundi',
        '🇰🇭': 'Cambodge',
        '🇨🇲': 'Cameroun',
        '🇨🇦': 'Canada',
        '🇨🇻': 'Cap-Vert',
        '🇨🇫': 'République centrafricaine',
        '🇨🇱': 'Chili',
        '🇨🇳': 'Chine',
        '🇨🇾': 'Chypre',
        '🇨🇴': 'Colombie',
        '🇰🇲': 'Comores',
        '🇨🇬': 'République du Congo',
        '🇨🇩': 'République démocratique du Congo',
        '🇰🇵': 'Corée du Nord',
        '🇰🇷': 'Corée du Sud',
        '🇨🇷': 'Costa Rica',
        '🇨🇮': 'Côte d\'Ivoire',
        '🇭🇷': 'Croatie',
        '🇨🇺': 'Cuba',
        '🇩🇰': 'Danemark',
        '🇩🇯': 'Djibouti',
        '🇩🇲': 'Dominique',
        '🇪🇬': 'Égypte',
        '🇦🇪': 'Émirats arabes unis',
        '🇪🇨': 'Équateur',
        '🇪🇷': 'Érythrée',
        '🇪🇸': 'Espagne',
        '🇪🇪': 'Estonie',
        '🇸🇿': 'Eswatini',
        '🇺🇸': 'États-Unis',
        '🇪🇹': 'Éthiopie',
        '🇫🇯': 'Fidji',
        '🇫🇮': 'Finlande',
        '🇫🇷': 'France',
        '🇬🇦': 'Gabon',
        '🇬🇲': 'Gambie',
        '🇬🇪': 'Géorgie',
        '🇬🇭': 'Ghana',
        '🇬🇷': 'Grèce',
        '🇬🇩': 'Grenade',
        '🇬🇹': 'Guatemala',
        '🇬🇳': 'Guinée',
        '🇬🇶': 'Guinée équatoriale',
        '🇬🇼': 'Guinée-Bissau',
        '🇬🇾': 'Guyana',
        '🇭🇹': 'Haïti',
        '🇭🇳': 'Honduras',
        '🇭🇺': 'Hongrie',
        '🇮🇳': 'Inde',
        '🇮🇩': 'Indonésie',
        '🇮🇶': 'Irak',
        '🇮🇷': 'Iran',
        '🇮🇪': 'Irlande',
        '🇮🇸': 'Islande',
        '🇮🇱': 'Israël',
        '🇮🇹': 'Italie',
        '🇯🇲': 'Jamaïque',
        '🇯🇵': 'Japon',
        '🇯🇴': 'Jordanie',
        '🇰🇿': 'Kazakhstan',
        '🇰🇪': 'Kenya',
        '🇰🇬': 'Kirghizistan',
        '🇰🇮': 'Kiribati',
        '🇰🇼': 'Koweït',
        '🇱🇦': 'Laos',
        '🇱🇸': 'Lesotho',
        '🇱🇻': 'Lettonie',
        '🇱🇧': 'Liban',
        '🇱🇷': 'Liberia',
        '🇱🇾': 'Libye',
        '🇱🇮': 'Liechtenstein',
        '🇱🇹': 'Lituanie',
        '🇱🇺': 'Luxembourg',
        '🇲🇰': 'Macédoine du Nord',
        '🇲🇬': 'Madagascar',
        '🇲🇾': 'Malaisie',
        '🇲🇼': 'Malawi',
        '🇲🇻': 'Maldives',
        '🇲🇱': 'Mali',
        '🇲🇹': 'Malte',
        '🇲🇦': 'Maroc',
        '🇲🇭': 'Îles Marshall',
        '🇲🇺': 'Maurice',
        '🇲🇷': 'Mauritanie',
        '🇲🇽': 'Mexique',
        '🇫🇲': 'Micronésie',
        '🇲🇩': 'Moldavie',
        '🇲🇨': 'Monaco',
        '🇲🇳': 'Mongolie',
        '🇲🇪': 'Monténégro',
        '🇲🇿': 'Mozambique',
        '🇳🇦': 'Namibie',
        '🇳🇷': 'Nauru',
        '🇳🇵': 'Népal',
        '🇳🇮': 'Nicaragua',
        '🇳🇪': 'Niger',
        '🇳🇬': 'Nigeria',
        '🇳🇴': 'Norvège',
        '🇳🇿': 'Nouvelle-Zélande',
        '🇴🇲': 'Oman',
        '🇺🇬': 'Ouganda',
        '🇺🇿': 'Ouzbékistan',
        '🇵🇰': 'Pakistan',
        '🇵🇼': 'Palaos',
        '🇵🇦': 'Panama',
        '🇵🇬': 'Papouasie-Nouvelle-Guinée',
        '🇵🇾': 'Paraguay',
        '🇳🇱': 'Pays-Bas',
        '🇵🇪': 'Pérou',
        '🇵🇭': 'Philippines',
        '🇵🇱': 'Pologne',
        '🇵🇹': 'Portugal',
        '🇶🇦': 'Qatar',
        '🇷🇴': 'Roumanie',
        '🇬🇧': 'Royaume-Uni',
        '🇷🇺': 'Russie',
        '🇷🇼': 'Rwanda',
        '🇰🇳': 'Saint-Kitts-et-Nevis',
        '🇱🇨': 'Sainte-Lucie',
        '🇻🇨': 'Saint-Vincent-et-les-Grenadines',
        '🇸🇲': 'Saint-Marin',
        '🇸🇧': 'Îles Salomon',
        '🇸🇻': 'Salvador',
        '🇼🇸': 'Samoa',
        '🇸🇹': 'Sao Tomé-et-Principe',
        '🇸🇳': 'Sénégal',
        '🇷🇸': 'Serbie',
        '🇸🇨': 'Seychelles',
        '🇸🇱': 'Sierra Leone',
        '🇸🇬': 'Singapour',
        '🇸🇰': 'Slovaquie',
        '🇸🇮': 'Slovénie',
        '🇸🇴': 'Somalie',
        '🇸🇩': 'Soudan',
        '🇸🇸': 'Soudan du Sud',
        '🇱🇰': 'Sri Lanka',
        '🇸🇪': 'Suède',
        '🇨🇭': 'Suisse',
        '🇸🇷': 'Suriname',
        '🇸🇾': 'Syrie',
        '🇹🇯': 'Tadjikistan',
        '🇹🇿': 'Tanzanie',
        '🇹🇩': 'Tchad',
        '🇨🇿': 'Tchéquie',
        '🇹🇭': 'Thaïlande',
        '🇹🇱': 'Timor oriental',
        '🇹🇬': 'Togo',
        '🇹🇴': 'Tonga',
        '🇹🇹': 'Trinité-et-Tobago',
        '🇹🇳': 'Tunisie',
        '🇹🇲': 'Turkménistan',
        '🇹🇷': 'Turquie',
        '🇹🇻': 'Tuvalu',
        '🇺🇦': 'Ukraine',
        '🇺🇾': 'Uruguay',
        '🇻🇺': 'Vanuatu',
        '🇻🇦': 'Vatican',
        '🇻🇪': 'Venezuela',
        '🇻🇳': 'Viêt Nam',
        '🇾🇪': 'Yémen',
        '🇿🇲': 'Zambie',
        '🇿🇼': 'Zimbabwe'
      };
      
      return countries[flag] || flag;
    }
    
    // Show compliment modal
    function showComplimentModal() {
      if (!selectedPet) return;
      
      document.getElementById('complimentPetName').textContent = selectedPet.name;
      document.getElementById('complimentModal').classList.remove('hidden');
      
      // Add event listeners to phrase options
      document.querySelectorAll('.phrase-option').forEach(btn => {
        btn.addEventListener('click', function() {
          const petMessage = this.querySelector('.font-medium').textContent;
          const emojiIcon = this.querySelector('.text-2xl').textContent;
          sayToPet(selectedPet, petMessage, emojiIcon);
          hideComplimentModal();
        });
      });
    }
    
    // Hide compliment modal
    function hideComplimentModal() {
      document.getElementById('complimentModal').classList.add('hidden');
    }
    
    // Say something to pet
    function sayToPet(pet, message, emoji) {
      if (!pet) return;
      
      const petObj = pets.find(p => p.id === pet.id);
      if (petObj) {
        // Add happiness based on message
        let happinessBoost = 15;
        
        // Special bonuses
        if (message === 'Je t\'aime' || message === 'Je t\'adore') {
          happinessBoost = 25;
          // Update achievement progress for love messages
          updateAchievement('lover', 1);
        } else if (message === 'Tu es le meilleur' || message === 'Tu es magnifique') {
          happinessBoost = 20;
        }
        
        petObj.happiness = Math.min(100, petObj.happiness + happinessBoost);
        petObj.xp += 8;
        petObj.lastInteraction = Date.now();
        
        // Update general speaking achievement
        updateAchievement('speaker', 1);
        
        updatePetMood(petObj);
        savePets();
        renderPetDetails(petObj);
        renderPets();
        
        // Show animation with the emoji
        showActionAnimation(emoji);
        
        // Add speech bubble animation
        showSpeechBubble(petObj, message);
      }
    }
    
    // Show speech bubble animation
    function showSpeechBubble(pet, message) {
      const container = document.querySelector(`[data-pet-id="${pet.id}"]`);
      if (!container) return;
      
      const bubble = document.createElement('div');
      bubble.className = 'absolute top-0 right-0 transform -translate-y-full bg-black/60 dark:bg-gray-800/60 p-2 rounded-xl border border-white/10 backdrop-blur-md';
      bubble.style.minWidth = '80px';
      bubble.style.maxWidth = '150px';
      bubble.style.zIndex = 10;
      
      // Add speech bubble tail
      bubble.style.position = 'relative';
      bubble.innerHTML = `
        <div class="text-sm font-medium text-center text-white">${message}</div>
        <div class="absolute bottom-0 right-3 transform translate-y-1/2 rotate-45 w-3 h-3 bg-black/60 dark:bg-gray-800/60 border-r border-b border-white/10"></div>
      `;
      
      container.appendChild(bubble);
      
      // Add appear animation
      bubble.animate([
        { opacity: 0, transform: 'translateY(-10px)' },
        { opacity: 1, transform: 'translateY(0)' }
      ], {
        duration: 300,
        easing: 'ease-out'
      });
      
      // Remove after some time
      setTimeout(() => {
        // Add disappear animation
        const anim = bubble.animate([
          { opacity: 1, transform: 'translateY(0)' },
          { opacity: 0, transform: 'translateY(-10px)' }
        ], {
          duration: 300,
          easing: 'ease-in'
        });
        
        anim.onfinish = () => bubble.remove();
      }, 3000);
    }
    
    // Save pets to memory only (data will be lost on refresh due to iframe sandbox limitations)
    function savePets() {
      // In sandbox environment, we can't use localStorage
      // This function now only ensures pets are saved in memory during the current session
      console.log('Pets saved in memory (data will be lost on page refresh)');
    }
    
    // Show delete confirmation modal
    function showDeleteConfirmation() {
      if (!selectedPet) return;
      document.getElementById('deleteModal').classList.remove('hidden');
    }
    
    // Hide delete confirmation modal
    function hideDeleteConfirmation() {
      document.getElementById('deleteModal').classList.add('hidden');
    }
    
    // Update and track quest progress
    function updateQuest(questId, progress) {
      const quest = quests.find(q => q.id === questId);
      if (!quest || quest.completed) return;
      
      quest.progress += progress;
      
      // Check if quest is completed
      if (quest.progress >= quest.requirement && !quest.completed) {
        quest.completed = true;
        
        // Grant rewards
        if (quest.coinReward) {
          gameCoins += quest.coinReward;
          updateCoinsDisplay();
        }
        
        if (quest.xpReward && selectedPet) {
          const pet = pets.find(p => p.id === selectedPet.id);
          if (pet) {
            pet.xp += quest.xpReward;
            renderPetDetails(pet);
          }
        }
        
        // Show notification
        showQuestCompletionNotification(quest);
      }
    }
    
    // Show quest completion notification
    function showQuestCompletionNotification(quest) {
      const notification = document.getElementById('achievementNotification');
      const icon = notification.querySelector('.achievement-icon');
      const title = notification.querySelector('.achievement-title');
      const desc = notification.querySelector('.achievement-desc');
      
      icon.textContent = quest.icon;
      title.textContent = 'Quête complétée!';
      desc.textContent = `${quest.name}: ${quest.coinReward ? '+'+quest.coinReward+' 🪙' : ''} ${quest.xpReward ? '+'+quest.xpReward+' XP' : ''}`;
      
      // Show notification
      notification.style.transform = 'translateX(0)';
      
      // Hide notification after 5 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(calc(100% + 1rem))';
      }, 5000);
    }
    
    // Render quests list
    function renderQuests() {
      const container = document.getElementById('questsList');
      container.innerHTML = '';
      
      quests.forEach(quest => {
        const questEl = document.createElement('div');
        questEl.className = `p-4 ${quest.completed ? 'bg-amber-900/30' : 'bg-black/30'} rounded-xl border ${quest.completed ? 'border-amber-500/30' : 'border-gray-600/30'} backdrop-blur-sm`;
        
        const progress = Math.min(quest.progress, quest.requirement);
        const percentage = Math.floor((progress / quest.requirement) * 100);
        
        questEl.innerHTML = `
          <div class="flex items-center mb-2">
            <div class="text-3xl mr-3">${quest.icon}</div>
            <div>
              <h3 class="font-bold text-lg text-white">${quest.name} ${quest.completed ? '✅' : ''}</h3>
              <p class="text-sm text-gray-300">${quest.description}</p>
            </div>
          </div>
          <div class="mt-2">
            <div class="h-2 w-full bg-gray-900/50 dark:bg-gray-800/50 rounded-full overflow-hidden">
              <div class="h-full ${quest.completed ? 'bg-amber-500' : 'bg-gray-400 dark:bg-gray-600'} rounded-full" style="width: ${percentage}%"></div>
            </div>
            <p class="text-xs text-right mt-1 ${quest.completed ? 'text-amber-300' : 'text-gray-300'}">${progress}/${quest.requirement}</p>
          </div>
          ${quest.completed ? `<p class="text-sm text-amber-300 mt-2">
            ${quest.coinReward ? `+${quest.coinReward} 🪙` : ''}
            ${quest.xpReward ? `+${quest.xpReward} XP` : ''}
          </p>` : ''}
        `;
        
        container.appendChild(questEl);
      });
    }
    
    // Show quests modal
    function showQuestsModal() {
      renderQuests();
      document.getElementById('questCoins').textContent = gameCoins;
      document.getElementById('questsModal').classList.remove('hidden');
    }
    
    // Hide quests modal
    function hideQuestsModal() {
      document.getElementById('questsModal').classList.add('hidden');
    }
    
    // Update all coins displays
    function updateCoinsDisplay() {
      document.getElementById('coinDisplay').textContent = gameCoins;
      
      // Update in modals if they exist
      if (document.getElementById('questCoins')) {
        document.getElementById('questCoins').textContent = gameCoins;
      }
      if (document.getElementById('shopCoins')) {
        document.getElementById('shopCoins').textContent = gameCoins;
      }
      if (document.getElementById('marketCoins')) {
        document.getElementById('marketCoins').textContent = gameCoins;
      }
    }
    
    // Generate random market items
    function generateMarketItems() {
      // Clear existing items
      marketItems = [];
      
      // Random number of items (3-6)
      const numItems = 3 + Math.floor(Math.random() * 4);
      
      // Generate random sellers
      const sellerNames = ['NeongMaster', 'SynthWaver', 'RetroGamer', 'VaporFan', 'CyberPunk2023'];
      
      // Possible accessories
      const marketAccessories = [
        { emoji: '👑', name: 'Couronne Néon', rarity: 'legendary', price: Math.floor(280 + Math.random() * 50) },
        { emoji: '🎩', name: 'Chapeau Rétro', rarity: 'rare', price: Math.floor(80 + Math.random() * 20) },
        { emoji: '🧢', name: 'Casquette Cyberpunk', rarity: 'common', price: Math.floor(20 + Math.random() * 10) },
        { emoji: '🕶️', name: 'Lunettes Futuristes', rarity: 'uncommon', price: Math.floor(40 + Math.random() * 15) },
        { emoji: '🧣', name: 'Écharpe Lumineuse', rarity: 'common', price: Math.floor(15 + Math.random() * 10) },
        { emoji: '🦺', name: 'Gilet Fluo', rarity: 'uncommon', price: Math.floor(35 + Math.random() * 15) },
        { emoji: '👔', name: 'Cravate LED', rarity: 'rare', price: Math.floor(60 + Math.random() * 20) },
        { emoji: '🎀', name: 'Nœud Électronique', rarity: 'rare', price: Math.floor(70 + Math.random() * 20) },
        { emoji: '👓', name: 'Lunettes Neon', rarity: 'common', price: Math.floor(25 + Math.random() * 10) },
        { emoji: '🧤', name: 'Gants Tactiles', rarity: 'uncommon', price: Math.floor(45 + Math.random() * 15) },
        { emoji: '💎', name: 'Cristal Holographique', rarity: 'epic', price: Math.floor(150 + Math.random() * 50) }
      ];
      
      // Generate random items
      for (let i = 0; i < numItems; i++) {
        const item = marketAccessories[Math.floor(Math.random() * marketAccessories.length)];
        
        marketItems.push({
          id: 'market_' + Date.now() + '_' + i,
          emoji: item.emoji,
          name: item.name,
          rarity: item.rarity,
          price: item.price,
          type: 'accessory',
          seller: sellerNames[Math.floor(Math.random() * sellerNames.length)]
        });
      }
    }
    
    // Render market items
    function renderMarketItems() {
      const container = document.getElementById('marketItemsList');
      container.innerHTML = '';
      
      if (marketItems.length === 0) {
        container.innerHTML = '<p class="text-center py-4 text-gray-300">Aucun objet disponible. Actualisez le marché.</p>';
        return;
      }
      
      // Color classes for different rarity levels
      const rarityClasses = {
        common: 'text-gray-300',
        uncommon: 'text-green-300',
        rare: 'text-synthwave-blue',
        epic: 'text-synthwave-purple',
        legendary: 'text-yellow-300'
      };
      
      marketItems.forEach(item => {
        const itemEl = document.createElement('div');
        itemEl.className = 'p-4 bg-black/40 dark:bg-gray-900/40 rounded-xl border border-white/10 backdrop-blur-md';
        
        itemEl.innerHTML = `
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <div class="text-3xl mr-3 ${item.rarity === 'legendary' ? 'animate-pulse' : ''}">${item.emoji}</div>
              <div>
                <h3 class="font-bold ${rarityClasses[item.rarity] || ''}">${item.name}</h3>
                <p class="text-xs text-gray-400">${item.seller}</p>
                <p class="text-xs ${rarityClasses[item.rarity] || ''} font-medium">${item.rarity.charAt(0).toUpperCase() + item.rarity.slice(1)}</p>
              </div>
            </div>
            <button class="market-buy-btn px-3 py-1 ${gameCoins >= item.price ? 'bg-success hover:bg-success/80' : 'bg-gray-500/50 cursor-not-allowed'} text-white rounded-lg flex items-center" data-item-id="${item.id}" ${gameCoins < item.price ? 'disabled' : ''}>
              <span>${item.price}</span>
              <span class="ml-1">🪙</span>
            </button>
          </div>
        `;
        
        container.appendChild(itemEl);
      });
      
      // Add event listeners to buy buttons
      document.querySelectorAll('.market-buy-btn').forEach(btn => {
        if (!btn.disabled) {
          btn.addEventListener('click', function() {
            const itemId = this.dataset.itemId;
            buyMarketItem(itemId);
          });
        }
      });
    }
    
    // Buy an item from the market
    function buyMarketItem(itemId) {
      if (!selectedPet) {
        alert('Veuillez d\'abord sélectionner un EmojiPet');
        return;
      }
      
      const item = marketItems.find(i => i.id === itemId);
      if (!item) return;
      
      // Check if player has enough coins
      if (gameCoins < item.price) {
        return;
      }
      
      // Deduct coins
      gameCoins -= item.price;
      updateCoinsDisplay();
      
      // Find pet
      const pet = pets.find(p => p.id === selectedPet.id);
      if (!pet) return;
      
      // Apply item effect (for now, only accessories)
      pet.accessory = item.emoji;
      
      // Remove item from market
      marketItems = marketItems.filter(i => i.id !== itemId);
      
      // Update UI
      savePets();
      renderPets();
      renderPetDetails(pet);
      renderMarketItems();
      
      // Show success animation with equipped accessory
      showItemEquipAnimation(item.emoji, pet);
      
      // Show toast message
      showToast(`${item.emoji} ${item.name} acheté et équipé à ${pet.name}!`);
      
      // Update quest progress for buying an accessory
      updateQuest('buyAccessory', 1);
    }
    
    // Show item equip animation
    function showItemEquipAnimation(itemEmoji, pet) {
      const petEl = document.querySelector(`[data-pet-id="${pet.id}"]`);
      if (!petEl) return;
      
      // Create floating animation for the item
      const animation = document.createElement('div');
      animation.className = 'absolute';
      animation.textContent = itemEmoji;
      animation.style.fontSize = '2rem';
      animation.style.zIndex = '100';
      animation.style.left = '50%';
      animation.style.top = '50%';
      animation.style.transform = 'translate(-50%, -50%)';
      
      petEl.appendChild(animation);
      
      // Animate the item floating onto the pet
      animation.animate([
        { transform: 'translate(-50%, -150%)', opacity: 0 },
        { transform: 'translate(-50%, -70%)', opacity: 1 },
        { transform: 'translate(-50%, -50%)', opacity: 0 }
      ], {
        duration: 1500,
        easing: 'cubic-bezier(0.175, 0.885, 0.32, 1.275)'
      }).onfinish = () => animation.remove();
      
      // Add a sparkle effect
      const sparkle = document.createElement('div');
      sparkle.className = 'absolute inset-0 flex items-center justify-center';
      sparkle.innerHTML = '✨';
      sparkle.style.fontSize = '3rem';
      sparkle.style.opacity = '0';
      sparkle.style.zIndex = '90';
      
      petEl.appendChild(sparkle);
      
      sparkle.animate([
        { transform: 'scale(0.5)', opacity: 0 },
        { transform: 'scale(1.5)', opacity: 1 },
        { transform: 'scale(2)', opacity: 0 }
      ], {
        duration: 1200,
        easing: 'ease-out'
      }).onfinish = () => sparkle.remove();
    }
    
    // Show market modal
    function showMarketModal() {
      if (marketItems.length === 0) {
        generateMarketItems();
      }
      
      document.getElementById('marketCoins').textContent = gameCoins;
      renderMarketItems();
      document.getElementById('marketModal').classList.remove('hidden');
    }
    
    // Hide market modal
    function hideMarketModal() {
      document.getElementById('marketModal').classList.add('hidden');
    }
    
    // Delete the selected pet
    function deleteSelectedPet() {
      if (!selectedPet) return;
      
      // If the pet is married, update its partner
      if (selectedPet.marriedTo) {
        const partner = pets.find(p => p.id === selectedPet.marriedTo);
        if (partner) {
          partner.marriedTo = null;
        }
      }
      
      // Remove the pet from array
      pets = pets.filter(p => p.id !== selectedPet.id);
      
      // Save changes
      savePets();
      
      // Update UI
      hideDeleteConfirmation();
      document.getElementById('selectedPetInfo').classList.add('hidden');
      document.getElementById('noSelection').classList.remove('hidden');
      selectedPet = null;
      
      // Re-render pets
      renderPets();
    }
    
    // Make pet sleep to restore energy
    function sleepPet() {
      if (!selectedPet) return;
      
      const pet = pets.find(p => p.id === selectedPet.id);
      if (pet) {
        pet.energy = 100;
        pet.xp += 5;
        pet.lastInteraction = Date.now();
        
        updatePetMood(pet);
        savePets();
        renderPetDetails(pet);
        updateNeedsUI(pet);
        renderPets();
        
        // Animation
        showActionAnimation('😴');
        
        // Show sleeping animation on the pet
        const petEl = document.querySelector(`[data-pet-id="${pet.id}"]`);
        if (petEl) {
          const emojiEl = petEl.querySelector('.emoji-display');
          
          // Add Z's animation
          const zs = document.createElement('div');
          zs.className = 'absolute -top-4 right-0 text-xl';
          zs.innerHTML = '💤';
          zs.style.animation = 'float 2s ease-in-out infinite';
          petEl.appendChild(zs);
          
          // Remove after a few seconds
          setTimeout(() => {
            zs.remove();
          }, 4000);
        }
      }
    }
    
    // Shop modal
    function showShopModal() {
      // Create modal if it doesn't exist
      if (!document.getElementById('shopModal')) {
        const shopModal = document.createElement('div');
        shopModal.id = 'shopModal';
        shopModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden';
        
        shopModal.innerHTML = `
          <div class="ios-card p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-2xl font-semibold flex items-center text-white">
                <span class="mr-2">🛒</span>
                Boutique
              </h2>
              <div class="bg-amber-900/40 px-3 py-1 rounded-full text-amber-200 font-medium backdrop-blur-sm border border-amber-500/20">
                <span id="shopCoins">${gameCoins}</span> 🪙
              </div>
            </div>
            
            <div id="shopItemsList" class="space-y-4 mb-6">
              <!-- Shop items will be listed here -->
            </div>
            
            <button id="closeShop" class="ios-button synthwave-button w-full py-3 px-4 bg-synthwave-blue hover:bg-synthwave-blue/90 text-white font-medium">
              Fermer
            </button>
          </div>
        `;
        
        document.body.appendChild(shopModal);
        
        // Add event listener to close button
        document.getElementById('closeShop').addEventListener('click', hideShopModal);
      }
      
      // Update coins display
      document.getElementById('shopCoins').textContent = gameCoins;
      document.getElementById('coinDisplay').textContent = gameCoins;
      
      // Render shop items
      renderShopItems();
      
      // Show the modal
      document.getElementById('shopModal').classList.remove('hidden');
    }
    
    // Hide shop modal
    function hideShopModal() {
      document.getElementById('shopModal').classList.add('hidden');
    }
    
    // Render shop items
    function renderShopItems() {
      const container = document.getElementById('shopItemsList');
      container.innerHTML = '';
      
      shopItems.forEach(item => {
        const itemEl = document.createElement('div');
        itemEl.className = 'p-4 bg-black/40 dark:bg-gray-900/40 rounded-xl border border-white/10 backdrop-blur-md flex items-center justify-between';
        
        itemEl.innerHTML = `
          <div class="flex items-center">
            <div class="text-3xl mr-3">${item.emoji}</div>
            <div>
              <h3 class="font-bold text-white">${item.name}</h3>
              <p class="text-sm text-gray-300">${item.description}</p>
            </div>
          </div>
          <button class="buy-item-btn px-3 py-1 ${gameCoins >= item.price ? 'bg-success hover:bg-success/80' : 'bg-gray-500/50 cursor-not-allowed'} text-white rounded-lg flex items-center" data-item-id="${item.id}" ${gameCoins < item.price ? 'disabled' : ''}>
            <span>${item.price}</span>
            <span class="ml-1">🪙</span>
          </button>
        `;
        
        container.appendChild(itemEl);
      });
      
      // Add event listeners to buy buttons
      document.querySelectorAll('.buy-item-btn').forEach(btn => {
        if (!btn.disabled) {
          btn.addEventListener('click', function() {
            const itemId = this.dataset.itemId;
            buyItem(itemId);
          });
        }
      });
    }
    
    // Buy an item from the shop
    function buyItem(itemId) {
      if (!selectedPet) {
        alert('Veuillez d\'abord sélectionner un EmojiPet');
        return;
      }
      
      const item = shopItems.find(i => i.id === itemId);
      if (!item) return;
      
      // Check if player has enough coins
      if (gameCoins < item.price) {
        return;
      }
      
      // Deduct coins
      gameCoins -= item.price;
      
      // Update coins display
      document.getElementById('shopCoins').textContent = gameCoins;
      document.getElementById('coinDisplay').textContent = gameCoins;
      
      // Find pet
      const pet = pets.find(p => p.id === selectedPet.id);
      if (!pet) return;
      
      // Apply item effect
      if (item.type === 'accessory') {
        // Add accessory to pet
        pet.accessory = item.emoji;
        
        // Show success message
        showToast(`${item.emoji} ${item.name} équipé à ${pet.name}!`);
      } else if (item.type === 'potion') {
        // Apply potion effect
        const result = item.effect(pet);
        
        // Show success message
        showToast(`${item.emoji} ${result}`);
      }
      
      // Update UI
      savePets();
      renderPets();
      renderPetDetails(pet);
      updateNeedsUI(pet);
      
      // Disable the buy button if player doesn't have enough coins
      document.querySelectorAll('.buy-item-btn').forEach(btn => {
        const btnItemId = btn.dataset.itemId;
        const btnItem = shopItems.find(i => i.id === btnItemId);
        
        if (gameCoins < btnItem.price) {
          btn.disabled = true;
          btn.classList.remove('bg-success', 'hover:bg-success/80');
          btn.classList.add('bg-gray-500/50', 'cursor-not-allowed');
        }
      });
      
      // Animation
      showActionAnimation(item.emoji);
    }
    
    // Show toast message
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-black/80 backdrop-blur-lg text-white py-2 px-4 rounded-lg z-50 border border-synthwave-purple/50';
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      // Remove after 3 seconds
      setTimeout(() => {
        toast.classList.add('opacity-0');
        toast.style.transition = 'opacity 0.5s ease';
        
        setTimeout(() => {
          toast.remove();
        }, 500);
      }, 3000);
    }
    
    // Add event listeners for new buttons
    document.getElementById('sleepPet').addEventListener('click', sleepPet);
    document.getElementById('shopButton').addEventListener('click', showShopModal);
    
    // Start the game
    initGame();
  </script>
</body>
</html>
