<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>EmojiPet - Le jeu d'animaux virtuels</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            primary: '#5D5CDE',
            secondary: '#3e3e9e',
            oneui: {
              light: {
                bg: '#ffffff',
                card: '#f5f6f7',
                text: '#000000',
                border: '#e1e2e3'
              },
              dark: {
                bg: '#181818',
                card: '#2d2d2d',
                text: '#e1e2e3',
                border: '#404040'
              }
            }
          },
          animation: {
            'bounce-slow': 'bounce 2s infinite',
            'spin-slow': 'spin 3s linear infinite',
            'pulse-slow': 'pulse 3s infinite',
            'wiggle': 'wiggle 1s ease-in-out',
            'float': 'float 3s ease-in-out infinite',
          },
          keyframes: {
            wiggle: {
              '0%, 100%': { transform: 'rotate(-3deg)' },
              '50%': { transform: 'rotate(3deg)' },
            },
            float: {
              '0%, 100%': { transform: 'translateY(0)' },
              '50%': { transform: 'translateY(-10px)' },
            }
          }
        }
      }
    }
  </script>
  <style>
    /* Phoenix fire animation */
    @keyframes phoenix-fire {
      0% { text-shadow: 0 0 5px #ff0000, 0 0 10px #ff4000; }
      25% { text-shadow: 0 0 8px #ff8000, 0 0 15px #ffa500; }
      50% { text-shadow: 0 0 10px #ffb700, 0 0 20px #ffd700; }
      75% { text-shadow: 0 0 8px #ff8000, 0 0 15px #ffa500; }
      100% { text-shadow: 0 0 5px #ff0000, 0 0 10px #ff4000; }
    }
    
    /* Shark swimming animation */
    @keyframes shark-swim {
      0% { 
        transform: perspective(800px) rotateY(15deg) rotateX(10deg) translateX(-5px); 
        text-shadow: 0 0 8px rgba(0, 120, 215, 0.6);
      }
      25% {
        transform: perspective(800px) rotateY(10deg) rotateX(5deg) translateX(0px);
        text-shadow: 0 0 12px rgba(0, 120, 215, 0.7);
      }
      50% { 
        transform: perspective(800px) rotateY(15deg) rotateX(10deg) translateX(5px); 
        text-shadow: 0 0 8px rgba(0, 120, 215, 0.6);
      }
      75% {
        transform: perspective(800px) rotateY(20deg) rotateX(15deg) translateX(0px);
        text-shadow: 0 0 12px rgba(0, 120, 215, 0.7);
      }
      100% { 
        transform: perspective(800px) rotateY(15deg) rotateX(10deg) translateX(-5px); 
        text-shadow: 0 0 8px rgba(0, 120, 215, 0.6);
      }
    }
    
    .phoenix-emoji {
      animation: phoenix-fire 2s infinite;
    }
    
    .phoenix-pet {
      animation: phoenix-fire 2s infinite !important;
    }
    
    .shark-emoji {
      animation: shark-swim 4s ease-in-out infinite;
    }
    
    .shark-pet {
      animation: shark-swim 4s ease-in-out infinite !important;
    }
    
    /* Add water-like bubbles for the shark */
    .shark-pet::before,
    .shark-emoji::before {
      content: 'ü´ß';
      position: absolute;
      font-size: 0.8rem;
      top: -10px;
      right: -8px;
      opacity: 0.8;
      animation: float 3s ease-in-out infinite;
    }
    
    /* RGB Theme Effects */
    @keyframes rgbText {
      0% { color: #ff0000; }
      16% { color: #ff8000; }
      33% { color: #ffff00; }
      50% { color: #00ff00; }
      66% { color: #00ffff; }
      83% { color: #0000ff; }
      100% { color: #ff00ff; }
    }
    
    @keyframes rgbBorder {
      0% { border-color: #ff0000; box-shadow: 0 0 8px #ff0000; }
      16% { border-color: #ff8000; box-shadow: 0 0 8px #ff8000; }
      33% { border-color: #ffff00; box-shadow: 0 0 8px #ffff00; }
      50% { border-color: #00ff00; box-shadow: 0 0 8px #00ff00; }
      66% { border-color: #00ffff; box-shadow: 0 0 8px #00ffff; }
      83% { border-color: #0000ff; box-shadow: 0 0 8px #0000ff; }
      100% { border-color: #ff00ff; box-shadow: 0 0 8px #ff00ff; }
    }
    
    @keyframes rgbShadow {
      0% { text-shadow: 0 0 8px #ff0000; }
      16% { text-shadow: 0 0 8px #ff8000; }
      33% { text-shadow: 0 0 8px #ffff00; }
      50% { text-shadow: 0 0 8px #00ff00; }
      66% { text-shadow: 0 0 8px #00ffff; }
      83% { text-shadow: 0 0 8px #0000ff; }
      100% { text-shadow: 0 0 8px #ff00ff; }
    }
    
    .rgb-mode .emoji-display {
      animation: rgbShadow 5s linear infinite;
    }
    
    .rgb-mode .oneui-card {
      border: 2px solid transparent;
      animation: rgbBorder 5s linear infinite;
    }
    
    .rgb-mode #gameTitle {
      animation: rgbText 5s linear infinite;
    }
    
    .emoji-display {
      transition: all 0.3s ease;
      transform-style: preserve-3d;
      position: relative;
    }
    
    .emoji-3d {
      transform: perspective(800px) rotateY(15deg) rotateX(10deg);
      box-shadow: -10px 10px 15px rgba(0, 0, 0, 0.2);
    }
    
    .emoji-selected {
      animation: pulsate 1s ease-in-out infinite alternate;
    }
    
    .rgb-mode .emoji-selected {
      animation: rgbShadow 3s linear infinite !important;
    }
    
    .emoji-married::after {
      content: 'üíç';
      position: absolute;
      bottom: -15px;
      right: -15px;
      font-size: 1.2rem;
      transform: rotate(-15deg);
      animation: shine 2s ease-in-out infinite;
    }
    
    .emoji-container {
      position: relative;
      transition: transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    
    .emoji-container:hover {
      transform: scale(1.1) rotate(5deg);
    }
    
    .emoji-container:active {
      transform: scale(0.95);
    }
    
    .country-flag {
      position: absolute;
      top: -10px;
      left: -10px;
      font-size: 1rem;
      filter: drop-shadow(1px 1px 1px rgba(0,0,0,0.3));
    }
    
    @keyframes pulsate {
      0% { transform: scale(1); text-shadow: 0 0 5px rgba(93, 92, 222, 0.5); }
      100% { transform: scale(1.1); text-shadow: 0 0 10px rgba(93, 92, 222, 0.8); }
    }
    
    @keyframes shine {
      0% { opacity: 0.8; transform: rotate(-15deg) scale(1); }
      50% { opacity: 1; transform: rotate(-15deg) scale(1.2); }
      100% { opacity: 0.8; transform: rotate(-15deg) scale(1); }
    }
    
    .oneui-card {
      border-radius: 25px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    .dark .oneui-card {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }
    
    .oneui-button {
      border-radius: 25px;
      transition: all 0.2s ease;
    }
    
    .oneui-button:active {
      transform: scale(0.95);
    }
    
    .emoji-evolution-progress {
      width: 100%;
      height: 8px;
      border-radius: 4px;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.1);
    }
    
    .dark .emoji-evolution-progress {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .emoji-evolution-bar {
      height: 100%;
      border-radius: 4px;
      background: linear-gradient(to right, #5D5CDE, #9f9ef5);
      transition: width 0.5s ease;
    }
    
    /* Pseudo-3D shadow effect */
    .shadow-3d {
      position: relative;
    }
    
    .shadow-3d::after {
      content: '';
      position: absolute;
      width: 80%;
      height: 15px;
      border-radius: 50%;
      bottom: -15px;
      left: 10%;
      background: rgba(0, 0, 0, 0.15);
      filter: blur(5px);
      z-index: -1;
      transition: all 0.3s ease;
    }
    
    .emoji-action {
      transition: all 0.3s ease;
    }
    
    .emoji-action:hover {
      transform: translateY(-3px);
    }
    
    .emoji-action:active {
      transform: translateY(1px);
    }
    
    /* Mood indications */
    .mood-indicator {
      position: absolute;
      top: -15px;
      right: -10px;
      font-size: 1rem;
      animation: float 3s ease-in-out infinite;
    }
  </style>
</head>
<body class="font-sans bg-oneui-light-bg dark:bg-oneui-dark-bg text-oneui-light-text dark:text-oneui-dark-text transition-colors duration-300">
  <div class="min-h-screen p-4 md:p-8">
    <!-- Header -->
    <header class="flex flex-col sm:flex-row justify-between items-center mb-6">
      <h1 id="gameTitle" class="text-3xl font-bold text-primary mb-2 sm:mb-0">EmojiPet</h1>
      <div class="flex space-x-2">
        <button id="achievementsButton" class="p-3 rounded-full bg-oneui-light-card dark:bg-oneui-dark-card">
          <span class="text-xl">üèÜ</span>
        </button>
        <button id="rgbModeToggle" class="p-3 rounded-full bg-oneui-light-card dark:bg-oneui-dark-card">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
          </svg>
        </button>
        <button id="darkModeToggle" class="p-3 rounded-full bg-oneui-light-card dark:bg-oneui-dark-card">
          <svg id="sunIcon" class="w-6 h-6 text-yellow-500 hidden dark:inline" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>
          <svg id="moonIcon" class="w-6 h-6 text-slate-700 inline dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
        </button>
      </div>
    </header>
    
    <!-- Main Game Container -->
    <main class="grid grid-cols-1 md:grid-cols-3 gap-6">
      <!-- My EmojiPets Panel -->
      <section class="oneui-card bg-oneui-light-card dark:bg-oneui-dark-card p-6 col-span-1 md:col-span-2">
        <h2 class="text-2xl font-semibold mb-4">Mes EmojiPets</h2>
        
        <div id="emojipetsContainer" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
          <!-- EmojiPets will be generated here -->
        </div>
        
        <button id="addEmojiPet" class="oneui-button mt-6 w-full py-3 bg-primary hover:bg-secondary text-white font-semibold transition-colors">
          Cr√©er un nouveau EmojiPet
        </button>
      </section>
      
      <!-- Action Panel -->
      <section class="oneui-card bg-oneui-light-card dark:bg-oneui-dark-card p-6">
        <h2 class="text-2xl font-semibold mb-4">Actions</h2>
        
        <div id="selectedPetInfo" class="hidden">
          <div class="flex items-center space-x-4 mb-6">
            <div id="selectedEmoji" class="text-6xl emoji-display shadow-3d"></div>
            <div>
              <h3 id="selectedName" class="text-xl font-bold"></h3>
              <p id="selectedCountry" class="text-sm opacity-70"></p>
              <p id="selectedMood" class="text-sm"></p>
            </div>
          </div>
          
          <!-- Niveaux et besoins -->
          <div class="mb-4">
            <div class="flex justify-between items-center">
              <p class="text-sm mb-1">Niveau d'√©volution</p>
              <p id="petLevel" class="text-sm font-bold text-primary">Niveau 1</p>
            </div>
            <div class="emoji-evolution-progress mb-1">
              <div id="evolutionBar" class="emoji-evolution-bar" style="width: 10%;"></div>
            </div>
            <p id="evolutionXP" class="text-xs text-gray-500 dark:text-gray-400">XP: 0/100</p>
          </div>
          
          <!-- Besoins -->
          <div class="grid grid-cols-2 gap-2 mb-4">
            <div>
              <div class="flex justify-between items-center">
                <span class="text-sm">üçî Faim</span>
                <span id="hungerValue" class="text-xs">100%</span>
              </div>
              <div class="h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                <div id="hungerBar" class="h-full bg-green-500 rounded-full" style="width: 100%"></div>
              </div>
            </div>
            
            <div>
              <div class="flex justify-between items-center">
                <span class="text-sm">üòä Bonheur</span>
                <span id="happinessValue" class="text-xs">100%</span>
              </div>
              <div class="h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                <div id="happinessBar" class="h-full bg-pink-500 rounded-full" style="width: 100%"></div>
              </div>
            </div>
            
            <div>
              <div class="flex justify-between items-center">
                <span class="text-sm">üöø Propret√©</span>
                <span id="cleanlinessValue" class="text-xs">100%</span>
              </div>
              <div class="h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                <div id="cleanlinessBar" class="h-full bg-blue-500 rounded-full" style="width: 100%"></div>
              </div>
            </div>
            
            <div>
              <div class="flex justify-between items-center">
                <span class="text-sm">‚ö° √ânergie</span>
                <span id="energyValue" class="text-xs">100%</span>
              </div>
              <div class="h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                <div id="energyBar" class="h-full bg-yellow-500 rounded-full" style="width: 100%"></div>
              </div>
            </div>
          </div>
          
          <div class="space-y-3">
            <button id="feedPet" class="oneui-button w-full py-2 px-4 bg-green-500 hover:bg-green-600 text-white font-medium emoji-action">
              üçî Nourrir
            </button>
            <button id="playWithPet" class="oneui-button w-full py-2 px-4 bg-blue-500 hover:bg-blue-600 text-white font-medium emoji-action">
              üéæ Jouer
            </button>
            <button id="cleanPet" class="oneui-button w-full py-2 px-4 bg-yellow-500 hover:bg-yellow-600 text-white font-medium emoji-action">
              üõÅ Nettoyer
            </button>
            <button id="sleepPet" class="oneui-button w-full py-2 px-4 bg-indigo-500 hover:bg-indigo-600 text-white font-medium emoji-action">
              üò¥ Faire dormir
            </button>
            <button id="complimentPet" class="oneui-button w-full py-2 px-4 bg-purple-500 hover:bg-purple-600 text-white font-medium emoji-action">
              üíå Lui parler
            </button>
            <button id="shopButton" class="oneui-button w-full py-2 px-4 bg-amber-500 hover:bg-amber-600 text-white font-medium emoji-action">
              üõí Boutique <span id="coinDisplay" class="ml-1 bg-yellow-300 text-amber-800 px-1 rounded-full text-xs">100</span>
            </button>
            <button id="marryPet" class="oneui-button w-full py-2 px-4 bg-pink-500 hover:bg-pink-600 text-white font-medium emoji-action">
              üíç Marier
            </button>
            <button id="deletePet" class="oneui-button w-full py-2 px-4 bg-red-500 hover:bg-red-600 text-white font-medium emoji-action">
              üóëÔ∏è Supprimer
            </button>
          </div>
        </div>
        
        <div id="noSelection" class="text-center py-12">
          <p class="text-lg text-gray-500 dark:text-gray-400">S√©lectionnez un EmojiPet pour interagir</p>
        </div>
      </section>
    </main>
    
    <!-- Creation Modal -->
    <div id="creationModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
      <div class="oneui-card bg-oneui-light-card dark:bg-oneui-dark-card p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
        <h2 class="text-2xl font-semibold mb-4">Cr√©er un EmojiPet</h2>
        
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium mb-1">Nom</label>
            <input id="petName" type="text" class="w-full p-3 rounded-xl border border-oneui-light-border dark:border-oneui-dark-border bg-white dark:bg-gray-800 text-base" placeholder="Nom de votre EmojiPet">
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1">Type d'animal</label>
            <div class="grid grid-cols-4 gap-2">
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üê∂</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üê±</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üê∞</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üêº</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">ü¶ä</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">ü¶Å</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üêÆ</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üê∑</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üêµ</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üêª</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üê®</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">ü¶ù</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üê≤</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">ü¶Ñ</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">ü¶í</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">ü¶ì</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üêò</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">ü¶î</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üê¢</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üê¨</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 phoenix-emoji">ü¶Ö</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 shark-emoji">ü¶à</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">ü¶ñ</button>
              <!-- Humains et emoji inclusifs -->
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üôé‚Äç‚ôÄÔ∏è</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üôé</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üôé‚Äç‚ôÇÔ∏è</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üßë‚Äçü¶Ω</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üë®‚Äçü¶Ω</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üë©‚Äçü¶º</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üßë‚Äçü¶º</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üë®‚Äçü¶Ø</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üßé‚Äç‚ôÄÔ∏è</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üë©‚Äç‚ù§Ô∏è‚Äçüë®</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üë©‚Äç‚ù§Ô∏è‚Äçüë©</button>
              <button class="emoji-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®</button>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1">Accessoire</label>
            <div class="grid grid-cols-4 gap-2">
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üé©</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üëë</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üß¢</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üï∂Ô∏è</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üß£</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">ü¶∫</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üëî</button>
              <button class="accessory-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">ü¶Æ</button>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1">Symbole religieux</label>
            <div class="grid grid-cols-4 gap-2">
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">‚úùÔ∏è</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">‚ò™Ô∏è</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">‚ú°Ô∏è</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üïâÔ∏è</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">‚ò∏Ô∏è</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">üïé</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">‚òØÔ∏è</button>
              <button class="religion-option p-2 text-2xl rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">‚ò¶Ô∏è</button>
            </div>
          </div>
          
          <div>
            <label class="block text-sm font-medium mb-1">Pays d'origine</label>
            <select id="petCountry" class="w-full p-3 rounded-xl border border-oneui-light-border dark:border-oneui-dark-border bg-white dark:bg-gray-800 text-base">
              <option value="üá¶üá´">Afghanistan üá¶üá´</option>
              <option value="üáøüá¶">Afrique du Sud üáøüá¶</option>
              <option value="üá¶üá±">Albanie üá¶üá±</option>
              <option value="üá©üáø">Alg√©rie üá©üáø</option>
              <option value="üá©üá™">Allemagne üá©üá™</option>
              <option value="üá¶üá©">Andorre üá¶üá©</option>
              <option value="üá¶üá¥">Angola üá¶üá¥</option>
              <option value="üá¶üá¨">Antigua-et-Barbuda üá¶üá¨</option>
              <option value="üá∏üá¶">Arabie Saoudite üá∏üá¶</option>
              <option value="üá¶üá∑">Argentine üá¶üá∑</option>
              <option value="üá¶üá≤">Arm√©nie üá¶üá≤</option>
              <option value="üá¶üá∫">Australie üá¶üá∫</option>
              <option value="üá¶üáπ">Autriche üá¶üáπ</option>
              <option value="üá¶üáø">Azerba√Ødjan üá¶üáø</option>
              <option value="üáßüá∏">Bahamas üáßüá∏</option>
              <option value="üáßüá≠">Bahre√Øn üáßüá≠</option>
              <option value="üáßüá©">Bangladesh üáßüá©</option>
              <option value="üáßüáß">Barbade üáßüáß</option>
              <option value="üáßüá™">Belgique üáßüá™</option>
              <option value="üáßüáø">Belize üáßüáø</option>
              <option value="üáßüáØ">B√©nin üáßüáØ</option>
              <option value="üáßüáπ">Bhoutan üáßüáπ</option>
              <option value="üáßüáæ">Bi√©lorussie üáßüáæ</option>
              <option value="üá≤üá≤">Birmanie üá≤üá≤</option>
              <option value="üáßüá¥">Bolivie üáßüá¥</option>
              <option value="üáßüá¶">Bosnie-Herz√©govine üáßüá¶</option>
              <option value="üáßüáº">Botswana üáßüáº</option>
              <option value="üáßüá∑">Br√©sil üáßüá∑</option>
              <option value="üáßüá≥">Brunei üáßüá≥</option>
              <option value="üáßüá¨">Bulgarie üáßüá¨</option>
              <option value="üáßüá´">Burkina Faso üáßüá´</option>
              <option value="üáßüáÆ">Burundi üáßüáÆ</option>
              <option value="üá∞üá≠">Cambodge üá∞üá≠</option>
              <option value="üá®üá≤">Cameroun üá®üá≤</option>
              <option value="üá®üá¶">Canada üá®üá¶</option>
              <option value="üá®üáª">Cap-Vert üá®üáª</option>
              <option value="üá®üá´">R√©publique centrafricaine üá®üá´</option>
              <option value="üá®üá±">Chili üá®üá±</option>
              <option value="üá®üá≥">Chine üá®üá≥</option>
              <option value="üá®üáæ">Chypre üá®üáæ</option>
              <option value="üá®üá¥">Colombie üá®üá¥</option>
              <option value="üá∞üá≤">Comores üá∞üá≤</option>
              <option value="üá®üá¨">R√©publique du Congo üá®üá¨</option>
              <option value="üá®üá©">R√©publique d√©mocratique du Congo üá®üá©</option>
              <option value="üá∞üáµ">Cor√©e du Nord üá∞üáµ</option>
              <option value="üá∞üá∑">Cor√©e du Sud üá∞üá∑</option>
              <option value="üá®üá∑">Costa Rica üá®üá∑</option>
              <option value="üá®üáÆ">C√¥te d'Ivoire üá®üáÆ</option>
              <option value="üá≠üá∑">Croatie üá≠üá∑</option>
              <option value="üá®üá∫">Cuba üá®üá∫</option>
              <option value="üá©üá∞">Danemark üá©üá∞</option>
              <option value="üá©üáØ">Djibouti üá©üáØ</option>
              <option value="üá©üá≤">Dominique üá©üá≤</option>
              <option value="üá™üá¨">√âgypte üá™üá¨</option>
              <option value="üá¶üá™">√âmirats arabes unis üá¶üá™</option>
              <option value="üá™üá®">√âquateur üá™üá®</option>
              <option value="üá™üá∑">√ârythr√©e üá™üá∑</option>
              <option value="üá™üá∏">Espagne üá™üá∏</option>
              <option value="üá™üá™">Estonie üá™üá™</option>
              <option value="üá∏üáø">Eswatini üá∏üáø</option>
              <option value="üá∫üá∏">√âtats-Unis üá∫üá∏</option>
              <option value="üá™üáπ">√âthiopie üá™üáπ</option>
              <option value="üá´üáØ">Fidji üá´üáØ</option>
              <option value="üá´üáÆ">Finlande üá´üáÆ</option>
              <option value="üá´üá∑">France üá´üá∑</option>
              <option value="üá¨üá¶">Gabon üá¨üá¶</option>
              <option value="üá¨üá≤">Gambie üá¨üá≤</option>
              <option value="üá¨üá™">G√©orgie üá¨üá™</option>
              <option value="üá¨üá≠">Ghana üá¨üá≠</option>
              <option value="üá¨üá∑">Gr√®ce üá¨üá∑</option>
              <option value="üá¨üá©">Grenade üá¨üá©</option>
              <option value="üá¨üáπ">Guatemala üá¨üáπ</option>
              <option value="üá¨üá≥">Guin√©e üá¨üá≥</option>
              <option value="üá¨üá∂">Guin√©e √©quatoriale üá¨üá∂</option>
              <option value="üá¨üáº">Guin√©e-Bissau üá¨üáº</option>
              <option value="üá¨üáæ">Guyana üá¨üáæ</option>
              <option value="üá≠üáπ">Ha√Øti üá≠üáπ</option>
              <option value="üá≠üá≥">Honduras üá≠üá≥</option>
              <option value="üá≠üá∫">Hongrie üá≠üá∫</option>
              <option value="üáÆüá≥">Inde üáÆüá≥</option>
              <option value="üáÆüá©">Indon√©sie üáÆüá©</option>
              <option value="üáÆüá∂">Irak üáÆüá∂</option>
              <option value="üáÆüá∑">Iran üáÆüá∑</option>
              <option value="üáÆüá™">Irlande üáÆüá™</option>
              <option value="üáÆüá∏">Islande üáÆüá∏</option>
              <option value="üáÆüá±">Isra√´l üáÆüá±</option>
              <option value="üáÆüáπ">Italie üáÆüáπ</option>
              <option value="üáØüá≤">Jama√Øque üáØüá≤</option>
              <option value="üáØüáµ">Japon üáØüáµ</option>
              <option value="üáØüá¥">Jordanie üáØüá¥</option>
              <option value="üá∞üáø">Kazakhstan üá∞üáø</option>
              <option value="üá∞üá™">Kenya üá∞üá™</option>
              <option value="üá∞üá¨">Kirghizistan üá∞üá¨</option>
              <option value="üá∞üáÆ">Kiribati üá∞üáÆ</option>
              <option value="üá∞üáº">Kowe√Øt üá∞üáº</option>
              <option value="üá±üá¶">Laos üá±üá¶</option>
              <option value="üá±üá∏">Lesotho üá±üá∏</option>
              <option value="üá±üáª">Lettonie üá±üáª</option>
              <option value="üá±üáß">Liban üá±üáß</option>
              <option value="üá±üá∑">Liberia üá±üá∑</option>
              <option value="üá±üáæ">Libye üá±üáæ</option>
              <option value="üá±üáÆ">Liechtenstein üá±üáÆ</option>
              <option value="üá±üáπ">Lituanie üá±üáπ</option>
              <option value="üá±üá∫">Luxembourg üá±üá∫</option>
              <option value="üá≤üá∞">Mac√©doine du Nord üá≤üá∞</option>
              <option value="üá≤üá¨">Madagascar üá≤üá¨</option>
              <option value="üá≤üáæ">Malaisie üá≤üáæ</option>
              <option value="üá≤üáº">Malawi üá≤üáº</option>
              <option value="üá≤üáª">Maldives üá≤üáª</option>
              <option value="üá≤üá±">Mali üá≤üá±</option>
              <option value="üá≤üáπ">Malte üá≤üáπ</option>
              <option value="üá≤üá¶">Maroc üá≤üá¶</option>
              <option value="üá≤üá≠">√éles Marshall üá≤üá≠</option>
              <option value="üá≤üá∫">Maurice üá≤üá∫</option>
              <option value="üá≤üá∑">Mauritanie üá≤üá∑</option>
              <option value="üá≤üáΩ">Mexique üá≤üáΩ</option>
              <option value="üá´üá≤">Micron√©sie üá´üá≤</option>
              <option value="üá≤üá©">Moldavie üá≤üá©</option>
              <option value="üá≤üá®">Monaco üá≤üá®</option>
              <option value="üá≤üá≥">Mongolie üá≤üá≥</option>
              <option value="üá≤üá™">Mont√©n√©gro üá≤üá™</option>
              <option value="üá≤üáø">Mozambique üá≤üáø</option>
              <option value="üá≥üá¶">Namibie üá≥üá¶</option>
              <option value="üá≥üá∑">Nauru üá≥üá∑</option>
              <option value="üá≥üáµ">N√©pal üá≥üáµ</option>
              <option value="üá≥üáÆ">Nicaragua üá≥üáÆ</option>
              <option value="üá≥üá™">Niger üá≥üá™</option>
              <option value="üá≥üá¨">Nigeria üá≥üá¨</option>
              <option value="üá≥üá¥">Norv√®ge üá≥üá¥</option>
              <option value="üá≥üáø">Nouvelle-Z√©lande üá≥üáø</option>
              <option value="üá¥üá≤">Oman üá¥üá≤</option>
              <option value="üá∫üá¨">Ouganda üá∫üá¨</option>
              <option value="üá∫üáø">Ouzb√©kistan üá∫üáø</option>
              <option value="üáµüá∞">Pakistan üáµüá∞</option>
              <option value="üáµüáº">Palaos üáµüáº</option>
              <option value="üáµüá¶">Panama üáµüá¶</option>
              <option value="üáµüá¨">Papouasie-Nouvelle-Guin√©e üáµüá¨</option>
              <option value="üáµüáæ">Paraguay üáµüáæ</option>
              <option value="üá≥üá±">Pays-Bas üá≥üá±</option>
              <option value="üáµüá™">P√©rou üáµüá™</option>
              <option value="üáµüá≠">Philippines üáµüá≠</option>
              <option value="üáµüá±">Pologne üáµüá±</option>
              <option value="üáµüáπ">Portugal üáµüáπ</option>
              <option value="üá∂üá¶">Qatar üá∂üá¶</option>
              <option value="üá∑üá¥">Roumanie üá∑üá¥</option>
              <option value="üá¨üáß">Royaume-Uni üá¨üáß</option>
              <option value="üá∑üá∫">Russie üá∑üá∫</option>
              <option value="üá∑üáº">Rwanda üá∑üáº</option>
              <option value="üá∞üá≥">Saint-Kitts-et-Nevis üá∞üá≥</option>
              <option value="üá±üá®">Sainte-Lucie üá±üá®</option>
              <option value="üáªüá®">Saint-Vincent-et-les-Grenadines üáªüá®</option>
              <option value="üá∏üá≤">Saint-Marin üá∏üá≤</option>
              <option value="üá∏üáß">√éles Salomon üá∏üáß</option>
              <option value="üá∏üáª">Salvador üá∏üáª</option>
              <option value="üáºüá∏">Samoa üáºüá∏</option>
              <option value="üá∏üáπ">Sao Tom√©-et-Principe üá∏üáπ</option>
              <option value="üá∏üá≥">S√©n√©gal üá∏üá≥</option>
              <option value="üá∑üá∏">Serbie üá∑üá∏</option>
              <option value="üá∏üá®">Seychelles üá∏üá®</option>
              <option value="üá∏üá±">Sierra Leone üá∏üá±</option>
              <option value="üá∏üá¨">Singapour üá∏üá¨</option>
              <option value="üá∏üá∞">Slovaquie üá∏üá∞</option>
              <option value="üá∏üáÆ">Slov√©nie üá∏üáÆ</option>
              <option value="üá∏üá¥">Somalie üá∏üá¥</option>
              <option value="üá∏üá©">Soudan üá∏üá©</option>
              <option value="üá∏üá∏">Soudan du Sud üá∏üá∏</option>
              <option value="üá±üá∞">Sri Lanka üá±üá∞</option>
              <option value="üá∏üá™">Su√®de üá∏üá™</option>
              <option value="üá®üá≠">Suisse üá®üá≠</option>
              <option value="üá∏üá∑">Suriname üá∏üá∑</option>
              <option value="üá∏üáæ">Syrie üá∏üáæ</option>
              <option value="üáπüáØ">Tadjikistan üáπüáØ</option>
              <option value="üáπüáø">Tanzanie üáπüáø</option>
              <option value="üáπüá©">Tchad üáπüá©</option>
              <option value="üá®üáø">Tch√©quie üá®üáø</option>
              <option value="üáπüá≠">Tha√Ølande üáπüá≠</option>
              <option value="üáπüá±">Timor oriental üáπüá±</option>
              <option value="üáπüá¨">Togo üáπüá¨</option>
              <option value="üáπüá¥">Tonga üáπüá¥</option>
              <option value="üáπüáπ">Trinit√©-et-Tobago üáπüáπ</option>
              <option value="üáπüá≥">Tunisie üáπüá≥</option>
              <option value="üáπüá≤">Turkm√©nistan üáπüá≤</option>
              <option value="üáπüá∑">Turquie üáπüá∑</option>
              <option value="üáπüáª">Tuvalu üáπüáª</option>
              <option value="üá∫üá¶">Ukraine üá∫üá¶</option>
              <option value="üá∫üáæ">Uruguay üá∫üáæ</option>
              <option value="üáªüá∫">Vanuatu üáªüá∫</option>
              <option value="üáªüá¶">Vatican üáªüá¶</option>
              <option value="üáªüá™">Venezuela üáªüá™</option>
              <option value="üáªüá≥">Vi√™t Nam üáªüá≥</option>
              <option value="üáæüá™">Y√©men üáæüá™</option>
              <option value="üáøüá≤">Zambie üáøüá≤</option>
              <option value="üáøüáº">Zimbabwe üáøüáº</option>
            </select>
          </div>
          
          <div class="pt-4 flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
            <button id="cancelCreation" class="oneui-button py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-xl font-medium">
              Annuler
            </button>
            <button id="confirmCreation" class="oneui-button py-2 px-4 bg-primary hover:bg-secondary text-white font-medium">
              Cr√©er
            </button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Marriage Modal -->
    <div id="marriageModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
      <div class="oneui-card bg-oneui-light-card dark:bg-oneui-dark-card p-6 w-full max-w-md mx-4">
        <h2 class="text-2xl font-semibold mb-4">Marier votre EmojiPet</h2>
        
        <div id="marriagePetsList" class="grid grid-cols-2 gap-3 mb-6">
          <!-- Available pets for marriage will be listed here -->
        </div>
        
        <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
          <button id="cancelMarriage" class="oneui-button py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-xl font-medium">
            Annuler
          </button>
        </div>
      </div>
    </div>
  
  <!-- Compliment Modal -->
  <div id="complimentModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
    <div class="oneui-card bg-oneui-light-card dark:bg-oneui-dark-card p-6 w-full max-w-md mx-4">
      <h2 class="text-2xl font-semibold mb-4">Parler √† <span id="complimentPetName"></span></h2>
      
      <div class="grid grid-cols-2 gap-3 mb-6">
        <button class="phrase-option p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover:bg-purple-50 dark:hover:bg-purple-900 transition-colors">
          <span class="text-2xl mb-2">üòò</span>
          <div class="font-medium">Bisou</div>
        </button>
        <button class="phrase-option p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover:bg-purple-50 dark:hover:bg-purple-900 transition-colors">
          <span class="text-2xl mb-2">‚ù§Ô∏è</span>
          <div class="font-medium">Je t'aime</div>
        </button>
        <button class="phrase-option p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover:bg-purple-50 dark:hover:bg-purple-900 transition-colors">
          <span class="text-2xl mb-2">ü•∞</span>
          <div class="font-medium">Je t'adore</div>
        </button>
        <button class="phrase-option p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover:bg-purple-50 dark:hover:bg-purple-900 transition-colors">
          <span class="text-2xl mb-2">üèÜ</span>
          <div class="font-medium">Tu es le meilleur</div>
        </button>
        <button class="phrase-option p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover:bg-purple-50 dark:hover:bg-purple-900 transition-colors">
          <span class="text-2xl mb-2">‚ú®</span>
          <div class="font-medium">Tu es magnifique</div>
        </button>
        <button class="phrase-option p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover:bg-purple-50 dark:hover:bg-purple-900 transition-colors">
          <span class="text-2xl mb-2">üåü</span>
          <div class="font-medium">Tu es sp√©cial</div>
        </button>
        <button class="phrase-option p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover:bg-purple-50 dark:hover:bg-purple-900 transition-colors">
          <span class="text-2xl mb-2">ü§ó</span>
          <div class="font-medium">C√¢lin</div>
        </button>
        <button class="phrase-option p-4 bg-white dark:bg-gray-800 rounded-xl text-center hover:bg-purple-50 dark:hover:bg-purple-900 transition-colors">
          <span class="text-2xl mb-2">üôå</span>
          <div class="font-medium">Bravo!</div>
        </button>
      </div>
      
      <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
        <button id="cancelCompliment" class="oneui-button py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-xl font-medium">
          Fermer
        </button>
      </div>
    </div>
  </div>
  
  <!-- Delete Confirmation Modal -->
  <div id="deleteModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
    <div class="oneui-card bg-oneui-light-card dark:bg-oneui-dark-card p-6 w-full max-w-md mx-4">
      <h2 class="text-2xl font-semibold mb-4">Supprimer l'EmojiPet</h2>
      
      <p class="mb-6 text-gray-700 dark:text-gray-300">√ätes-vous s√ªr de vouloir supprimer cet EmojiPet ? Cette action est irr√©versible.</p>
      
      <div class="flex flex-col md:flex-row space-y-3 md:space-y-0 md:space-x-3">
        <button id="cancelDelete" class="oneui-button py-2 px-4 border border-gray-300 dark:border-gray-600 rounded-xl font-medium">
          Annuler
        </button>
        <button id="confirmDelete" class="oneui-button py-2 px-4 bg-red-500 hover:bg-red-600 text-white font-medium">
          Supprimer
        </button>
      </div>
    </div>
  </div>
  
  <!-- Achievements Modal -->
  <div id="achievementsModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden">
    <div class="oneui-card bg-oneui-light-card dark:bg-oneui-dark-card p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
      <h2 class="text-2xl font-semibold mb-4 flex items-center">
        <span class="mr-2">üèÜ</span>
        D√©fis et Succ√®s
      </h2>
      
      <div id="achievementsList" class="space-y-4 mb-6">
        <!-- Achievements will be listed here -->
      </div>
      
      <button id="closeAchievements" class="oneui-button w-full py-3 px-4 bg-primary hover:bg-secondary text-white font-medium">
        Fermer
      </button>
    </div>
  </div>
  
  <!-- Achievement Notification -->
  <div id="achievementNotification" class="fixed top-4 right-4 z-50 bg-white dark:bg-gray-800 p-4 rounded-xl shadow-lg transform translate-x-full transition-transform duration-500 ease-out flex items-center">
    <div class="text-3xl mr-3 achievement-icon"></div>
    <div>
      <h3 class="font-bold text-lg achievement-title"></h3>
      <p class="text-sm text-gray-600 dark:text-gray-400 achievement-desc"></p>
    </div>
  </div>

  <script>
    // Dark mode detection & toggle
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
      document.documentElement.classList.add('dark');
    }
    
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
      if (event.matches) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    });
    
    document.getElementById('darkModeToggle').addEventListener('click', () => {
      document.documentElement.classList.toggle('dark');
    });
    
    // RGB Mode Toggle
    document.getElementById('rgbModeToggle').addEventListener('click', () => {
      document.documentElement.classList.toggle('rgb-mode');
    });
    
    // Delete confirmation modal event listeners
    document.getElementById('cancelDelete').addEventListener('click', hideDeleteConfirmation);
    document.getElementById('confirmDelete').addEventListener('click', deleteSelectedPet);
    
    // Main game data
    let pets = [];
    let selectedPet = null;
    let selectedEmoji = null;
    let selectedAccessory = null;
    let selectedReligion = null;
    let achievements = [];
    let playerLevel = 1;
    let playerXP = 0;
    let gameCoins = 100; // Monnaie du jeu
    
    // Emojis and emotions
    const petEmotions = ['üòÉ', 'üòä', 'üò¢', 'üòç', 'üò¥', 'ü§í', 'üòã'];
    
    // Achievements data
    const availableAchievements = [
      {
        id: 'feeder',
        name: 'Nourrisseur Attentionn√©',
        description: 'Nourrir vos EmojiPets 5 fois',
        icon: 'üçî',
        requirement: 5,
        progress: 0,
        completed: false,
        xpReward: 50
      },
      {
        id: 'player',
        name: 'Ma√Ætre du Jeu',
        description: 'Jouer avec vos EmojiPets 5 fois',
        icon: 'üéæ',
        requirement: 5,
        progress: 0,
        completed: false,
        xpReward: 50
      },
      {
        id: 'cleaner',
        name: 'Hygi√©niste',
        description: 'Nettoyer vos EmojiPets 5 fois',
        icon: 'üõÅ',
        requirement: 5,
        progress: 0,
        completed: false,
        xpReward: 50
      },
      {
        id: 'lover',
        name: 'Ami Fid√®le',
        description: 'Dire "Je t\'aime" √† vos EmojiPets 3 fois',
        icon: '‚ù§Ô∏è',
        requirement: 3,
        progress: 0,
        completed: false,
        xpReward: 40
      },
      {
        id: 'collector',
        name: 'Collectionneur',
        description: 'Avoir 3 EmojiPets diff√©rents',
        icon: 'üèÜ',
        requirement: 3,
        progress: 0,
        completed: false,
        xpReward: 60
      },
      {
        id: 'evolver',
        name: '√âvolution Compl√®te',
        description: 'Faire √©voluer un EmojiPet jusqu\'au stade final',
        icon: '‚≠ê',
        requirement: 1,
        progress: 0,
        completed: false,
        xpReward: 100
      },
      {
        id: 'matchmaker',
        name: 'Entremetteur',
        description: 'Marier 2 couples d\'EmojiPets',
        icon: 'üíç',
        requirement: 2,
        progress: 0,
        completed: false,
        xpReward: 80
      },
      {
        id: 'speaker',
        name: 'Beau Parleur',
        description: 'Parler √† vos EmojiPets 10 fois',
        icon: 'üí¨',
        requirement: 10,
        progress: 0,
        completed: false,
        xpReward: 70
      }
    ];
    // Objets disponibles dans la boutique
    const shopItems = [
      {
        id: 'crown',
        name: 'Couronne Royale',
        emoji: 'üëë',
        description: 'Une couronne royale pour votre EmojiPet',
        price: 50,
        type: 'accessory'
      },
      {
        id: 'glasses',
        name: 'Lunettes de Soleil',
        emoji: 'üï∂Ô∏è',
        description: 'Des lunettes styl√©es pour votre EmojiPet',
        price: 30,
        type: 'accessory'
      },
      {
        id: 'bowtie',
        name: 'N≈ìud Papillon',
        emoji: 'üéÄ',
        description: 'Un n≈ìud papillon √©l√©gant',
        price: 25,
        type: 'accessory'
      },
      {
        id: 'xppotion',
        name: 'Potion d\'XP',
        emoji: 'üß™',
        description: 'Donne +50 XP √† votre EmojiPet',
        price: 100,
        type: 'potion',
        effect: (pet) => {
          pet.xp += 50;
          return '+50 XP';
        }
      },
      {
        id: 'energypotion',
        name: 'Potion d\'√ânergie',
        emoji: '‚ö°',
        description: 'Remplit l\'√©nergie de votre EmojiPet √† 100%',
        price: 60,
        type: 'potion',
        effect: (pet) => {
          pet.energy = 100;
          return '√ânergie restaur√©e !';
        }
      },
      {
        id: 'happypotion',
        name: 'Potion de Bonheur',
        emoji: 'üòä',
        description: 'Remplit le bonheur de votre EmojiPet √† 100%',
        price: 70,
        type: 'potion',
        effect: (pet) => {
          pet.happiness = 100;
          return 'Bonheur restaur√© !';
        }
      }
    ];

    // Syst√®me d'√©volution avanc√© avec formes l√©gendaires
    const petEvolutions = {
      // Animaux normaux - [Niveau 1, Niveau 2, L√©gendaire (rare)]
      'üê∂': ['üêï', 'üêï‚Äçü¶∫', 'ü¶ä'],      // Chien -> Renard l√©gendaire
      'üê±': ['üêà', 'üêà‚Äç‚¨õ', 'ü¶Å'],       // Chat -> Lion l√©gendaire
      'üê∞': ['üêá', 'ü¶ù', 'üê≤'],         // Lapin -> Raton -> Dragon l√©gendaire
      'üêº': ['üêº', 'üêª', 'üêª‚Äç‚ùÑÔ∏è'],      // Panda -> Ours -> Ours polaire l√©gendaire
      'ü¶ä': ['ü¶ä', 'ü¶ù', 'ü¶Ñ'],         // Renard -> Licorne l√©gendaire
      'ü¶Å': ['ü¶Å', 'üêØ', 'üêâ'],         // Lion -> Tigre -> Dragon l√©gendaire
      'üêÆ': ['üêÑ', 'ü¶¨', 'ü¶£'],         // Vache -> Bison -> Mammouth l√©gendaire
      'üê∑': ['üêñ', 'üêó', 'ü¶è'],         // Cochon -> Sanglier -> Rhinoc√©ros l√©gendaire
      'üêµ': ['üêí', 'ü¶ç', 'ü¶ß'],         // Singe -> Gorille -> Orang-outan l√©gendaire
      'üêª': ['üêª‚Äç‚ùÑÔ∏è', 'üê®', 'üêº'],      // Ours -> Koala -> Panda l√©gendaire
      'üê®': ['üê®', 'ü¶•', 'ü¶ç'],         // Koala -> Paresseux -> Gorille l√©gendaire
      'ü¶ù': ['ü¶ù', 'ü¶ä', 'ü¶Å'],         // Raton laveur -> Renard -> Lion l√©gendaire
      'üê≤': ['üêâ', 'ü¶ï', 'ü¶ñ'],         // Dragon -> Dino -> T-Rex l√©gendaire
      'ü¶Ñ': ['ü¶Ñ', 'ü¶ì', 'üê≤'],         // Licorne -> Z√®bre -> Dragon l√©gendaire
      'ü¶í': ['ü¶í', 'üêò', 'ü¶ï'],         // Girafe -> √âl√©phant -> Diplodocus l√©gendaire
      'ü¶ì': ['ü¶ì', 'ü¶ì', 'ü¶Ñ'],         // Z√®bre -> Licorne l√©gendaire
      'üêò': ['üêò', 'ü¶£', 'ü¶ï'],         // √âl√©phant -> Mammouth -> Diplodocus l√©gendaire
      'ü¶î': ['ü¶î', 'ü¶°', 'ü¶ä'],         // H√©risson -> Blaireau -> Renard l√©gendaire
      'üê¢': ['üê¢', 'üêä', 'üêâ'],         // Tortue -> Crocodile -> Dragon l√©gendaire
      'üê¨': ['üê¨', 'üêã', 'ü¶à'],         // Dauphin -> Baleine -> Requin l√©gendaire
      'ü¶Ö': ['ü¶Ö', 'ü¶Ö', 'üî•'],         // Ph√©nix -> Ph√©nix -> Feu l√©gendaire
      'ü¶à': ['ü¶à', 'üêã', 'üåä'],         // Requin -> Baleine -> Eau l√©gendaire
      'ü¶ñ': ['ü¶ñ', 'ü¶ï', 'üê≤'],         // T-Rex -> Diplodocus -> Dragon l√©gendaire
      
      // Personnages humains
      'üôé‚Äç‚ôÄÔ∏è': ['üôé‚Äç‚ôÄÔ∏è', 'üë∏', 'üë∏'],     // Femme -> Princesse
      'üôé': ['üôé', 'üßô', 'üßô'],          // Personne -> Magicien
      'üôé‚Äç‚ôÇÔ∏è': ['üôé‚Äç‚ôÇÔ∏è', 'ü§¥', 'ü§¥'],     // Homme -> Prince
      'üßë‚Äçü¶Ω': ['üßë‚Äçü¶Ω', 'üßë‚Äçü¶Ω', 'ü¶∏'],  // Personne en fauteuil -> Super h√©ros
      'üë®‚Äçü¶Ω': ['üë®‚Äçü¶Ω', 'üë®‚Äçü¶Ω', 'ü¶∏‚Äç‚ôÇÔ∏è'], // Homme en fauteuil -> Super h√©ros
      'üë©‚Äçü¶º': ['üë©‚Äçü¶º', 'üë©‚Äçü¶º', 'ü¶∏‚Äç‚ôÄÔ∏è'], // Femme en fauteuil √©lectrique -> Super h√©ro√Øne
      'üßë‚Äçü¶º': ['üßë‚Äçü¶º', 'üßë‚Äçü¶º', 'ü¶∏'],   // Personne en fauteuil √©lectrique -> Super h√©ros
      'üë®‚Äçü¶Ø': ['üë®‚Äçü¶Ø', 'üë®‚Äçü¶Ø', 'üßô‚Äç‚ôÇÔ∏è'], // Homme avec canne -> Sorcier
      'üßé‚Äç‚ôÄÔ∏è': ['üßé‚Äç‚ôÄÔ∏è', 'üíÉ', 'üßö‚Äç‚ôÄÔ∏è'],   // Femme √† genoux -> Danseuse -> F√©e
      'üë©‚Äç‚ù§Ô∏è‚Äçüë®': ['üë©‚Äç‚ù§Ô∏è‚Äçüë®', 'üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®', 'üë™'], // Couple -> Famille
      'üë©‚Äç‚ù§Ô∏è‚Äçüë©': ['üë©‚Äç‚ù§Ô∏è‚Äçüë©', 'üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë©', 'üë©‚Äçüë©‚Äçüëß'], // Couple -> Famille
      'üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®': ['üë©‚Äç‚ù§Ô∏è‚Äçüíã‚Äçüë®', 'üë™', 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶'] // Couple -> Famille
    };
    
    // Update and track achievement progress
    function updateAchievement(achievementId, progress) {
      const achievement = achievements.find(a => a.id === achievementId);
      if (!achievement || achievement.completed) return;
      
      achievement.progress += progress;
      
      // Check if achievement is completed
      if (achievement.progress >= achievement.requirement && !achievement.completed) {
        achievement.completed = true;
        
        // Grant XP reward to player
        playerXP += achievement.xpReward;
        
        // Show notification
        showAchievementNotification(achievement);
      }
    }
    
    // Show achievement notification
    function showAchievementNotification(achievement) {
      const notification = document.getElementById('achievementNotification');
      const icon = notification.querySelector('.achievement-icon');
      const title = notification.querySelector('.achievement-title');
      const desc = notification.querySelector('.achievement-desc');
      
      icon.textContent = achievement.icon;
      title.textContent = achievement.name + ' üèÜ';
      desc.textContent = achievement.description;
      
      // Show notification
      notification.style.transform = 'translateX(0)';
      
      // Hide notification after 5 seconds
      setTimeout(() => {
        notification.style.transform = 'translateX(calc(100% + 1rem))';
      }, 5000);
    }
    
    // Render achievements list
    function renderAchievements() {
      const container = document.getElementById('achievementsList');
      container.innerHTML = '';
      
      achievements.forEach(achievement => {
        const achievementEl = document.createElement('div');
        achievementEl.className = `p-4 ${achievement.completed ? 'bg-purple-50 dark:bg-purple-900/30' : 'bg-white dark:bg-gray-800'} rounded-xl border ${achievement.completed ? 'border-primary' : 'border-gray-200 dark:border-gray-700'}`;
        
        const progress = Math.min(achievement.progress, achievement.requirement);
        const percentage = Math.floor((progress / achievement.requirement) * 100);
        
        achievementEl.innerHTML = `
          <div class="flex items-center mb-2">
            <div class="text-3xl mr-3">${achievement.icon}</div>
            <div>
              <h3 class="font-bold text-lg">${achievement.name} ${achievement.completed ? 'üèÜ' : ''}</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">${achievement.description}</p>
            </div>
          </div>
          <div class="mt-2">
            <div class="h-2 w-full bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
              <div class="h-full ${achievement.completed ? 'bg-primary' : 'bg-gray-400 dark:bg-gray-500'} rounded-full" style="width: ${percentage}%"></div>
            </div>
            <p class="text-xs text-right mt-1 ${achievement.completed ? 'text-primary' : 'text-gray-500'}">${progress}/${achievement.requirement}</p>
          </div>
          ${achievement.completed ? `<p class="text-sm text-primary mt-2">+${achievement.xpReward} XP</p>` : ''}
        `;
        
        container.appendChild(achievementEl);
      });
    }
    
    // Show achievements modal
    function showAchievementsModal() {
      renderAchievements();
      document.getElementById('achievementsModal').classList.remove('hidden');
    }
    
    // Hide achievements modal
    function hideAchievementsModal() {
      document.getElementById('achievementsModal').classList.add('hidden');
    }
      
    // Initialize game
    function initGame() {
      // Create some sample pets to start with
      if (pets.length === 0) {
        const samplePet = {
          id: Date.now().toString(),
          name: "Fluffy",
          emoji: "üê∂",
          accessory: "üß£",
          country: "üá´üá∑",
          happiness: 100,
          hunger: 80,
          cleanliness: 100,
          xp: 0,
          evolutionStage: 0,
          evolutionThreshold: 100,
          marriedTo: null,
          createdAt: Date.now(),
          lastInteraction: Date.now(),
          mood: 3
        };
        pets.push(samplePet);
      }
      renderPets();
      
      // UI event listeners
      document.getElementById('addEmojiPet').addEventListener('click', showCreationModal);
      document.getElementById('cancelCreation').addEventListener('click', hideCreationModal);
      document.getElementById('confirmCreation').addEventListener('click', createNewPet);
      document.getElementById('feedPet').addEventListener('click', feedSelectedPet);
      document.getElementById('playWithPet').addEventListener('click', playWithSelectedPet);
      document.getElementById('cleanPet').addEventListener('click', cleanSelectedPet);
      
      // Initialize achievements
      if (achievements.length === 0) {
        achievements = JSON.parse(JSON.stringify(availableAchievements));
      }
      
      // Setup achievements modal
      document.getElementById('achievementsButton').addEventListener('click', showAchievementsModal);
      document.getElementById('closeAchievements').addEventListener('click', hideAchievementsModal);
      document.getElementById('complimentPet').addEventListener('click', showComplimentModal);
      document.getElementById('marryPet').addEventListener('click', showMarriageModal);
      document.getElementById('cancelMarriage').addEventListener('click', hideMarriageModal);
      document.getElementById('cancelCompliment').addEventListener('click', hideComplimentModal);
      document.getElementById('deletePet').addEventListener('click', showDeleteConfirmation);
      
      // Set up emoji and accessory selection
      document.querySelectorAll('.emoji-option').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.emoji-option').forEach(b => b.classList.remove('ring-2', 'ring-primary'));
          btn.classList.add('ring-2', 'ring-primary');
          selectedEmoji = btn.textContent;
        });
      });
      
      document.querySelectorAll('.accessory-option').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.accessory-option').forEach(b => b.classList.remove('ring-2', 'ring-primary'));
          btn.classList.add('ring-2', 'ring-primary');
          selectedAccessory = btn.textContent;
        });
      });
      
      document.querySelectorAll('.religion-option').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.religion-option').forEach(b => b.classList.remove('ring-2', 'ring-primary'));
          btn.classList.add('ring-2', 'ring-primary');
          selectedReligion = btn.textContent;
        });
      });
      
      // Start game loop for evolution and status changes
      setInterval(gameLoop, 30000); // Run every 30 seconds
    }
    
    // Game loop for passive changes and evolution
    function gameLoop() {
      const now = Date.now();
      
      pets.forEach(pet => {
        // Initialize energy if not exists
        if (pet.energy === undefined) {
          pet.energy = 100;
        }
        
        // Decrease stats over time
        pet.happiness = Math.max(0, pet.happiness - 2);
        pet.hunger = Math.max(0, pet.hunger - 3);
        pet.cleanliness = Math.max(0, pet.cleanliness - 1);
        pet.energy = Math.max(0, pet.energy - 2);
        
        // Evolve pet if conditions are met
        if (pet.xp >= pet.evolutionThreshold && pet.evolutionStage < 3) {
          evolvePet(pet);
        }
        
        // Update mood based on stats
        updatePetMood(pet);
        
        // Save changes
        savePets();
      });
      
      // Re-render if a pet is selected
      if (selectedPet) {
        const updatedPet = pets.find(p => p.id === selectedPet.id);
        if (updatedPet) {
          selectedPet = updatedPet;
          renderPetDetails(selectedPet);
          updateNeedsUI(selectedPet);
        }
      }
      
      renderPets();
    }
    
    // Update needs UI
    function updateNeedsUI(pet) {
      // Update hunger bar
      document.getElementById('hungerBar').style.width = `${pet.hunger}%`;
      document.getElementById('hungerValue').textContent = `${pet.hunger}%`;
      
      // Update happiness bar
      document.getElementById('happinessBar').style.width = `${pet.happiness}%`;
      document.getElementById('happinessValue').textContent = `${pet.happiness}%`;
      
      // Update cleanliness bar
      document.getElementById('cleanlinessBar').style.width = `${pet.cleanliness}%`;
      document.getElementById('cleanlinessValue').textContent = `${pet.cleanliness}%`;
      
      // Update energy bar
      document.getElementById('energyBar').style.width = `${pet.energy || 0}%`;
      document.getElementById('energyValue').textContent = `${pet.energy || 0}%`;
      
      // Update colors based on values
      updateBarColor('hungerBar', pet.hunger);
      updateBarColor('happinessBar', pet.happiness);
      updateBarColor('cleanlinessBar', pet.cleanliness);
      updateBarColor('energyBar', pet.energy || 0);
    }
    
    // Update bar color based on percentage
    function updateBarColor(barId, value) {
      const bar = document.getElementById(barId);
      if (!bar) return;
      
      if (value < 30) {
        // Critical level - red
        if (barId === 'hungerBar') bar.className = 'h-full bg-red-500 rounded-full';
        else if (barId === 'happinessBar') bar.className = 'h-full bg-red-500 rounded-full';
        else if (barId === 'cleanlinessBar') bar.className = 'h-full bg-red-500 rounded-full';
        else if (barId === 'energyBar') bar.className = 'h-full bg-red-500 rounded-full';
      } else if (value < 60) {
        // Warning level - yellow/orange
        if (barId === 'hungerBar') bar.className = 'h-full bg-yellow-500 rounded-full';
        else if (barId === 'happinessBar') bar.className = 'h-full bg-orange-500 rounded-full';
        else if (barId === 'cleanlinessBar') bar.className = 'h-full bg-yellow-500 rounded-full';
        else if (barId === 'energyBar') bar.className = 'h-full bg-yellow-500 rounded-full';
      } else {
        // Good level - original colors
        if (barId === 'hungerBar') bar.className = 'h-full bg-green-500 rounded-full';
        else if (barId === 'happinessBar') bar.className = 'h-full bg-pink-500 rounded-full';
        else if (barId === 'cleanlinessBar') bar.className = 'h-full bg-blue-500 rounded-full';
        else if (barId === 'energyBar') bar.className = 'h-full bg-amber-500 rounded-full';
      }
    }
    
    // Render all pets in the container
    function renderPets() {
      const container = document.getElementById('emojipetsContainer');
      container.innerHTML = '';
      
      pets.forEach(pet => {
        const petElement = document.createElement('div');
        petElement.className = 'emoji-container shadow-3d p-4 bg-white dark:bg-gray-800 rounded-2xl cursor-pointer relative flex flex-col items-center';
        petElement.dataset.petId = pet.id;
        
        // Add country flag
        const flagElement = document.createElement('span');
        flagElement.className = 'country-flag';
        flagElement.textContent = pet.country;
        petElement.appendChild(flagElement);
        
        // Add the main emoji with potential 3D effect
        const emojiElement = document.createElement('div');
        emojiElement.className = 'emoji-display text-6xl mb-2';
        emojiElement.textContent = pet.emoji;
        
        // Add 3D effect
        emojiElement.classList.add('emoji-3d');
        
        // Add special effects for certain creature types
        if (pet.emoji === 'ü¶Ö') {
          // Add phoenix fire effect
          emojiElement.classList.add('phoenix-pet');
        } else if (pet.emoji === 'ü¶à') {
          // Add shark swimming effect
          emojiElement.classList.add('shark-pet');
        }
        
        // Add accessory if present
        if (pet.accessory) {
          const accessoryElement = document.createElement('div');
          accessoryElement.className = 'absolute top-1 left-1/2 transform -translate-x-1/2 -translate-y-1/4 text-3xl';
          accessoryElement.textContent = pet.accessory;
          petElement.appendChild(accessoryElement);
        }
        
        // Add religion symbol if present
        if (pet.religion) {
          const religionElement = document.createElement('div');
          religionElement.className = 'absolute bottom-12 right-1 text-xl';
          religionElement.textContent = pet.religion;
          petElement.appendChild(religionElement);
        }
        
        // Add married indicator
        if (pet.marriedTo) {
          emojiElement.classList.add('emoji-married');
        }
        
        // Add mood indicator
        const moodElement = document.createElement('div');
        moodElement.className = 'mood-indicator';
        moodElement.textContent = getPetMoodEmoji(pet);
        petElement.appendChild(moodElement);
        
        petElement.appendChild(emojiElement);
        
        // Add name
        const nameElement = document.createElement('span');
        nameElement.className = 'font-medium text-center mt-1';
        nameElement.textContent = pet.name;
        petElement.appendChild(nameElement);
        
        // Add event listener
        petElement.addEventListener('click', () => selectPet(pet));
        
        container.appendChild(petElement);
      });
    }
    
    // Select a pet
    function selectPet(pet) {
      selectedPet = pet;
      
      document.getElementById('noSelection').classList.add('hidden');
      document.getElementById('selectedPetInfo').classList.remove('hidden');
      
      renderPetDetails(pet);
      
      // Select the pet in the grid
      document.querySelectorAll('.emoji-container').forEach(el => {
        if (el.dataset.petId === pet.id) {
          el.classList.add('ring-2', 'ring-primary', 'ring-offset-2');
          
          // Add animation to the selected pet
          const emojiEl = el.querySelector('.emoji-display');
          emojiEl.classList.add('emoji-selected');
        } else {
          el.classList.remove('ring-2', 'ring-primary', 'ring-offset-2');
          const emojiEl = el.querySelector('.emoji-display');
          emojiEl.classList.remove('emoji-selected');
        }
      });
    }
    
    // Render selected pet details
    function renderPetDetails(pet) {
      document.getElementById('selectedEmoji').textContent = pet.emoji;
      document.getElementById('selectedName').textContent = pet.name;
      document.getElementById('selectedCountry').textContent = `Origine: ${getCountryName(pet.country)}`;
      document.getElementById('selectedMood').textContent = `Humeur: ${getPetMoodText(pet)}`;
      
      // Show level information
      const petLevel = Math.floor(pet.xp / 50) + 1; // Every 50 XP is a new level
      document.getElementById('petLevel').textContent = `Niveau ${petLevel}`;
      
      // Update evolution progress bar
      const evolutionPercentage = (pet.xp / pet.evolutionThreshold) * 100;
      document.getElementById('evolutionBar').style.width = `${Math.min(100, evolutionPercentage)}%`;
      document.getElementById('evolutionXP').textContent = `XP: ${pet.xp}/${pet.evolutionThreshold}`;
      
      // Add 3D effect to the selected emoji
      document.getElementById('selectedEmoji').classList.add('emoji-3d');
      
      // Add special effects for certain creature types
      const selectedEmojiElement = document.getElementById('selectedEmoji');
      selectedEmojiElement.classList.remove('phoenix-pet', 'shark-pet');
      
      // Apply special effects based on emoji type
      if (pet.emoji === 'ü¶Ö') {
        // Add phoenix fire effect
        selectedEmojiElement.classList.add('phoenix-pet');
      } else if (pet.emoji === 'ü¶à') {
        // Add shark swimming effect
        selectedEmojiElement.classList.add('shark-pet');
      }
      
      // Add married indicator if applicable
      if (pet.marriedTo) {
        document.getElementById('selectedEmoji').classList.add('emoji-married');
        
        // Find partner
        const partner = pets.find(p => p.id === pet.marriedTo);
        if (partner) {
          document.getElementById('selectedMood').textContent += ` üíë Mari√©(e) √† ${partner.name}`;
        }
      } else {
        document.getElementById('selectedEmoji').classList.remove('emoji-married');
      }
      
      // Update button states
      document.getElementById('marryPet').disabled = !!pet.marriedTo;
      document.getElementById('marryPet').textContent = pet.marriedTo ? 'üíç D√©j√† mari√©(e)' : 'üíç Marier';
    }
    
    // Show creation modal
    function showCreationModal() {
      document.getElementById('creationModal').classList.remove('hidden');
      document.getElementById('petName').value = '';
      selectedEmoji = null;
      selectedAccessory = null;
      selectedReligion = null;
      
      document.querySelectorAll('.emoji-option').forEach(b => b.classList.remove('ring-2', 'ring-primary'));
      document.querySelectorAll('.accessory-option').forEach(b => b.classList.remove('ring-2', 'ring-primary'));
      document.querySelectorAll('.religion-option').forEach(b => b.classList.remove('ring-2', 'ring-primary'));
    }
    
    // Hide creation modal
    function hideCreationModal() {
      document.getElementById('creationModal').classList.add('hidden');
    }
    
    // Create a new pet
    function createNewPet() {
      const name = document.getElementById('petName').value.trim();
      const country = document.getElementById('petCountry').value;
      
      if (!name || !selectedEmoji) {
        // Show error
        return;
      }
      
      const newPet = {
        id: Date.now().toString(),
        name: name,
        emoji: selectedEmoji,
        accessory: selectedAccessory || null,
        religion: selectedReligion || null,
        country: country,
        happiness: 100,
        hunger: 100,
        cleanliness: 100,
        xp: 0,
        evolutionStage: 0,
        evolutionThreshold: 100,
        marriedTo: null,
        createdAt: Date.now(),
        lastInteraction: Date.now()
      };
      
      // Update collector achievement when creating a new pet
      if (pets.length >= 2) { // Will be 3 after adding this one
        updateAchievement('collector', 1);
      }
      
      pets.push(newPet);
      savePets();
      renderPets();
      hideCreationModal();
      
      // Select the newly created pet
      selectPet(newPet);
      
      // Add animation for the new pet
      setTimeout(() => {
        const petEl = document.querySelector(`[data-pet-id="${newPet.id}"]`);
        if (petEl) {
          petEl.classList.add('animate-bounce-slow');
          setTimeout(() => {
            petEl.classList.remove('animate-bounce-slow');
          }, 2000);
        }
      }, 100);
    }
    
    // Feed the selected pet
    function feedSelectedPet() {
      if (!selectedPet) return;
      
      const pet = pets.find(p => p.id === selectedPet.id);
      if (pet) {
        pet.hunger = Math.min(100, pet.hunger + 30);
        pet.happiness = Math.min(100, pet.happiness + 5);
        pet.xp += 5;
        pet.lastInteraction = Date.now();
        
        updatePetMood(pet);
        savePets();
        renderPetDetails(pet);
        renderPets();
        
        // Update achievement progress
        updateAchievement('feeder', 1);
        
        // Animation
        showActionAnimation('üçî');
      }
    }
    
    // Play with the selected pet
    function playWithSelectedPet() {
      if (!selectedPet) return;
      
      const pet = pets.find(p => p.id === selectedPet.id);
      if (pet) {
        pet.happiness = Math.min(100, pet.happiness + 30);
        pet.hunger = Math.max(0, pet.hunger - 10);
        pet.xp += 10;
        pet.lastInteraction = Date.now();
        
        updatePetMood(pet);
        savePets();
        renderPetDetails(pet);
        renderPets();
        
        // Update achievement progress
        updateAchievement('player', 1);
        
        // Animation
        showActionAnimation('üéæ');
      }
    }
    
    // Clean the selected pet
    function cleanSelectedPet() {
      if (!selectedPet) return;
      
      const pet = pets.find(p => p.id === selectedPet.id);
      if (pet) {
        pet.cleanliness = 100;
        pet.happiness = Math.min(100, pet.happiness + 10);
        pet.xp += 5;
        pet.lastInteraction = Date.now();
        
        updatePetMood(pet);
        savePets();
        renderPetDetails(pet);
        renderPets();
        
        // Update achievement progress
        updateAchievement('cleaner', 1);
        
        // Animation
        showActionAnimation('‚ú®');
      }
    }
    
    // Show marriage modal
    function showMarriageModal() {
      if (!selectedPet || selectedPet.marriedTo) return;
      
      const marriageList = document.getElementById('marriagePetsList');
      marriageList.innerHTML = '';
      
      // Find eligible pets (not married and not the currently selected pet)
      const eligiblePets = pets.filter(p => p.id !== selectedPet.id && !p.marriedTo);
      
      if (eligiblePets.length === 0) {
        marriageList.innerHTML = '<p class="col-span-2 text-center py-4 text-gray-500">Aucun EmojiPet disponible pour un mariage</p>';
      } else {
        eligiblePets.forEach(pet => {
          const petEl = document.createElement('div');
          petEl.className = 'p-4 bg-white dark:bg-gray-800 rounded-xl flex flex-col items-center cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors';
          
          const emojiEl = document.createElement('div');
          emojiEl.className = 'text-4xl mb-2';
          emojiEl.textContent = pet.emoji;
          
          const nameEl = document.createElement('div');
          nameEl.className = 'font-medium text-center';
          nameEl.textContent = pet.name;
          
          const flagEl = document.createElement('div');
          flagEl.className = 'text-sm';
          flagEl.textContent = pet.country;
          
          petEl.appendChild(emojiEl);
          petEl.appendChild(nameEl);
          petEl.appendChild(flagEl);
          
          petEl.addEventListener('click', () => marryPets(selectedPet, pet));
          
          marriageList.appendChild(petEl);
        });
      }
      
      document.getElementById('marriageModal').classList.remove('hidden');
    }
    
    // Hide marriage modal
    function hideMarriageModal() {
      document.getElementById('marriageModal').classList.add('hidden');
    }
    
    // Marry two pets
    function marryPets(pet1, pet2) {
      pet1.marriedTo = pet2.id;
      pet2.marriedTo = pet1.id;
      
      pet1.happiness = 100;
      pet2.happiness = 100;
      
      pet1.xp += 20;
      pet2.xp += 20;
      
      // Update matchmaker achievement
      updateAchievement('matchmaker', 1);
      
      savePets();
      renderPets();
      renderPetDetails(pet1);
      hideMarriageModal();
      
      // Show marriage animation
      showActionAnimation('üíï');
      
      // Animate both pets
      setTimeout(() => {
        const pet1El = document.querySelector(`[data-pet-id="${pet1.id}"]`);
        const pet2El = document.querySelector(`[data-pet-id="${pet2.id}"]`);
        
        if (pet1El) {
          pet1El.classList.add('animate-pulse-slow');
          setTimeout(() => pet1El.classList.remove('animate-pulse-slow'), 3000);
        }
        
        if (pet2El) {
          pet2El.classList.add('animate-pulse-slow');
          setTimeout(() => pet2El.classList.remove('animate-pulse-slow'), 3000);
        }
      }, 100);
    }
    
    // Evolve a pet
    function evolvePet(pet) {
      if (pet.evolutionStage >= 3) return;
      
      // Evolve to next stage
      pet.evolutionStage++;
      
      // Update emoji to evolved form
      if (petEvolutions[pet.emoji]) {
        // Chance for legendary evolution at the final stage
        if (pet.evolutionStage === 3) {
          // 10% chance for legendary form
          const isLegendary = Math.random() < 0.10;
          if (isLegendary && petEvolutions[pet.emoji][2]) {
            pet.emoji = petEvolutions[pet.emoji][2];
            pet.isLegendary = true;
            
            // Show special notification for legendary
            showLegendaryEvolutionNotification(pet);
          } else {
            // Non-legendary final form
            pet.emoji = petEvolutions[pet.emoji][1];
          }
        } else {
          pet.emoji = petEvolutions[pet.emoji][pet.evolutionStage - 1];
        }
      }
      
      // Increase evolution threshold for next evolution
      if (pet.evolutionStage === 1) {
        pet.evolutionThreshold = 200;
      } else if (pet.evolutionStage === 2) {
        pet.evolutionThreshold = 300;
      } else {
        pet.evolutionThreshold = 500;
      }
      
      // Grant additional XP for reaching a new evolution stage
      pet.xp += 20;
      
      // Check if achievement should be awarded (final evolution)
      if (pet.evolutionStage === 2) {
        updateAchievement('evolver', 1);
      }
      
      savePets();
      
      // Show evolution animation
      if (selectedPet && selectedPet.id === pet.id) {
        showActionAnimation(pet.isLegendary ? 'üåü' : '‚≠ê');
      }
      
      // Find the pet element
      setTimeout(() => {
        const petEl = document.querySelector(`[data-pet-id="${pet.id}"]`);
        if (petEl) {
          petEl.classList.add('animate-pulse-slow');
          setTimeout(() => petEl.classList.remove('animate-pulse-slow'), 3000);
        }
      }, 100);
    }
    
    // Show legendary evolution notification
    function showLegendaryEvolutionNotification(pet) {
      const notification = document.getElementById('achievementNotification');
      const icon = notification.querySelector('.achievement-icon');
      const title = notification.querySelector('.achievement-title');
      const desc = notification.querySelector('.achievement-desc');
      
      icon.textContent = 'üåü';
      title.textContent = '√âVOLUTION L√âGENDAIRE!';
      desc.textContent = `${pet.name} a atteint sa forme l√©gendaire!`;
      
      // Show notification
      notification.style.transform = 'translateX(0)';
      
      // Hide notification after 7 seconds (longer for legendary)
      setTimeout(() => {
        notification.style.transform = 'translateX(calc(100% + 1rem))';
      }, 7000);
    }
    
    // Show action animation
    function showActionAnimation(emoji) {
      const container = document.querySelector(`[data-pet-id="${selectedPet.id}"]`);
      if (!container) return;
      
      const animation = document.createElement('div');
      animation.className = 'absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-full text-3xl animate-float';
      animation.textContent = emoji;
      animation.style.zIndex = 5;
      
      container.appendChild(animation);
      
      setTimeout(() => {
        animation.remove();
      }, 2000);
    }
    
    // Update pet mood based on stats
    function updatePetMood(pet) {
      let moodIndex = 0;
      
      const averageStat = (pet.happiness + pet.hunger + pet.cleanliness) / 3;
      
      if (averageStat > 80) moodIndex = 3; // üòç
      else if (averageStat > 60) moodIndex = 0; // üòÉ
      else if (averageStat > 40) moodIndex = 1; // üòä
      else if (averageStat > 20) moodIndex = 2; // üò¢
      else moodIndex = 5; // ü§í
      
      pet.mood = moodIndex;
    }
    
    // Get pet mood emoji
    function getPetMoodEmoji(pet) {
      return petEmotions[pet.mood || 0];
    }
    
    // Get pet mood text
    function getPetMoodText(pet) {
      const moodEmoji = getPetMoodEmoji(pet);
      let moodText = '';
      
      switch (moodEmoji) {
        case 'üòÉ': moodText = 'Heureux'; break;
        case 'üòä': moodText = 'Content'; break;
        case 'üò¢': moodText = 'Triste'; break;
        case 'üòç': moodText = 'Adorable'; break;
        case 'üò¥': moodText = 'Fatigu√©'; break;
        case 'ü§í': moodText = 'Malade'; break;
        case 'üòã': moodText = 'Affam√©'; break;
        default: moodText = 'Normal';
      }
      
      return `${moodText} ${moodEmoji}`;
    }
    
    // Get country name from flag emoji
    function getCountryName(flag) {
      const countries = {
        'üá¶üá´': 'Afghanistan',
        'üáøüá¶': 'Afrique du Sud',
        'üá¶üá±': 'Albanie',
        'üá©üáø': 'Alg√©rie',
        'üá©üá™': 'Allemagne',
        'üá¶üá©': 'Andorre',
        'üá¶üá¥': 'Angola',
        'üá¶üá¨': 'Antigua-et-Barbuda',
        'üá∏üá¶': 'Arabie Saoudite',
        'üá¶üá∑': 'Argentine',
        'üá¶üá≤': 'Arm√©nie',
        'üá¶üá∫': 'Australie',
        'üá¶üáπ': 'Autriche',
        'üá¶üáø': 'Azerba√Ødjan',
        'üáßüá∏': 'Bahamas',
        'üáßüá≠': 'Bahre√Øn',
        'üáßüá©': 'Bangladesh',
        'üáßüáß': 'Barbade',
        'üáßüá™': 'Belgique',
        'üáßüáø': 'Belize',
        'üáßüáØ': 'B√©nin',
        'üáßüáπ': 'Bhoutan',
        'üáßüáæ': 'Bi√©lorussie',
        'üá≤üá≤': 'Birmanie',
        'üáßüá¥': 'Bolivie',
        'üáßüá¶': 'Bosnie-Herz√©govine',
        'üáßüáº': 'Botswana',
        'üáßüá∑': 'Br√©sil',
        'üáßüá≥': 'Brunei',
        'üáßüá¨': 'Bulgarie',
        'üáßüá´': 'Burkina Faso',
        'üáßüáÆ': 'Burundi',
        'üá∞üá≠': 'Cambodge',
        'üá®üá≤': 'Cameroun',
        'üá®üá¶': 'Canada',
        'üá®üáª': 'Cap-Vert',
        'üá®üá´': 'R√©publique centrafricaine',
        'üá®üá±': 'Chili',
        'üá®üá≥': 'Chine',
        'üá®üáæ': 'Chypre',
        'üá®üá¥': 'Colombie',
        'üá∞üá≤': 'Comores',
        'üá®üá¨': 'R√©publique du Congo',
        'üá®üá©': 'R√©publique d√©mocratique du Congo',
        'üá∞üáµ': 'Cor√©e du Nord',
        'üá∞üá∑': 'Cor√©e du Sud',
        'üá®üá∑': 'Costa Rica',
        'üá®üáÆ': 'C√¥te d\'Ivoire',
        'üá≠üá∑': 'Croatie',
        'üá®üá∫': 'Cuba',
        'üá©üá∞': 'Danemark',
        'üá©üáØ': 'Djibouti',
        'üá©üá≤': 'Dominique',
        'üá™üá¨': '√âgypte',
        'üá¶üá™': '√âmirats arabes unis',
        'üá™üá®': '√âquateur',
        'üá™üá∑': '√ârythr√©e',
        'üá™üá∏': 'Espagne',
        'üá™üá™': 'Estonie',
        'üá∏üáø': 'Eswatini',
        'üá∫üá∏': '√âtats-Unis',
        'üá™üáπ': '√âthiopie',
        'üá´üáØ': 'Fidji',
        'üá´üáÆ': 'Finlande',
        'üá´üá∑': 'France',
        'üá¨üá¶': 'Gabon',
        'üá¨üá≤': 'Gambie',
        'üá¨üá™': 'G√©orgie',
        'üá¨üá≠': 'Ghana',
        'üá¨üá∑': 'Gr√®ce',
        'üá¨üá©': 'Grenade',
        'üá¨üáπ': 'Guatemala',
        'üá¨üá≥': 'Guin√©e',
        'üá¨üá∂': 'Guin√©e √©quatoriale',
        'üá¨üáº': 'Guin√©e-Bissau',
        'üá¨üáæ': 'Guyana',
        'üá≠üáπ': 'Ha√Øti',
        'üá≠üá≥': 'Honduras',
        'üá≠üá∫': 'Hongrie',
        'üáÆüá≥': 'Inde',
        'üáÆüá©': 'Indon√©sie',
        'üáÆüá∂': 'Irak',
        'üáÆüá∑': 'Iran',
        'üáÆüá™': 'Irlande',
        'üáÆüá∏': 'Islande',
        'üáÆüá±': 'Isra√´l',
        'üáÆüáπ': 'Italie',
        'üáØüá≤': 'Jama√Øque',
        'üáØüáµ': 'Japon',
        'üáØüá¥': 'Jordanie',
        'üá∞üáø': 'Kazakhstan',
        'üá∞üá™': 'Kenya',
        'üá∞üá¨': 'Kirghizistan',
        'üá∞üáÆ': 'Kiribati',
        'üá∞üáº': 'Kowe√Øt',
        'üá±üá¶': 'Laos',
        'üá±üá∏': 'Lesotho',
        'üá±üáª': 'Lettonie',
        'üá±üáß': 'Liban',
        'üá±üá∑': 'Liberia',
        'üá±üáæ': 'Libye',
        'üá±üáÆ': 'Liechtenstein',
        'üá±üáπ': 'Lituanie',
        'üá±üá∫': 'Luxembourg',
        'üá≤üá∞': 'Mac√©doine du Nord',
        'üá≤üá¨': 'Madagascar',
        'üá≤üáæ': 'Malaisie',
        'üá≤üáº': 'Malawi',
        'üá≤üáª': 'Maldives',
        'üá≤üá±': 'Mali',
        'üá≤üáπ': 'Malte',
        'üá≤üá¶': 'Maroc',
        'üá≤üá≠': '√éles Marshall',
        'üá≤üá∫': 'Maurice',
        'üá≤üá∑': 'Mauritanie',
        'üá≤üáΩ': 'Mexique',
        'üá´üá≤': 'Micron√©sie',
        'üá≤üá©': 'Moldavie',
        'üá≤üá®': 'Monaco',
        'üá≤üá≥': 'Mongolie',
        'üá≤üá™': 'Mont√©n√©gro',
        'üá≤üáø': 'Mozambique',
        'üá≥üá¶': 'Namibie',
        'üá≥üá∑': 'Nauru',
        'üá≥üáµ': 'N√©pal',
        'üá≥üáÆ': 'Nicaragua',
        'üá≥üá™': 'Niger',
        'üá≥üá¨': 'Nigeria',
        'üá≥üá¥': 'Norv√®ge',
        'üá≥üáø': 'Nouvelle-Z√©lande',
        'üá¥üá≤': 'Oman',
        'üá∫üá¨': 'Ouganda',
        'üá∫üáø': 'Ouzb√©kistan',
        'üáµüá∞': 'Pakistan',
        'üáµüáº': 'Palaos',
        'üáµüá¶': 'Panama',
        'üáµüá¨': 'Papouasie-Nouvelle-Guin√©e',
        'üáµüáæ': 'Paraguay',
        'üá≥üá±': 'Pays-Bas',
        'üáµüá™': 'P√©rou',
        'üáµüá≠': 'Philippines',
        'üáµüá±': 'Pologne',
        'üáµüáπ': 'Portugal',
        'üá∂üá¶': 'Qatar',
        'üá∑üá¥': 'Roumanie',
        'üá¨üáß': 'Royaume-Uni',
        'üá∑üá∫': 'Russie',
        'üá∑üáº': 'Rwanda',
        'üá∞üá≥': 'Saint-Kitts-et-Nevis',
        'üá±üá®': 'Sainte-Lucie',
        'üáªüá®': 'Saint-Vincent-et-les-Grenadines',
        'üá∏üá≤': 'Saint-Marin',
        'üá∏üáß': '√éles Salomon',
        'üá∏üáª': 'Salvador',
        'üáºüá∏': 'Samoa',
        'üá∏üáπ': 'Sao Tom√©-et-Principe',
        'üá∏üá≥': 'S√©n√©gal',
        'üá∑üá∏': 'Serbie',
        'üá∏üá®': 'Seychelles',
        'üá∏üá±': 'Sierra Leone',
        'üá∏üá¨': 'Singapour',
        'üá∏üá∞': 'Slovaquie',
        'üá∏üáÆ': 'Slov√©nie',
        'üá∏üá¥': 'Somalie',
        'üá∏üá©': 'Soudan',
        'üá∏üá∏': 'Soudan du Sud',
        'üá±üá∞': 'Sri Lanka',
        'üá∏üá™': 'Su√®de',
        'üá®üá≠': 'Suisse',
        'üá∏üá∑': 'Suriname',
        'üá∏üáæ': 'Syrie',
        'üáπüáØ': 'Tadjikistan',
        'üáπüáø': 'Tanzanie',
        'üáπüá©': 'Tchad',
        'üá®üáø': 'Tch√©quie',
        'üáπüá≠': 'Tha√Ølande',
        'üáπüá±': 'Timor oriental',
        'üáπüá¨': 'Togo',
        'üáπüá¥': 'Tonga',
        'üáπüáπ': 'Trinit√©-et-Tobago',
        'üáπüá≥': 'Tunisie',
        'üáπüá≤': 'Turkm√©nistan',
        'üáπüá∑': 'Turquie',
        'üáπüáª': 'Tuvalu',
        'üá∫üá¶': 'Ukraine',
        'üá∫üáæ': 'Uruguay',
        'üáªüá∫': 'Vanuatu',
        'üáªüá¶': 'Vatican',
        'üáªüá™': 'Venezuela',
        'üáªüá≥': 'Vi√™t Nam',
        'üáæüá™': 'Y√©men',
        'üáøüá≤': 'Zambie',
        'üáøüáº': 'Zimbabwe'
      };
      
      return countries[flag] || flag;
    }
    
    // Show compliment modal
    function showComplimentModal() {
      if (!selectedPet) return;
      
      document.getElementById('complimentPetName').textContent = selectedPet.name;
      document.getElementById('complimentModal').classList.remove('hidden');
      
      // Add event listeners to phrase options
      document.querySelectorAll('.phrase-option').forEach(btn => {
        btn.addEventListener('click', function() {
          const petMessage = this.querySelector('.font-medium').textContent;
          const emojiIcon = this.querySelector('.text-2xl').textContent;
          sayToPet(selectedPet, petMessage, emojiIcon);
          hideComplimentModal();
        });
      });
    }
    
    // Hide compliment modal
    function hideComplimentModal() {
      document.getElementById('complimentModal').classList.add('hidden');
    }
    
    // Say something to pet
    function sayToPet(pet, message, emoji) {
      if (!pet) return;
      
      const petObj = pets.find(p => p.id === pet.id);
      if (petObj) {
        // Add happiness based on message
        let happinessBoost = 15;
        
        // Special bonuses
        if (message === 'Je t\'aime' || message === 'Je t\'adore') {
          happinessBoost = 25;
          // Update achievement progress for love messages
          updateAchievement('lover', 1);
        } else if (message === 'Tu es le meilleur' || message === 'Tu es magnifique') {
          happinessBoost = 20;
        }
        
        petObj.happiness = Math.min(100, petObj.happiness + happinessBoost);
        petObj.xp += 8;
        petObj.lastInteraction = Date.now();
        
        // Update general speaking achievement
        updateAchievement('speaker', 1);
        
        updatePetMood(petObj);
        savePets();
        renderPetDetails(petObj);
        renderPets();
        
        // Show animation with the emoji
        showActionAnimation(emoji);
        
        // Add speech bubble animation
        showSpeechBubble(petObj, message);
      }
    }
    
    // Show speech bubble animation
    function showSpeechBubble(pet, message) {
      const container = document.querySelector(`[data-pet-id="${pet.id}"]`);
      if (!container) return;
      
      const bubble = document.createElement('div');
      bubble.className = 'absolute top-0 right-0 transform -translate-y-full bg-white dark:bg-gray-800 p-2 rounded-xl border border-gray-200 dark:border-gray-600';
      bubble.style.minWidth = '80px';
      bubble.style.maxWidth = '150px';
      bubble.style.zIndex = 10;
      
      // Add speech bubble tail
      bubble.style.position = 'relative';
      bubble.innerHTML = `
        <div class="text-sm font-medium text-center">${message}</div>
        <div class="absolute bottom-0 right-3 transform translate-y-1/2 rotate-45 w-3 h-3 bg-white dark:bg-gray-800 border-r border-b border-gray-200 dark:border-gray-600"></div>
      `;
      
      container.appendChild(bubble);
      
      // Add appear animation
      bubble.animate([
        { opacity: 0, transform: 'translateY(-10px)' },
        { opacity: 1, transform: 'translateY(0)' }
      ], {
        duration: 300,
        easing: 'ease-out'
      });
      
      // Remove after some time
      setTimeout(() => {
        // Add disappear animation
        const anim = bubble.animate([
          { opacity: 1, transform: 'translateY(0)' },
          { opacity: 0, transform: 'translateY(-10px)' }
        ], {
          duration: 300,
          easing: 'ease-in'
        });
        
        anim.onfinish = () => bubble.remove();
      }, 3000);
    }
    
    // Save pets to memory only (data will be lost on refresh due to iframe sandbox limitations)
    function savePets() {
      // In sandbox environment, we can't use localStorage
      // This function now only ensures pets are saved in memory during the current session
      console.log('Pets saved in memory (data will be lost on page refresh)');
    }
    
    // Show delete confirmation modal
    function showDeleteConfirmation() {
      if (!selectedPet) return;
      document.getElementById('deleteModal').classList.remove('hidden');
    }
    
    // Hide delete confirmation modal
    function hideDeleteConfirmation() {
      document.getElementById('deleteModal').classList.add('hidden');
    }
    
    // Delete the selected pet
    function deleteSelectedPet() {
      if (!selectedPet) return;
      
      // If the pet is married, update its partner
      if (selectedPet.marriedTo) {
        const partner = pets.find(p => p.id === selectedPet.marriedTo);
        if (partner) {
          partner.marriedTo = null;
        }
      }
      
      // Remove the pet from array
      pets = pets.filter(p => p.id !== selectedPet.id);
      
      // Save changes
      savePets();
      
      // Update UI
      hideDeleteConfirmation();
      document.getElementById('selectedPetInfo').classList.add('hidden');
      document.getElementById('noSelection').classList.remove('hidden');
      selectedPet = null;
      
      // Re-render pets
      renderPets();
    }
    
    // Make pet sleep to restore energy
    function sleepPet() {
      if (!selectedPet) return;
      
      const pet = pets.find(p => p.id === selectedPet.id);
      if (pet) {
        pet.energy = 100;
        pet.xp += 5;
        pet.lastInteraction = Date.now();
        
        updatePetMood(pet);
        savePets();
        renderPetDetails(pet);
        updateNeedsUI(pet);
        renderPets();
        
        // Animation
        showActionAnimation('üò¥');
        
        // Show sleeping animation on the pet
        const petEl = document.querySelector(`[data-pet-id="${pet.id}"]`);
        if (petEl) {
          const emojiEl = petEl.querySelector('.emoji-display');
          
          // Add Z's animation
          const zs = document.createElement('div');
          zs.className = 'absolute -top-4 right-0 text-xl';
          zs.innerHTML = 'üí§';
          zs.style.animation = 'float 2s ease-in-out infinite';
          petEl.appendChild(zs);
          
          // Remove after a few seconds
          setTimeout(() => {
            zs.remove();
          }, 4000);
        }
      }
    }
    
    // Shop modal
    function showShopModal() {
      // Create modal if it doesn't exist
      if (!document.getElementById('shopModal')) {
        const shopModal = document.createElement('div');
        shopModal.id = 'shopModal';
        shopModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-10 hidden';
        
        shopModal.innerHTML = `
          <div class="oneui-card bg-oneui-light-card dark:bg-oneui-dark-card p-6 w-full max-w-md mx-4 max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-2xl font-semibold flex items-center">
                <span class="mr-2">üõí</span>
                Boutique
              </h2>
              <div class="bg-amber-100 dark:bg-amber-900 px-3 py-1 rounded-full text-amber-800 dark:text-amber-100 font-medium">
                <span id="shopCoins">${gameCoins}</span> ü™ô
              </div>
            </div>
            
            <div id="shopItemsList" class="space-y-4 mb-6">
              <!-- Shop items will be listed here -->
            </div>
            
            <button id="closeShop" class="oneui-button w-full py-3 px-4 bg-primary hover:bg-secondary text-white font-medium">
              Fermer
            </button>
          </div>
        `;
        
        document.body.appendChild(shopModal);
        
        // Add event listener to close button
        document.getElementById('closeShop').addEventListener('click', hideShopModal);
      }
      
      // Update coins display
      document.getElementById('shopCoins').textContent = gameCoins;
      document.getElementById('coinDisplay').textContent = gameCoins;
      
      // Render shop items
      renderShopItems();
      
      // Show the modal
      document.getElementById('shopModal').classList.remove('hidden');
    }
    
    // Hide shop modal
    function hideShopModal() {
      document.getElementById('shopModal').classList.add('hidden');
    }
    
    // Render shop items
    function renderShopItems() {
      const container = document.getElementById('shopItemsList');
      container.innerHTML = '';
      
      shopItems.forEach(item => {
        const itemEl = document.createElement('div');
        itemEl.className = 'p-4 bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 flex items-center justify-between';
        
        itemEl.innerHTML = `
          <div class="flex items-center">
            <div class="text-3xl mr-3">${item.emoji}</div>
            <div>
              <h3 class="font-bold">${item.name}</h3>
              <p class="text-sm text-gray-600 dark:text-gray-400">${item.description}</p>
            </div>
          </div>
          <button class="buy-item-btn px-3 py-1 ${gameCoins >= item.price ? 'bg-green-500 hover:bg-green-600' : 'bg-gray-400 cursor-not-allowed'} text-white rounded-lg flex items-center" data-item-id="${item.id}" ${gameCoins < item.price ? 'disabled' : ''}>
            <span>${item.price}</span>
            <span class="ml-1">ü™ô</span>
          </button>
        `;
        
        container.appendChild(itemEl);
      });
      
      // Add event listeners to buy buttons
      document.querySelectorAll('.buy-item-btn').forEach(btn => {
        if (!btn.disabled) {
          btn.addEventListener('click', function() {
            const itemId = this.dataset.itemId;
            buyItem(itemId);
          });
        }
      });
    }
    
    // Buy an item from the shop
    function buyItem(itemId) {
      if (!selectedPet) {
        alert('Veuillez d\'abord s√©lectionner un EmojiPet');
        return;
      }
      
      const item = shopItems.find(i => i.id === itemId);
      if (!item) return;
      
      // Check if player has enough coins
      if (gameCoins < item.price) {
        return;
      }
      
      // Deduct coins
      gameCoins -= item.price;
      
      // Update coins display
      document.getElementById('shopCoins').textContent = gameCoins;
      document.getElementById('coinDisplay').textContent = gameCoins;
      
      // Find pet
      const pet = pets.find(p => p.id === selectedPet.id);
      if (!pet) return;
      
      // Apply item effect
      if (item.type === 'accessory') {
        // Add accessory to pet
        pet.accessory = item.emoji;
        
        // Show success message
        showToast(`${item.emoji} ${item.name} √©quip√© √† ${pet.name}!`);
      } else if (item.type === 'potion') {
        // Apply potion effect
        const result = item.effect(pet);
        
        // Show success message
        showToast(`${item.emoji} ${result}`);
      }
      
      // Update UI
      savePets();
      renderPets();
      renderPetDetails(pet);
      updateNeedsUI(pet);
      
      // Disable the buy button if player doesn't have enough coins
      document.querySelectorAll('.buy-item-btn').forEach(btn => {
        const btnItemId = btn.dataset.itemId;
        const btnItem = shopItems.find(i => i.id === btnItemId);
        
        if (gameCoins < btnItem.price) {
          btn.disabled = true;
          btn.classList.remove('bg-green-500', 'hover:bg-green-600');
          btn.classList.add('bg-gray-400', 'cursor-not-allowed');
        }
      });
      
      // Animation
      showActionAnimation(item.emoji);
    }
    
    // Show toast message
    function showToast(message) {
      const toast = document.createElement('div');
      toast.className = 'fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-black bg-opacity-80 text-white py-2 px-4 rounded-lg z-50';
      toast.textContent = message;
      
      document.body.appendChild(toast);
      
      // Remove after 3 seconds
      setTimeout(() => {
        toast.classList.add('opacity-0');
        toast.style.transition = 'opacity 0.5s ease';
        
        setTimeout(() => {
          toast.remove();
        }, 500);
      }, 3000);
    }
    
    // Add event listeners for new buttons
    document.getElementById('sleepPet').addEventListener('click', sleepPet);
    document.getElementById('shopButton').addEventListener('click', showShopModal);
    
    // Start the game
    initGame();
  </script>
</body>
</html>
